<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.11" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.43" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="icon" href="/knowledge-database/favicon.ico"><title>MySQL | æ²–ç”°ã•ã‚“ã®çŸ¥è­˜ãƒ™ãƒ¼ã‚¹</title><meta name="description" content="åŸºäºVuePressçš„çŸ¥è¯†åº“,ä¸»é¢˜hope">
    <link rel="preload" href="/knowledge-database/assets/style-BRd0EN34.css" as="style"><link rel="stylesheet" href="/knowledge-database/assets/style-BRd0EN34.css">
    <link rel="modulepreload" href="/knowledge-database/assets/app-NwmlIrjp.js"><link rel="modulepreload" href="/knowledge-database/assets/MySQL.html-AWeQ25UD.js"><link rel="modulepreload" href="/knowledge-database/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/knowledge-database/assets/index.html-wF5_I1pE.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/MongoDB.html-5Cgz9Zt8.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-Cd15iYXj.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-BjBrXAco.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-_v5Xiq6H.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/Axios.html-D-L6aopJ.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/React.html-DcRAJEWs.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-DMXJFFTt.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/TypeScript.html-Do5bxlAY.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/Vue.html-D8Btyq6v.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/basic.html-cH3fn9yJ.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/practical.html-Bs5-6KbW.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-DyMKucDi.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/functional-programming.html-BM4DVXtK.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/grammar.html-CdWZ41HS.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/JDK17.html-0mzrTxVS.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/JDK18-20.html-BswoBjbM.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/JDK21.html-83bpHGY4.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/JDK22-.html-DRaUTJFT.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/JDK8.html-BbyQSjc9.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/JDK9-16.html-5fHeyR0Z.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-DFvnfOiu.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/basic.html-BCJiPV8t.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/pattern.html-QAwfBFXT.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/principle.html-DyHJgntR.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-D-9q0bqu.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-DHy2pqDI.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/centos.html-CWwE9ZDk.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/common.html-DutZbXr8.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-C7SgcnoR.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/shell.html-B5aayGdI.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/ubuntu.html-rHrSbo3g.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/wsl.html-C3Q8NsJ4.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/basic.html-CYPZ-a-m.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-CLXbs4Vw.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/principle.html-MJsRJXKm.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-3GArg7Jt.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/uml.html-CZd-vx7Y.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/core.html-DEeqZ4N_.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/install.html-DYzVdNVq.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-CfOb8W7F.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-BzJldYxR.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/Mybatis-plus.html-CoG_i72p.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/Mybatis.html-DgMVd4o1.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-DcyCJ7_V.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/Apache.html-DpgV-I0O.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/Nginx.html-BmAzd3Ep.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-DHPStDgz.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-HjpfXcUs.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/SpringMVC.html-D_KYXsub.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-D-Rian4Y.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/behavioral.html-BQC1Pe0A.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/creation.html-CcHmz-Sh.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-BfR-O5nR.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/structural.html-vFEeTcAp.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/core.html-144xr8Ho.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/install.html-CXxyntTU.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-BAF6ZnSv.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/AOP.html-B9UnJ0uF.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/IOC_Annoation.html-Bw6CSYfp.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/IOC_senior.html-Bm-KUL01.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/IOC_XML.html-CQX5Inqd.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-D8rjCYj-.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/äº‹åŠ¡.html-BmoFXh4V.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/core.html-CyjHMmsC.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/integration.html-DOicXo6Z.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-CNLSX4H2.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/YAML.html-D05k1oYK.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/core.html-rjxGLbXs.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-C3jo8vhi.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/basic.html-DAs_Zfwt.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index.html-DIOFwk_y.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/404.html-Dn6WlYU-.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/mermaid.core-D7gpRhQe.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/photoswipe.esm-SzV8tJDW.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/style-l0sNRNKZ.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/docsearch-l0sNRNKZ.js" as="script"><link rel="prefetch" href="/knowledge-database/assets/index-zMbLkDvU.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/knowledge-database/"><img class="vp-nav-logo light" src="/knowledge-database/logo.png" alt><img class="vp-nav-logo dark" src="/knowledge-database/logo-dark.png" alt><span class="vp-site-name hide-in-pad">æ²–ç”°ã•ã‚“ã®çŸ¥è­˜ãƒ™ãƒ¼ã‚¹</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link vp-link" href="/knowledge-database/" aria-label="ä¸»é¡µ"><img class="icon" src="/knowledge-database/home.png" alt aria-hidden no-view style="">ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link vp-link" href="/knowledge-database/basic/" aria-label="åŸºç¡€"><img class="icon" src="/knowledge-database/icon/java.png" alt aria-hidden no-view style="">åŸºç¡€<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link active vp-link" href="/knowledge-database/database/" aria-label="æ•°æ®åº“"><img class="icon" src="/knowledge-database/icon/database.svg" alt aria-hidden no-view style="">æ•°æ®åº“<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link vp-link" href="/knowledge-database/frame/" aria-label="æ¡†æ¶"><img class="icon" src="/knowledge-database/icon/frame.png" alt aria-hidden no-view style="">æ¡†æ¶<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link vp-link" href="/knowledge-database/web/" aria-label="å‰ç«¯"><img class="icon" src="/knowledge-database/icon/web.png" alt aria-hidden no-view style="">å‰ç«¯<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/Okita1027/knowledge-database" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="æœç´¢æ–‡æ¡£"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">æœç´¢æ–‡æ¡£</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link active vp-link vp-sidebar-link vp-sidebar-page active" href="/knowledge-database/database/MySQL.html" aria-label="MySQL"><!---->MySQL<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/knowledge-database/database/MongoDB.html" aria-label="MongoDB"><!---->MongoDB<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Redis</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->MySQL</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://Okita1027.github.io" target="_blank" rel="noopener noreferrer">Okita</a></span><span property="author" content="Okita"></span></span><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-05-21T13:57:06.000Z"></span><!----><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 67 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT67M"></span><span class="page-word-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon" name="word"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 19994 å­—</span><meta property="wordCount" content="19994"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æŸ¥è¯¢è¯­å¥">æŸ¥è¯¢è¯­å¥</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#union">Union</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7ç§å¤–è¿æ¥">7ç§å¤–è¿æ¥</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#sql99æ–°ç‰¹æ€§">SQL99æ–°ç‰¹æ€§</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è‡ªç„¶è¿æ¥">**è‡ªç„¶è¿æ¥ **</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#usingè¿æ¥">USINGè¿æ¥</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#äº‹åŠ¡">äº‹åŠ¡</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#äº‹åŠ¡å››å¤§ç‰¹æ€§">äº‹åŠ¡å››å¤§ç‰¹æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¹¶å‘äº‹åŠ¡é—®é¢˜">å¹¶å‘äº‹åŠ¡é—®é¢˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#äº‹åŠ¡éš”ç¦»çº§åˆ«">äº‹åŠ¡éš”ç¦»çº§åˆ«</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å­˜å‚¨å¼•æ“">å­˜å‚¨å¼•æ“</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é€šç”¨å‘½ä»¤">é€šç”¨å‘½ä»¤</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#innodb">InnoDB</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#myisam">MyISAM</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#memory">Memory</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ€§èƒ½åˆ†æ">æ€§èƒ½åˆ†æ</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æŸ¥çœ‹æ‰§è¡Œé¢‘æ¬¡">æŸ¥çœ‹æ‰§è¡Œé¢‘æ¬¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ…¢æŸ¥è¯¢æ—¥å¿—">æ…¢æŸ¥è¯¢æ—¥å¿—</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—å¼€å…³">å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—å¼€å…³</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#è®¾ç½®æ…¢æŸ¥è¯¢æ—¥å¿—çš„æ—¶é—´ä¸º2ç§’-sqlè¯­å¥æ‰§è¡Œæ—¶é—´è¶…è¿‡2ç§’-å°±ä¼šè§†ä¸ºæ…¢æŸ¥è¯¢-è®°å½•æ…¢æŸ¥è¯¢æ—¥å¿—">è®¾ç½®æ…¢æŸ¥è¯¢æ—¥å¿—çš„æ—¶é—´ä¸º2ç§’ï¼ŒSQLè¯­å¥æ‰§è¡Œæ—¶é—´è¶…è¿‡2ç§’ï¼Œå°±ä¼šè§†ä¸ºæ…¢æŸ¥è¯¢ï¼Œè®°å½•æ…¢æŸ¥è¯¢æ—¥å¿—</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#profile">profile</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#explain">explain</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç›´æ¥åœ¨selectè¯­å¥ä¹‹å‰åŠ ä¸Šå…³é”®å­—-explain-desc">ç›´æ¥åœ¨selectè¯­å¥ä¹‹å‰åŠ ä¸Šå…³é”®å­— explain / desc</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç´¢å¼•">ç´¢å¼•</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç´¢å¼•ç»“æ„">ç´¢å¼•ç»“æ„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç´¢å¼•åˆ†ç±»">ç´¢å¼•åˆ†ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç´¢å¼•è¯­æ³•">ç´¢å¼•è¯­æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨è§„åˆ™">ä½¿ç”¨è§„åˆ™</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è®¾è®¡åŸåˆ™">è®¾è®¡åŸåˆ™</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#sqlä¼˜åŒ–">SQLä¼˜åŒ–</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ’å…¥æ•°æ®">æ’å…¥æ•°æ®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸»é”®ä¼˜åŒ–">ä¸»é”®ä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#order-byä¼˜åŒ–">ORDER BYä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#limitä¼˜åŒ–">limitä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#countä¼˜åŒ–">countä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#updateä¼˜åŒ–-é¿å…è¡Œé”å‡çº§ä¸ºè¡¨é”">updateä¼˜åŒ–ï¼ˆé¿å…è¡Œé”å‡çº§ä¸ºè¡¨é”ï¼‰</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#é”">é”</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ¦‚è¿°">æ¦‚è¿°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å…¨å±€é”">å…¨å±€é”</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è¡¨çº§é”">è¡¨çº§é”</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è¡Œçº§é”">è¡Œçº§é”</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#innodbå¼•æ“">InnoDBå¼•æ“</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é€»è¾‘å­˜å‚¨ç»“æ„">**é€»è¾‘å­˜å‚¨ç»“æ„ **</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ¶æ„">æ¶æ„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç£ç›˜ç»“æ„">ç£ç›˜ç»“æ„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åå°çº¿ç¨‹">åå°çº¿ç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#äº‹åŠ¡åŸç†">äº‹åŠ¡åŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#mvcc">MVCC</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#mysqlç®¡ç†">MySQLç®¡ç†</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç³»ç»Ÿæ•°æ®åº“">ç³»ç»Ÿæ•°æ®åº“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¸¸ç”¨å·¥å…·">å¸¸ç”¨å·¥å…·</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ•°æ®ç±»å‹">æ•°æ®ç±»å‹</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ•´å‹">æ•´å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ®ç‚¹å‹">æµ®ç‚¹å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ—¥æœŸå’Œæ—¶é—´">æ—¥æœŸå’Œæ—¶é—´</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å­—ç¬¦ä¸²">å­—ç¬¦ä¸²</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#äºŒè¿›åˆ¶ç±»å‹">äºŒè¿›åˆ¶ç±»å‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æƒé™ä¸€è§ˆè¡¨">æƒé™ä¸€è§ˆè¡¨</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h2 id="æŸ¥è¯¢è¯­å¥" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢è¯­å¥"><span>æŸ¥è¯¢è¯­å¥</span></a></h2><h3 id="union" tabindex="-1"><a class="header-anchor" href="#union"><span>Union</span></a></h3><p>**åˆå¹¶æŸ¥è¯¢ç»“æœ **åˆ©ç”¨UNIONå…³é”®å­—ï¼Œå¯ä»¥ç»™å‡ºå¤šæ¡SELECTè¯­å¥ï¼Œå¹¶å°†å®ƒä»¬çš„ç»“æœç»„åˆæˆå•ä¸ªç»“æœé›†ã€‚åˆå¹¶ æ—¶ï¼Œä¸¤ä¸ªè¡¨å¯¹åº”çš„åˆ—æ•°å’Œæ•°æ®ç±»å‹å¿…é¡»ç›¸åŒï¼Œå¹¶ä¸”ç›¸äº’å¯¹åº”ã€‚å„ä¸ªSELECTè¯­å¥ä¹‹é—´ä½¿ç”¨UNIONæˆ–UNION ALLå…³é”®å­—åˆ†éš”ã€‚<br> è¯­æ³•æ ¼å¼ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">column</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> table1
<span class="token keyword">UNION</span> <span class="token punctuation">[</span><span class="token keyword">ALL</span><span class="token punctuation">]</span>
<span class="token keyword">SELECT</span> <span class="token keyword">column</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> table2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Union</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/select01.png" alt="image.png" loading="lazy"><br> UNION æ“ä½œç¬¦è¿”å›ä¸¤ä¸ªæŸ¥è¯¢çš„ç»“æœé›†çš„å¹¶é›†ï¼Œå»é™¤é‡å¤è®°å½•ã€‚</p><ul><li>Union All</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/select02.png" alt="image.png" loading="lazy"><br> UNION ALLæ“ä½œç¬¦è¿”å›ä¸¤ä¸ªæŸ¥è¯¢çš„ç»“æœé›†çš„å¹¶é›†ã€‚å¯¹äºä¸¤ä¸ªç»“æœé›†çš„é‡å¤éƒ¨åˆ†ï¼Œä¸å»é‡ã€‚</p><blockquote><p>æ³¨æ„ï¼šæ‰§è¡ŒUNION ALLè¯­å¥æ—¶æ‰€éœ€è¦çš„èµ„æºæ¯”UNIONè¯­å¥å°‘ã€‚å¦‚æœæ˜ç¡®çŸ¥é“åˆå¹¶æ•°æ®åçš„ç»“æœæ•°æ®ä¸å­˜åœ¨é‡å¤æ•°æ®ï¼Œæˆ–è€…ä¸éœ€è¦å»é™¤é‡å¤çš„æ•°æ®ï¼Œåˆ™å°½é‡ä½¿ç”¨UNION ALLè¯­å¥ï¼Œä»¥æé«˜æ•°æ®æŸ¥è¯¢çš„æ•ˆç‡ã€‚</p></blockquote><h3 id="_7ç§å¤–è¿æ¥" tabindex="-1"><a class="header-anchor" href="#_7ç§å¤–è¿æ¥"><span>7ç§å¤–è¿æ¥</span></a></h3><h4 id="æ¦‚è§ˆ" tabindex="-1"><a class="header-anchor" href="#æ¦‚è§ˆ"><span>æ¦‚è§ˆ</span></a></h4><figure><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/select03.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h4 id="å®ç°" tabindex="-1"><a class="header-anchor" href="#å®ç°"><span>å®ç°</span></a></h4><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">#ä¸­å›¾ï¼šå†…è¿æ¥ Aâˆ©B</span>
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token keyword">JOIN</span> departments d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token comment">#å·¦ä¸Šå›¾ï¼šå·¦å¤–è¿æ¥</span>
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> departments d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token comment">#å³ä¸Šå›¾ï¼šå³å¤–è¿æ¥</span>
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token keyword">RIGHT</span> <span class="token keyword">JOIN</span> departments d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token comment">#å·¦ä¸­å›¾ï¼šA - Aâˆ©B</span>
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> departments d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> d<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span> <span class="token operator">IS</span> <span class="token boolean">NULL</span>
<span class="token comment">#å³ä¸­å›¾ï¼šB-Aâˆ©B</span>
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token keyword">RIGHT</span> <span class="token keyword">JOIN</span> departments d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> e<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span> <span class="token operator">IS</span> <span class="token boolean">NULL</span>
<span class="token comment">#å·¦ä¸‹å›¾ï¼šæ»¡å¤–è¿æ¥</span>
<span class="token comment">#å·¦ä¸­å›¾ + å³ä¸Šå›¾ AâˆªB</span>
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> departments d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> d<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span> <span class="token operator">IS</span> <span class="token boolean">NULL</span>
<span class="token keyword">UNION</span> <span class="token keyword">ALL</span> <span class="token comment">#æ²¡æœ‰å»é‡æ“ä½œï¼Œæ•ˆç‡é«˜</span>
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token keyword">RIGHT</span> <span class="token keyword">JOIN</span> departments d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token comment">#å³ä¸‹å›¾</span>
<span class="token comment">#å·¦ä¸­å›¾ + å³ä¸­å›¾ A âˆªB- Aâˆ©B æˆ–è€… (A - Aâˆ©B) âˆª ï¼ˆB - Aâˆ©Bï¼‰</span>
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> departments d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> d<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span> <span class="token operator">IS</span> <span class="token boolean">NULL</span>
<span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token keyword">RIGHT</span> <span class="token keyword">JOIN</span> departments d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> e<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span> <span class="token operator">IS</span> <span class="token boolean">NULL</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å°ç»“" tabindex="-1"><a class="header-anchor" href="#å°ç»“"><span>å°ç»“</span></a></h4><ul><li>å·¦ä¸­å›¾</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">#å®ç°A - Aâˆ©B</span>
<span class="token keyword">select</span> å­—æ®µåˆ—è¡¨
<span class="token keyword">from</span> Aè¡¨ <span class="token keyword">left</span> <span class="token keyword">join</span> Bè¡¨
<span class="token keyword">on</span> å…³è”æ¡ä»¶
<span class="token keyword">where</span> ä»è¡¨å…³è”å­—æ®µ <span class="token operator">is</span> <span class="token boolean">null</span> <span class="token operator">and</span> ç­‰å…¶ä»–å­å¥<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å³ä¸­å›¾</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">#å®ç°B - Aâˆ©B</span>
<span class="token keyword">select</span> å­—æ®µåˆ—è¡¨
<span class="token keyword">from</span> Aè¡¨ <span class="token keyword">right</span> <span class="token keyword">join</span> Bè¡¨
<span class="token keyword">on</span> å…³è”æ¡ä»¶
<span class="token keyword">where</span> ä»è¡¨å…³è”å­—æ®µ <span class="token operator">is</span> <span class="token boolean">null</span> <span class="token operator">and</span> ç­‰å…¶ä»–å­å¥<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å·¦ä¸‹å›¾</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">#å®ç°æŸ¥è¯¢ç»“æœæ˜¯AâˆªB</span>
<span class="token comment">#ç”¨å·¦å¤–çš„Aï¼Œunion å³å¤–çš„B</span>
<span class="token keyword">select</span> å­—æ®µåˆ—è¡¨
<span class="token keyword">from</span> Aè¡¨ <span class="token keyword">left</span> <span class="token keyword">join</span> Bè¡¨
<span class="token keyword">on</span> å…³è”æ¡ä»¶
<span class="token keyword">where</span> ç­‰å…¶ä»–å­å¥
<span class="token keyword">union</span>
<span class="token keyword">select</span> å­—æ®µåˆ—è¡¨
<span class="token keyword">from</span> Aè¡¨ <span class="token keyword">right</span> <span class="token keyword">join</span> Bè¡¨
<span class="token keyword">on</span> å…³è”æ¡ä»¶
<span class="token keyword">where</span> ç­‰å…¶ä»–å­å¥<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å³ä¸‹å›¾</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">#å®ç°AâˆªB - Aâˆ©B æˆ– (A - Aâˆ©B) âˆª ï¼ˆB - Aâˆ©Bï¼‰</span>
<span class="token comment">#ä½¿ç”¨å·¦å¤–çš„ (A - Aâˆ©B) union å³å¤–çš„ï¼ˆB - Aâˆ©Bï¼‰</span>
<span class="token keyword">select</span> å­—æ®µåˆ—è¡¨
<span class="token keyword">from</span> Aè¡¨ <span class="token keyword">left</span> <span class="token keyword">join</span> Bè¡¨
<span class="token keyword">on</span> å…³è”æ¡ä»¶
<span class="token keyword">where</span> ä»è¡¨å…³è”å­—æ®µ <span class="token operator">is</span> <span class="token boolean">null</span> <span class="token operator">and</span> ç­‰å…¶ä»–å­å¥
<span class="token keyword">union</span>
<span class="token keyword">select</span> å­—æ®µåˆ—è¡¨
<span class="token keyword">from</span> Aè¡¨ <span class="token keyword">right</span> <span class="token keyword">join</span> Bè¡¨
<span class="token keyword">on</span> å…³è”æ¡ä»¶
<span class="token keyword">where</span> ä»è¡¨å…³è”å­—æ®µ <span class="token operator">is</span> <span class="token boolean">null</span> <span class="token operator">and</span> ç­‰å…¶ä»–å­å¥
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="sql99æ–°ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#sql99æ–°ç‰¹æ€§"><span><strong>SQL99æ–°ç‰¹æ€§</strong></span></a></h2><h3 id="è‡ªç„¶è¿æ¥" tabindex="-1"><a class="header-anchor" href="#è‡ªç„¶è¿æ¥"><span>**è‡ªç„¶è¿æ¥ **</span></a></h3><p>SQL99 åœ¨ SQL92 çš„åŸºç¡€ä¸Šæä¾›äº†ä¸€äº›ç‰¹æ®Šè¯­æ³•ï¼Œæ¯”å¦‚ NATURAL JOIN ç”¨æ¥è¡¨ç¤ºè‡ªç„¶è¿æ¥ã€‚æˆ‘ä»¬å¯ä»¥æŠŠè‡ªç„¶è¿æ¥ç†è§£ä¸º SQL92 ä¸­çš„ç­‰å€¼è¿æ¥ã€‚å®ƒä¼šå¸®ä½ è‡ªåŠ¨æŸ¥è¯¢ä¸¤å¼ è¿æ¥è¡¨ä¸­ æ‰€æœ‰ç›¸åŒçš„å­—æ®µ ï¼Œç„¶åè¿›è¡Œ ç­‰å€¼è¿æ¥ ã€‚<br> åœ¨SQL92æ ‡å‡†ä¸­ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token keyword">JOIN</span> departments d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span>
<span class="token operator">AND</span> e<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>manager_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>manager_id<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨SQL99æ ‡å‡†ä¸­ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token keyword">NATURAL</span> <span class="token keyword">JOIN</span> departments d<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="usingè¿æ¥" tabindex="-1"><a class="header-anchor" href="#usingè¿æ¥"><span>USINGè¿æ¥</span></a></h3><p>å½“æˆ‘ä»¬è¿›è¡Œè¿æ¥çš„æ—¶å€™ï¼ŒSQL99è¿˜æ”¯æŒä½¿ç”¨ USING æŒ‡å®šæ•°æ®è¡¨é‡Œçš„ åŒåå­—æ®µ è¿›è¡Œç­‰å€¼è¿æ¥ã€‚ä½†æ˜¯åªèƒ½é…<br> åˆJOINä¸€èµ·ä½¿ç”¨ã€‚æ¯”å¦‚ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token keyword">JOIN</span> departments d
<span class="token keyword">USING</span> <span class="token punctuation">(</span>department_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½ èƒ½çœ‹å‡ºä¸è‡ªç„¶è¿æ¥ NATURAL JOIN ä¸åŒçš„æ˜¯ï¼ŒUSING æŒ‡å®šäº†å…·ä½“çš„ç›¸åŒçš„å­—æ®µåç§°ï¼Œä½ éœ€è¦åœ¨ USING çš„æ‹¬å· () ä¸­å¡«å…¥è¦æŒ‡å®šçš„åŒåå­—æ®µã€‚åŒæ—¶ä½¿ç”¨ JOIN...USING å¯ä»¥ç®€åŒ– JOIN ON çš„ç­‰å€¼è¿æ¥ã€‚å®ƒä¸ä¸‹é¢çš„ SQL æŸ¥è¯¢ç»“æœæ˜¯ç›¸åŒçš„ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token punctuation">,</span>departments d
<span class="token keyword">WHERE</span> e<span class="token punctuation">.</span>department_id <span class="token operator">=</span> d<span class="token punctuation">.</span>department_id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="äº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡"><span>äº‹åŠ¡</span></a></h2><h3 id="äº‹åŠ¡å››å¤§ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡å››å¤§ç‰¹æ€§"><span>äº‹åŠ¡å››å¤§ç‰¹æ€§</span></a></h3><ul><li>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œå•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</li><li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€ã€‚</li><li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›çš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ç‹¬ç«‹ç¯å¢ƒä¸‹è¿è¡Œã€‚</li><li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆ–å›æ»šï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…çš„ã€‚</li></ul><p>ä¸Šè¿°å°±æ˜¯äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼Œç®€ç§°<strong>ACID</strong>ã€‚</p><h3 id="å¹¶å‘äº‹åŠ¡é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#å¹¶å‘äº‹åŠ¡é—®é¢˜"><span>å¹¶å‘äº‹åŠ¡é—®é¢˜</span></a></h3><ul><li><strong>èµƒè¯»</strong>ï¼šä¸€ä¸ªäº‹åŠ¡è¯»åˆ°å¦å¤–ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/transaction01.png" alt="image.png" loading="lazy"><br> ä¾‹å¦‚ï¼šBè¯»å–åˆ°äº†Aæœªæäº¤çš„æ•°æ®ã€‚</p><ul><li><strong>ä¸å¯é‡å¤è¯»</strong>ï¼šä¸€ä¸ªäº‹åŠ¡å…ˆåè¯»å–åŒä¸€æ¡è®°å½•ï¼Œä½†ä¸¤æ¬¡è¯»å–çš„æ•°æ®ä¸åŒï¼Œç§°ä¹‹ä¸ºä¸å¯é‡å¤è¯»ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/transaction02.png" alt="img02.png" loading="lazy"><br> äº‹åŠ¡Aä¸¤æ¬¡è¯»å–åŒä¸€æ¡è®°å½•ï¼Œä½†æ˜¯è¯»å–åˆ°çš„æ•°æ®å´æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><ul><li><strong>å¹»è¯»</strong>ï¼šä¸€ä¸ªäº‹åŠ¡æŒ‰ç…§æ¡ä»¶æŸ¥è¯¢æ•°æ®æ—¶ï¼Œæ²¡æœ‰å¯¹åº”çš„æ•°æ®è¡Œï¼Œä½†æ˜¯åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œåˆå‘ç°è¿™è¡Œæ•°æ®å·²ç»å­˜åœ¨ï¼Œå¥½åƒå‡ºç°äº† &quot;å¹»å½±&quot;ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/transaction03.png" alt="img03.png" loading="lazy"><br> äº‹åŠ¡AæŸ¥è¯¢æ•°æ®ä¸å­˜åœ¨ï¼Œäº‹åŠ¡Bæ’å…¥æ•°æ®å¹¶æäº¤ï¼Œäº‹åŠ¡Aå°è¯•æ’å…¥æ•°æ®ç¼ºæ— æ³•æ’å…¥ï¼ŒæŸ¥è¯¢æ•°æ®åˆæŸ¥ä¸åˆ°ã€‚</p><h3 id="äº‹åŠ¡éš”ç¦»çº§åˆ«" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡éš”ç¦»çº§åˆ«"><span>äº‹åŠ¡éš”ç¦»çº§åˆ«</span></a></h3><figure><img src="https://cdn.nlark.com/yuque/0/2023/png/32600948/1682235225953-570663f9-7250-42d3-933e-22c120b7d624.png#averageHue=%23fcfbfb&amp;clientId=u7ed4b1c6-c50c-4&amp;from=paste&amp;height=310&amp;id=ufbf0e72c&amp;originHeight=310&amp;originWidth=882&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=27678&amp;status=done&amp;style=none&amp;taskId=u086fb9d7-9061-4ff4-8a25-792851eef65&amp;title=&amp;width=882" alt="img04.png" tabindex="0" loading="lazy"><figcaption>img04.png</figcaption></figure><ul><li>æŸ¥çœ‹äº‹åŠ¡éš”ç¦»çº§åˆ«</li></ul><p><code>SELECT @@TRANSACTION_ISOLATION;</code></p><ul><li>è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«</li></ul><p><code>SET [ SESSION | GLOBAL ] TRANSACTION ISOLATION LEVEL { READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE }</code></p><ul><li><strong>æ³¨æ„</strong>ï¼šäº‹åŠ¡éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œæ•°æ®è¶Šå®‰å…¨ï¼Œä½†æ˜¯æ€§èƒ½è¶Šä½</li></ul><h2 id="å­˜å‚¨å¼•æ“" tabindex="-1"><a class="header-anchor" href="#å­˜å‚¨å¼•æ“"><span>å­˜å‚¨å¼•æ“</span></a></h2><h3 id="é€šç”¨å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#é€šç”¨å‘½ä»¤"><span>é€šç”¨å‘½ä»¤</span></a></h3><ul><li>è·å–åˆ›å»ºè¡¨çš„ä¿¡æ¯</li></ul><p>ä¿¡æ¯çš„æœ€åä¼šå†™å‡ºä½¿ç”¨çš„æ˜¯å“ªç§å­˜å‚¨å¼•æ“<br><code>SHOW CREATE TABLE employees;</code></p><ul><li>æŸ¥è¯¢å½“å‰æ•°æ®åº“æ”¯æŒçš„å­˜å‚¨å¼•æ“</li></ul><p><code>SHOW ENGINES;</code></p><ul><li>åˆ›å»ºè¡¨æ—¶æŒ‡å®šå­˜å‚¨å¼•æ“</li></ul><p><code>CREATE TABLE è¡¨å(...)ENGINE = xxx;</code></p><h3 id="innodb" tabindex="-1"><a class="header-anchor" href="#innodb"><span>InnoDB</span></a></h3><ul><li>ä»‹ç» <ul><li>InnoDBæ˜¯ä¸€ç§å…¼é¡¾é«˜å¯é æ€§å’Œé«˜æ€§èƒ½çš„é€šç”¨å­˜å‚¨å¼•æ“ï¼Œåœ¨ MySQL 5.5 ä¹‹åï¼ŒInnoDBæ˜¯é»˜è®¤çš„MySQL å­˜å‚¨å¼•æ“ã€‚</li></ul></li><li>ç‰¹ç‚¹ <ul><li>DMLæ“ä½œéµå¾ªACIDæ¨¡å‹ï¼Œæ”¯æŒäº‹åŠ¡ï¼›</li><li>è¡Œçº§é”ï¼Œæé«˜å¹¶å‘è®¿é—®æ€§èƒ½ï¼›</li><li>æ”¯æŒå¤–é”®FOREIGN KEYçº¦æŸï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ï¼›</li></ul></li><li>æ–‡ä»¶ <ul><li>xxx.ibdï¼šxxxä»£è¡¨çš„æ˜¯è¡¨åï¼ŒinnoDBå¼•æ“çš„æ¯å¼ è¡¨éƒ½ä¼šå¯¹åº”è¿™æ ·ä¸€ä¸ªè¡¨ç©ºé—´æ–‡ä»¶ï¼Œå­˜å‚¨è¯¥è¡¨çš„è¡¨ç»“æ„ï¼ˆfrm-æ—©æœŸçš„ ã€sdi-æ–°ç‰ˆçš„ï¼‰ã€æ•°æ®å’Œç´¢å¼•ã€‚</li><li><code>show variables like &#39;innodb_file_per_table&#39;;</code><br> è‹¥Valueä¸ºONï¼Œåˆ™å¯åœ¨MySQL çš„Dataæ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ° è¡¨å.idbçš„æ–‡ä»¶ <ul><li><code>ibd2sdi xxx.idb</code><br> åœ¨CMDä¸‹è¿è¡Œè¯¥æŒ‡ä»¤ï¼ˆç”±MySQLæä¾›ï¼‰å¯æŸ¥è¯¢è¯¥è¡¨çš„ä¿¡æ¯</li></ul></li></ul></li><li>é€»è¾‘å­˜å‚¨ç»“æ„</li></ul><figure><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/engine01.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><ul><li>è¡¨ç©ºé—´ : InnoDBå­˜å‚¨å¼•æ“é€»è¾‘ç»“æ„çš„æœ€é«˜å±‚ï¼Œibdæ–‡ä»¶å…¶å®å°±æ˜¯è¡¨ç©ºé—´æ–‡ä»¶ï¼Œåœ¨è¡¨ç©ºé—´ä¸­å¯ä»¥åŒ…å«å¤šä¸ªSegmentæ®µã€‚</li><li>æ®µ : è¡¨ç©ºé—´æ˜¯ç”±å„ä¸ªæ®µç»„æˆçš„ï¼Œ å¸¸è§çš„æ®µæœ‰æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µç­‰ã€‚InnoDBä¸­å¯¹äºæ®µçš„ç®¡ç†ï¼Œéƒ½æ˜¯å¼•æ“è‡ªèº«å®Œæˆï¼Œä¸éœ€è¦äººä¸ºå¯¹å…¶æ§åˆ¶ï¼Œä¸€ä¸ªæ®µä¸­åŒ…å«å¤šä¸ªåŒºã€‚</li><li>åŒº : åŒºæ˜¯è¡¨ç©ºé—´çš„å•å…ƒç»“æ„ï¼Œæ¯ä¸ªåŒºçš„å¤§å°ä¸º1Mã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ InnoDBå­˜å‚¨å¼•æ“é¡µå¤§å°ä¸º16Kï¼Œ å³ä¸€ä¸ªåŒºä¸­ä¸€å…±æœ‰64ä¸ªè¿ç»­çš„é¡µã€‚</li><li>é¡µ : é¡µæ˜¯ç»„æˆåŒºçš„æœ€å°å•å…ƒï¼Œ<strong>é¡µä¹Ÿæ˜¯InnoDB å­˜å‚¨å¼•æ“ç£ç›˜ç®¡ç†çš„æœ€å°å•å…ƒ</strong>ï¼Œæ¯ä¸ªé¡µçš„å¤§å°é»˜è®¤ä¸º 16KBã€‚ä¸ºäº†ä¿è¯é¡µçš„è¿ç»­æ€§ï¼ŒInnoDB å­˜å‚¨å¼•æ“æ¯æ¬¡ä»ç£ç›˜ç”³è¯· 4-5 ä¸ªåŒºã€‚</li><li>è¡Œ : InnoDB å­˜å‚¨å¼•æ“æ˜¯é¢å‘è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®æ˜¯æŒ‰è¡Œè¿›è¡Œå­˜æ”¾çš„ï¼Œåœ¨æ¯ä¸€è¡Œä¸­é™¤äº†å®šä¹‰è¡¨æ—¶æ‰€æŒ‡å®šçš„å­—æ®µä»¥å¤–ï¼Œè¿˜åŒ…å«ä¸¤ä¸ªéšè—å­—æ®µ(åé¢ä¼šè¯¦ç»†ä»‹ç»)ã€‚ <ul><li>Trx_idï¼šæ¯æ¬¡å¯¹æŸæ¡è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼šæŠŠå¯¹åº”çš„äº‹åŠ¡idèµ‹å€¼ç»™trx_idéšè—åˆ—ã€‚</li><li>Roll_pointerï¼šæ¯æ¬¡å¯¹æŸæ¡å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼šæŠŠæ—§çš„ç‰ˆæœ¬å†™å…¥åˆ°undoæ—¥å¿—ä¸­ï¼Œç„¶åè¿™ä¸ªéšè—åˆ—å°±ç›¸å½“äºä¸€ä¸ªæŒ‡é’ˆï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥æ‰¾åˆ°è¯¥è®°å½•ä¿®æ”¹å‰çš„ä¿¡æ¯ã€‚</li></ul></li></ul><h3 id="myisam" tabindex="-1"><a class="header-anchor" href="#myisam"><span>MyISAM</span></a></h3><ul><li>ä»‹ç» <ul><li>MyISAMæ˜¯MySQLæ—©æœŸçš„é»˜è®¤å­˜å‚¨å¼•æ“ã€‚</li></ul></li><li>ç‰¹ç‚¹ <ul><li>ä¸æ”¯æŒäº‹åŠ¡ï¼Œä¸æ”¯æŒå¤–é”®</li><li>æ”¯æŒè¡¨é”ï¼Œä¸æ”¯æŒè¡Œé”</li><li>è®¿é—®é€Ÿåº¦å¿«</li></ul></li><li>æ–‡ä»¶ <ul><li>xxx.sdiï¼šå­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯</li><li>xxx.MYD: å­˜å‚¨æ•°æ®</li><li>xxx.MYI: å­˜å‚¨ç´¢å¼•</li></ul></li></ul><h3 id="memory" tabindex="-1"><a class="header-anchor" href="#memory"><span>Memory</span></a></h3><ul><li>ä»‹ç» <ul><li>Memoryå¼•æ“çš„è¡¨æ•°æ®æ—¶å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œç”±äºå—åˆ°ç¡¬ä»¶é—®é¢˜ã€æˆ–æ–­ç”µé—®é¢˜çš„å½±å“ï¼Œåªèƒ½å°†è¿™äº›è¡¨ä½œä¸ºä¸´æ—¶è¡¨æˆ–ç¼“å­˜ä½¿ç”¨ã€‚</li></ul></li><li>ç‰¹ç‚¹ <ul><li>å†…å­˜å­˜æ”¾ï¼Œé€Ÿåº¦å¿«</li><li>hashç´¢å¼•ï¼ˆé»˜è®¤ï¼‰</li></ul></li><li>æ–‡ä»¶ <ul><li>xxx.sdiï¼šå­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯</li></ul></li></ul><h4 id="åŒºåˆ«åŠç‰¹ç‚¹" tabindex="-1"><a class="header-anchor" href="#åŒºåˆ«åŠç‰¹ç‚¹"><span>åŒºåˆ«åŠç‰¹ç‚¹</span></a></h4><p><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/engine02.png" alt="image.png" loading="lazy"><br><strong>é¢è¯•é¢˜:</strong><br> InnoDBå¼•æ“ä¸MyISAMå¼•æ“çš„åŒºåˆ« ?<br> â‘ . InnoDBå¼•æ“, æ”¯æŒäº‹åŠ¡, è€ŒMyISAMä¸æ”¯æŒã€‚<br> â‘¡. InnoDBå¼•æ“, æ”¯æŒè¡Œé”å’Œè¡¨é”, è€ŒMyISAMä»…æ”¯æŒè¡¨é”, ä¸æ”¯æŒè¡Œé”ã€‚<br> â‘¢. InnoDBå¼•æ“, æ”¯æŒå¤–é”®, è€ŒMyISAMæ˜¯ä¸æ”¯æŒçš„ã€‚<br> ä¸»è¦æ˜¯ä¸Šè¿°ä¸‰ç‚¹åŒºåˆ«ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä»ç´¢å¼•ç»“æ„ã€å­˜å‚¨é™åˆ¶ç­‰æ–¹é¢ï¼Œæ›´åŠ æ·±å…¥çš„å›ç­”ï¼Œå…·ä½“å‚è€ƒå¦‚ä¸‹å®˜æ–¹æ–‡æ¡£ï¼š</p><blockquote><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-introduction.html" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/doc/refman/8.0/en/innodb-introduction.html</a><br><a href="https://dev.mysql.com/doc/refman/8.0/en/myisam-storage-engine.html" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/doc/refman/8.0/en/myisam-storage-engine.html</a></p></blockquote><h4 id="å­˜å‚¨å¼•æ“é€‰æ‹©" tabindex="-1"><a class="header-anchor" href="#å­˜å‚¨å¼•æ“é€‰æ‹©"><span>å­˜å‚¨å¼•æ“é€‰æ‹©</span></a></h4><ul><li>InnoDB: æ˜¯Mysqlçš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œæ”¯æŒäº‹åŠ¡ã€å¤–é”®ã€‚å¦‚æœåº”ç”¨å¯¹äº‹åŠ¡çš„å®Œæ•´æ€§æœ‰æ¯”è¾ƒé«˜çš„è¦æ±‚ï¼Œåœ¨å¹¶å‘æ¡ä»¶ä¸‹è¦æ±‚æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæ•°æ®æ“ä½œé™¤äº†æ’å…¥å’ŒæŸ¥è¯¢ä¹‹å¤–ï¼Œè¿˜åŒ…å«å¾ˆå¤šçš„æ›´æ–°ã€åˆ é™¤æ“ä½œï¼Œé‚£ä¹ˆInnoDBå­˜å‚¨å¼•æ“æ˜¯æ¯”è¾ƒåˆé€‚çš„é€‰æ‹©ã€‚</li><li>MyISAM ï¼š å¦‚æœåº”ç”¨æ˜¯ä»¥è¯»æ“ä½œå’Œæ’å…¥æ“ä½œä¸ºä¸»ï¼Œåªæœ‰å¾ˆå°‘çš„æ›´æ–°å’Œåˆ é™¤æ“ä½œï¼Œå¹¶ä¸”å¯¹äº‹åŠ¡çš„å®Œæ•´æ€§ã€å¹¶å‘æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œé‚£ä¹ˆé€‰æ‹©è¿™ä¸ªå­˜å‚¨å¼•æ“æ˜¯éå¸¸åˆé€‚çš„ã€‚ï¼ˆä¸å¦‚ç›´æ¥ç”¨MongoDBï¼‰</li><li>MEMORYï¼šå°†æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè®¿é—®é€Ÿåº¦å¿«ï¼Œé€šå¸¸ç”¨äºä¸´æ—¶è¡¨åŠç¼“å­˜ã€‚MEMORYçš„ç¼ºé™·å°±æ˜¯å¯¹è¡¨çš„å¤§å°æœ‰é™åˆ¶ï¼Œå¤ªå¤§çš„è¡¨æ— æ³•ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œè€Œä¸”æ— æ³•ä¿éšœæ•°æ®çš„å®‰å…¨æ€§ã€‚ï¼ˆä¸å¦‚ç›´æ¥ç”¨Redisï¼‰</li></ul><h2 id="æ€§èƒ½åˆ†æ" tabindex="-1"><a class="header-anchor" href="#æ€§èƒ½åˆ†æ"><span>æ€§èƒ½åˆ†æ</span></a></h2><h3 id="æŸ¥çœ‹æ‰§è¡Œé¢‘æ¬¡" tabindex="-1"><a class="header-anchor" href="#æŸ¥çœ‹æ‰§è¡Œé¢‘æ¬¡"><span>æŸ¥çœ‹æ‰§è¡Œé¢‘æ¬¡</span></a></h3><p>æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„ INSERT, UPDATE, DELETE, SELECT è®¿é—®é¢‘æ¬¡ï¼š<br><code>SHOW GLOBAL STATUS LIKE &#39;Com_______&#39;;</code> æˆ–è€… <code>SHOW SESSION STATUS LIKE &#39;Com_______&#39;;</code><br> ä¾‹ï¼š<code>show global status like &#39;Com_______&#39;</code>(7ä¸ªä¸‹åˆ’çº¿)</p><h3 id="æ…¢æŸ¥è¯¢æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#æ…¢æŸ¥è¯¢æ—¥å¿—"><span>æ…¢æŸ¥è¯¢æ—¥å¿—</span></a></h3><p>æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•äº†æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡æŒ‡å®šå‚æ•°ï¼ˆlong_query_timeï¼Œå•ä½ï¼šç§’ï¼Œé»˜è®¤10ç§’ï¼‰çš„æ‰€æœ‰SQLè¯­å¥çš„æ—¥å¿—ã€‚<br> MySQLçš„æ…¢æŸ¥è¯¢æ—¥å¿—é»˜è®¤æ²¡æœ‰å¼€å¯ï¼Œéœ€è¦åœ¨MySQLçš„é…ç½®æ–‡ä»¶ï¼ˆ/etc/my.cnfï¼‰ä¸­é…ç½®å¦‚ä¸‹ä¿¡æ¯ï¼š</p><h2 id="å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—å¼€å…³" tabindex="-1"><a class="header-anchor" href="#å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—å¼€å…³"><span>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—å¼€å…³</span></a></h2><p>slow_query_log=1</p><h2 id="è®¾ç½®æ…¢æŸ¥è¯¢æ—¥å¿—çš„æ—¶é—´ä¸º2ç§’-sqlè¯­å¥æ‰§è¡Œæ—¶é—´è¶…è¿‡2ç§’-å°±ä¼šè§†ä¸ºæ…¢æŸ¥è¯¢-è®°å½•æ…¢æŸ¥è¯¢æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#è®¾ç½®æ…¢æŸ¥è¯¢æ—¥å¿—çš„æ—¶é—´ä¸º2ç§’-sqlè¯­å¥æ‰§è¡Œæ—¶é—´è¶…è¿‡2ç§’-å°±ä¼šè§†ä¸ºæ…¢æŸ¥è¯¢-è®°å½•æ…¢æŸ¥è¯¢æ—¥å¿—"><span>è®¾ç½®æ…¢æŸ¥è¯¢æ—¥å¿—çš„æ—¶é—´ä¸º2ç§’ï¼ŒSQLè¯­å¥æ‰§è¡Œæ—¶é—´è¶…è¿‡2ç§’ï¼Œå°±ä¼šè§†ä¸ºæ…¢æŸ¥è¯¢ï¼Œè®°å½•æ…¢æŸ¥è¯¢æ—¥å¿—</span></a></h2><p>long_query_time=2<br> æ›´æ”¹åè®°å¾—é‡å¯MySQLæœåŠ¡ï¼Œæ—¥å¿—æ–‡ä»¶ä½ç½®ï¼š/var/lib/mysql/localhost-slow.log<br> æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—å¼€å…³çŠ¶æ€ï¼š<br><code>show variables like &#39;slow_query_log&#39;;</code></p><h3 id="profile" tabindex="-1"><a class="header-anchor" href="#profile"><span>profile</span></a></h3><p>show profile èƒ½åœ¨åšSQLä¼˜åŒ–æ—¶å¸®æˆ‘ä»¬äº†è§£æ—¶é—´éƒ½è€—è´¹åœ¨å“ªé‡Œã€‚é€šè¿‡ have_profiling å‚æ•°ï¼Œèƒ½çœ‹åˆ°å½“å‰ MySQL æ˜¯å¦æ”¯æŒ profile æ“ä½œï¼š<br><code>SELECT @@have_profiling;</code><br> profiling é»˜è®¤å…³é—­ï¼Œå¯ä»¥é€šè¿‡setè¯­å¥åœ¨session/globalçº§åˆ«å¼€å¯ profilingï¼š<br><code>SET profiling = 1;</code><br> æŸ¥çœ‹æ‰€æœ‰è¯­å¥çš„è€—æ—¶ï¼š<br><code>show profiles;</code><br> æŸ¥çœ‹æŒ‡å®šquery_idçš„SQLè¯­å¥å„ä¸ªé˜¶æ®µçš„è€—æ—¶ï¼š<br><code>show profile for query query_id;</code><br> æŸ¥çœ‹æŒ‡å®šquery_idçš„SQLè¯­å¥CPUçš„ä½¿ç”¨æƒ…å†µ<br><code>show profile cpu for query query_id;</code></p><h3 id="explain" tabindex="-1"><a class="header-anchor" href="#explain"><span>explain</span></a></h3><p>EXPLAIN æˆ–è€… DESC å‘½ä»¤è·å– MySQL å¦‚ä½•æ‰§è¡Œ SELECT è¯­å¥çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬åœ¨ SELECT è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­è¡¨å¦‚ä½•è¿æ¥å’Œè¿æ¥çš„é¡ºåºã€‚<br> è¯­æ³•ï¼š</p><h2 id="ç›´æ¥åœ¨selectè¯­å¥ä¹‹å‰åŠ ä¸Šå…³é”®å­—-explain-desc" tabindex="-1"><a class="header-anchor" href="#ç›´æ¥åœ¨selectè¯­å¥ä¹‹å‰åŠ ä¸Šå…³é”®å­—-explain-desc"><span>ç›´æ¥åœ¨selectè¯­å¥ä¹‹å‰åŠ ä¸Šå…³é”®å­— explain / desc</span></a></h2><p>EXPLAIN SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å HWERE æ¡ä»¶;<br> EXPLAIN å„å­—æ®µå«ä¹‰ï¼š</p><ul><li>idï¼šselect æŸ¥è¯¢çš„åºåˆ—å·ï¼Œè¡¨ç¤ºæŸ¥è¯¢ä¸­æ‰§è¡Œ select å­å¥æˆ–è€…æ“ä½œè¡¨çš„é¡ºåºï¼ˆidç›¸åŒï¼Œæ‰§è¡Œé¡ºåºä»ä¸Šåˆ°ä¸‹ï¼›idä¸åŒï¼Œå€¼è¶Šå¤§è¶Šå…ˆæ‰§è¡Œï¼‰</li><li>select_typeï¼šè¡¨ç¤º SELECT çš„ç±»å‹ï¼Œå¸¸è§å–å€¼æœ‰ SIMPLEï¼ˆç®€å•è¡¨ï¼Œå³ä¸é€‚ç”¨è¡¨è¿æ¥æˆ–è€…å­æŸ¥è¯¢ï¼‰ã€PRIMARYï¼ˆä¸»æŸ¥è¯¢ï¼Œå³å¤–å±‚çš„æŸ¥è¯¢ï¼‰ã€UNIONï¼ˆUNIONä¸­çš„ç¬¬äºŒä¸ªæˆ–è€…åé¢çš„æŸ¥è¯¢è¯­å¥ï¼‰ã€SUBQUERYï¼ˆSELECT/WHEREä¹‹ååŒ…å«äº†å­æŸ¥è¯¢ï¼‰ç­‰</li><li>typeï¼šè¡¨ç¤ºè¿æ¥ç±»å‹ï¼Œæ€§èƒ½ç”±å¥½åˆ°å·®çš„è¿æ¥ç±»å‹ä¸º NULLã€systemã€constã€eq_refã€refã€rangeã€indexã€all <ul><li>å¸¸è§çš„æ‰«ææ–¹å¼<br> 1ã€systemï¼šç³»ç»Ÿè¡¨ï¼Œå°‘é‡æ•°æ®ï¼Œå¾€å¾€ä¸éœ€è¦è¿›è¡Œç£ç›˜IOï¼›<br> 2ã€constï¼šå¸¸é‡è¿æ¥ï¼›<br> 3ã€eq_refï¼šä¸»é”®ç´¢å¼•(primary key)æˆ–è€…éç©ºå”¯ä¸€ç´¢å¼•(unique not null)ç­‰å€¼æ‰«æï¼›<br> 4ã€refï¼šéä¸»é”®éå”¯ä¸€ç´¢å¼•ç­‰å€¼æ‰«æï¼›<br> 5ã€rangeï¼šèŒƒå›´æ‰«æï¼›<br> 6ã€indexï¼šç´¢å¼•æ ‘æ‰«æï¼›<br> 7ã€ALLï¼šå…¨è¡¨æ‰«æ(full table scan)ï¼›</li><li>å„æ‰«æç±»å‹çš„è¦ç‚¹</li></ul></li></ul><p>1ã€systemæœ€å¿«ï¼šä¸è¿›è¡Œç£ç›˜IOã€€ã€€<br> ã€€ã€€2ã€constï¼šPKæˆ–è€…uniqueä¸Šçš„ç­‰å€¼æŸ¥è¯¢<br> ã€€ã€€3ã€eq_refï¼šPKæˆ–è€…uniqueä¸Šçš„joinæŸ¥è¯¢ï¼Œç­‰å€¼åŒ¹é…ï¼Œå¯¹äºå‰è¡¨çš„æ¯ä¸€è¡Œ(row)ï¼Œåè¡¨åªæœ‰ä¸€è¡Œå‘½ä¸­<br> ã€€ã€€4ã€refï¼šéå”¯ä¸€ç´¢å¼•ï¼Œç­‰å€¼åŒ¹é…ï¼Œå¯èƒ½æœ‰å¤šè¡Œå‘½ä¸­<br> ã€€ã€€5ã€rangeï¼šç´¢å¼•ä¸Šçš„èŒƒå›´æ‰«æï¼Œä¾‹å¦‚ï¼šbetween/in/&gt;<br> ã€€ã€€6ã€indexï¼šç´¢å¼•ä¸Šçš„å…¨é›†æ‰«æï¼Œä¾‹å¦‚ï¼šInnoDBçš„count<br> ã€€ã€€7ã€ALLæœ€æ…¢ï¼šå…¨è¡¨æ‰«æ(full table scan)</p><ul><li>possible_keyï¼šå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸Šçš„ç´¢å¼•ï¼Œä¸€ä¸ªæˆ–å¤šä¸ª</li><li>Keyï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œå¦‚æœä¸º NULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•</li><li>Key_lenï¼šè¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œè¯¥å€¼ä¸ºç´¢å¼•å­—æ®µæœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿åº¦ï¼Œåœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„å‰æä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½</li><li>rowsï¼šMySQLè®¤ä¸ºå¿…é¡»è¦æ‰§è¡Œçš„è¡Œæ•°ï¼Œåœ¨InnoDBå¼•æ“çš„è¡¨ä¸­ï¼Œæ˜¯ä¸€ä¸ªä¼°è®¡å€¼ï¼Œå¯èƒ½å¹¶ä¸æ€»æ˜¯å‡†ç¡®çš„</li><li>filteredï¼šè¡¨ç¤ºè¿”å›ç»“æœçš„è¡Œæ•°å éœ€è¯»å–è¡Œæ•°çš„ç™¾åˆ†æ¯”ï¼Œfilteredçš„å€¼è¶Šå¤§è¶Šå¥½</li></ul><h2 id="ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•"><span>ç´¢å¼•</span></a></h2><p>ç´¢å¼•æ˜¯å¸®åŠ© MySQL <strong>é«˜æ•ˆè·å–æ•°æ®</strong>çš„<strong>æ•°æ®ç»“æ„ï¼ˆæœ‰åºï¼‰</strong>ã€‚åœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ä¸Šå®ç°é«˜çº§æŸ¥è¯¢ç®—æ³•ï¼Œè¿™ç§æ•°æ®ç»“æ„å°±æ˜¯ç´¢å¼•ã€‚<br> ä¼˜ç‚¹ï¼š</p><ul><li>æé«˜æ•°æ®æ£€ç´¢æ•ˆç‡ï¼Œé™ä½æ•°æ®åº“çš„IOæˆæœ¬</li><li>é€šè¿‡ç´¢å¼•åˆ—å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œé™ä½æ•°æ®æ’åºçš„æˆæœ¬ï¼Œé™ä½CPUçš„æ¶ˆè€—</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ç´¢å¼•åˆ—ä¹Ÿæ˜¯è¦å ç”¨ç©ºé—´çš„</li><li>ç´¢å¼•å¤§å¤§æé«˜äº†æŸ¥è¯¢æ•ˆç‡ï¼Œä½†é™ä½äº†æ›´æ–°çš„é€Ÿåº¦ï¼Œæ¯”å¦‚ INSERTã€UPDATEã€DELETE</li></ul><h3 id="ç´¢å¼•ç»“æ„" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•ç»“æ„"><span>ç´¢å¼•ç»“æ„</span></a></h3><table><thead><tr><th>ç´¢å¼•ç»“æ„</th><th>æè¿°</th></tr></thead><tbody><tr><td>B+Tree</td><td>æœ€å¸¸è§çš„ç´¢å¼•ç±»å‹ï¼Œå¤§éƒ¨åˆ†å¼•æ“éƒ½æ”¯æŒB+æ ‘ç´¢å¼•</td></tr><tr><td>Hash</td><td>åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”¨å“ˆå¸Œè¡¨å®ç°ï¼Œåªæœ‰ç²¾ç¡®åŒ¹é…ç´¢å¼•åˆ—çš„æŸ¥è¯¢æ‰æœ‰æ•ˆï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢</td></tr><tr><td>R-Tree(ç©ºé—´ç´¢å¼•)</td><td>ç©ºé—´ç´¢å¼•æ˜¯ MyISAM å¼•æ“çš„ä¸€ä¸ªç‰¹æ®Šç´¢å¼•ç±»å‹ï¼Œä¸»è¦ç”¨äºåœ°ç†ç©ºé—´æ•°æ®ç±»å‹ï¼Œé€šå¸¸ä½¿ç”¨è¾ƒå°‘</td></tr><tr><td>Full-Text(å…¨æ–‡ç´¢å¼•)</td><td>æ˜¯ä¸€ç§é€šè¿‡å»ºç«‹å€’æ’ç´¢å¼•ï¼Œå¿«é€ŸåŒ¹é…æ–‡æ¡£çš„æ–¹å¼ï¼Œç±»ä¼¼äº Lucene, Solr, ES</td></tr></tbody></table><table><thead><tr><th>ç´¢å¼•</th><th>InnoDB</th><th>MyISAM</th><th>Memory</th></tr></thead><tbody><tr><td>B+Treeç´¢å¼•</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>Hashç´¢å¼•</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>R-Treeç´¢å¼•</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>Full-text</td><td>5.6ç‰ˆæœ¬åæ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr></tbody></table><h4 id="äºŒå‰æ ‘" tabindex="-1"><a class="header-anchor" href="#äºŒå‰æ ‘"><span>äºŒå‰æ ‘</span></a></h4><p><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/index01.png" alt="image.png" loading="lazy"><br> äºŒå‰æ ‘çš„ç¼ºç‚¹å¯ä»¥ç”¨çº¢é»‘æ ‘æ¥è§£å†³ï¼š<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/index02.png" alt="image.png" loading="lazy"><br> ç”±äºçº¢é»‘æ ‘ä¹Ÿæ˜¯ä¸€é¢—äºŒå‰æ ‘ï¼Œæ‰€ä»¥ä¹Ÿä¼šå­˜åœ¨ä¸€ä¸ªç¼ºç‚¹ï¼š</p><ul><li>å¤§æ•°æ®é‡æƒ…å†µä¸‹ï¼Œå±‚çº§è¾ƒæ·±ï¼Œæ£€ç´¢é€Ÿåº¦æ…¢ã€‚</li></ul><h4 id="b-æ ‘" tabindex="-1"><a class="header-anchor" href="#b-æ ‘"><span>B-æ ‘</span></a></h4><p>B-Treeï¼ŒBæ ‘æ˜¯ä¸€ç§å¤šå‰è·¯è¡¡æŸ¥æ‰¾æ ‘ï¼Œç›¸å¯¹äºäºŒå‰æ ‘ï¼ŒBæ ‘æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªåˆ†æ”¯ï¼Œå³å¤šå‰ã€‚<br> ä»¥ä¸€é¢—æœ€å¤§åº¦æ•°ï¼ˆmax-degreeï¼‰ä¸º5(5é˜¶)çš„b-treeä¸ºä¾‹ï¼Œé‚£è¿™ä¸ªBæ ‘æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå­˜å‚¨4ä¸ªkeyï¼Œ5ä¸ªæŒ‡é’ˆï¼š<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/index03.png" alt="image.png" loading="lazy"><br> æ ‘çš„åº¦æ•°æŒ‡çš„æ˜¯ä¸€ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•°ã€‚<br> ç‰¹ç‚¹ï¼š</p><ul><li>5é˜¶çš„Bæ ‘ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šå­˜å‚¨4ä¸ªkeyï¼Œå¯¹åº”5ä¸ªæŒ‡é’ˆã€‚</li><li>ä¸€æ—¦èŠ‚ç‚¹å­˜å‚¨çš„keyæ•°é‡åˆ°è¾¾5ï¼Œå°±ä¼šè£‚å˜ï¼Œä¸­é—´å…ƒç´ å‘ä¸Šåˆ†è£‚ã€‚</li><li>åœ¨Bæ ‘ä¸­ï¼Œéå¶å­èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹éƒ½ä¼šå­˜æ”¾æ•°æ®ã€‚</li></ul><p>æ•°æ®ç»“æ„æ¼”ç¤ºåœ°å€ï¼š</p><blockquote><p><a href="https://www.cs.usfca.edu/~galles/visualization/BTree.html" target="_blank" rel="noopener noreferrer">https://www.cs.usfca.edu/~galles/visualization/BTree.html</a></p></blockquote><h4 id="b-æ ‘-1" tabindex="-1"><a class="header-anchor" href="#b-æ ‘-1"><span>B+æ ‘</span></a></h4><p>B+æ ‘æ˜¯Bæ ‘çš„å˜ç§ï¼Œç»“æ„å›¾ï¼š</p><ul><li>ç»¿è‰²æ¡†æ¡†èµ·æ¥çš„éƒ¨åˆ†ï¼Œæ˜¯ç´¢å¼•éƒ¨åˆ†ï¼Œä»…ä»…èµ·åˆ°ç´¢å¼•æ•°æ®çš„ä½œç”¨ï¼Œä¸å­˜å‚¨æ•°æ®ã€‚</li><li>çº¢è‰²æ¡†æ¡†èµ·æ¥çš„éƒ¨åˆ†ï¼Œæ˜¯æ•°æ®å­˜å‚¨éƒ¨åˆ†ï¼Œåœ¨å…¶å¶å­èŠ‚ç‚¹ä¸­è¦å­˜å‚¨å…·ä½“çš„æ•°æ®</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/index04.png" alt="image.png" loading="lazy"><br> ç‰¹ç‚¹ï¼š</p><ul><li>æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šå‡ºç°åœ¨å¶å­èŠ‚ç‚¹ã€‚</li><li>å¶å­èŠ‚ç‚¹å½¢æˆä¸€ä¸ªå•å‘é“¾è¡¨ã€‚</li><li>éå¶å­èŠ‚ç‚¹ä»…ä»…èµ·åˆ°ç´¢å¼•æ•°æ®ä½œç”¨ï¼Œå…·ä½“çš„æ•°æ®éƒ½æ˜¯åœ¨å¶å­èŠ‚ç‚¹å­˜æ”¾çš„ã€‚</li></ul><h4 id="mysqlä¼˜åŒ–çš„b-æ ‘" tabindex="-1"><a class="header-anchor" href="#mysqlä¼˜åŒ–çš„b-æ ‘"><span>MySQLä¼˜åŒ–çš„B+æ ‘</span></a></h4><p>MySQL ç´¢å¼•æ•°æ®ç»“æ„å¯¹ç»å…¸çš„ B+Tree è¿›è¡Œäº†ä¼˜åŒ–ã€‚åœ¨åŸ B+Tree çš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹çš„é“¾è¡¨æŒ‡é’ˆï¼Œå°±å½¢æˆäº†å¸¦æœ‰é¡ºåºæŒ‡é’ˆçš„ B+Treeï¼Œæé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/index05.png" alt="image.png" loading="lazy"></p><h4 id="hash" tabindex="-1"><a class="header-anchor" href="#hash"><span>Hash</span></a></h4><p>å“ˆå¸Œç´¢å¼•å°±æ˜¯é‡‡ç”¨ä¸€å®šçš„hashç®—æ³•ï¼Œå°†é”®å€¼æ¢ç®—æˆæ–°çš„hashå€¼ï¼Œæ˜ å°„åˆ°å¯¹åº”çš„æ§½ä½ä¸Šï¼Œç„¶åå­˜å‚¨åœ¨hashè¡¨ä¸­ã€‚<br> å¦‚æœä¸¤ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰é”®å€¼ï¼Œæ˜ å°„åˆ°ä¸€ä¸ªç›¸åŒçš„æ§½ä½ä¸Šï¼Œä»–ä»¬å°±äº§ç”Ÿäº†hashå†²çªï¼ˆä¹Ÿç§°ä¸ºhashç¢°æ’ï¼‰ï¼Œå¯ä»¥é€šè¿‡é“¾è¡¨æ¥è§£å†³ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/index06.png" alt="image.png" loading="lazy"><br> ç‰¹ç‚¹ï¼š</p><ul><li>Hashç´¢å¼•åªèƒ½ç”¨äºå¯¹ç­‰æ¯”è¾ƒï¼ˆ=ã€inï¼‰ï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ˆbetwwnã€&gt;ã€&lt;ã€...ï¼‰</li><li>æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆæ’åºæ“ä½œ</li><li>æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œé€šå¸¸åªéœ€è¦ä¸€æ¬¡æ£€ç´¢å°±å¯ä»¥äº†ï¼Œæ•ˆç‡é€šå¸¸è¦é«˜äº B+Tree ç´¢å¼•</li></ul><p>å­˜å‚¨å¼•æ“æ”¯æŒï¼š</p><ul><li>Memory</li><li>InnoDB: å…·æœ‰è‡ªé€‚åº”hashåŠŸèƒ½ï¼Œhashç´¢å¼•æ˜¯å­˜å‚¨å¼•æ“æ ¹æ® B+Tree ç´¢å¼•åœ¨æŒ‡å®šæ¡ä»¶ä¸‹è‡ªåŠ¨æ„å»ºçš„</li></ul><h4 id="é¢è¯•é¢˜" tabindex="-1"><a class="header-anchor" href="#é¢è¯•é¢˜"><span>é¢è¯•é¢˜</span></a></h4><ol><li>ä¸ºä»€ä¹ˆ InnoDB å­˜å‚¨å¼•æ“é€‰æ‹©ä½¿ç”¨ B+Tree ç´¢å¼•ç»“æ„ï¼Ÿ</li></ol><ul><li>ç›¸å¯¹äºäºŒå‰æ ‘ï¼Œå±‚çº§æ›´å°‘ï¼Œæœç´¢æ•ˆç‡é«˜</li><li>å¯¹äº B-Treeï¼Œæ— è®ºæ˜¯å¶å­èŠ‚ç‚¹è¿˜æ˜¯éå¶å­èŠ‚ç‚¹ï¼Œéƒ½ä¼šä¿å­˜æ•°æ®ï¼Œè¿™æ ·å¯¼è‡´ä¸€é¡µä¸­å­˜å‚¨çš„é”®å€¼å‡å°‘ï¼ŒæŒ‡é’ˆä¹Ÿè·Ÿç€å‡å°‘ï¼Œè¦åŒæ ·ä¿å­˜å¤§é‡æ•°æ®ï¼Œåªèƒ½å¢åŠ æ ‘çš„é«˜åº¦ï¼Œå¯¼è‡´æ€§èƒ½é™ä½</li><li>ç›¸å¯¹äº Hash ç´¢å¼•ï¼ŒB+Tree æ”¯æŒèŒƒå›´åŒ¹é…åŠæ’åºæ“ä½œ</li></ul><h3 id="ç´¢å¼•åˆ†ç±»" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•åˆ†ç±»"><span>ç´¢å¼•åˆ†ç±»</span></a></h3><table><thead><tr><th>åˆ†ç±»</th><th>å«ä¹‰</th><th>ç‰¹ç‚¹</th><th>å…³é”®å­—</th></tr></thead><tbody><tr><td>ä¸»é”®ç´¢å¼•</td><td>é’ˆå¯¹äºè¡¨ä¸­ä¸»é”®åˆ›å»ºçš„ç´¢å¼•</td><td>é»˜è®¤è‡ªåŠ¨åˆ›å»ºï¼Œåªèƒ½æœ‰ä¸€ä¸ª</td><td>PRIMARY</td></tr><tr><td>å”¯ä¸€ç´¢å¼•</td><td>é¿å…åŒä¸€ä¸ªè¡¨ä¸­æŸæ•°æ®åˆ—ä¸­çš„å€¼é‡å¤</td><td>å¯ä»¥æœ‰å¤šä¸ª</td><td>UNIQUE</td></tr><tr><td>å¸¸è§„ç´¢å¼•</td><td>å¿«é€Ÿå®šä½ç‰¹å®šæ•°æ®</td><td>å¯ä»¥æœ‰å¤šä¸ª</td><td></td></tr><tr><td>å…¨æ–‡ç´¢å¼•</td><td>å…¨æ–‡ç´¢å¼•æŸ¥æ‰¾çš„æ˜¯æ–‡æœ¬ä¸­çš„å…³é”®è¯ï¼Œè€Œä¸æ˜¯æ¯”è¾ƒç´¢å¼•ä¸­çš„å€¼</td><td>å¯ä»¥æœ‰å¤šä¸ª</td><td>FULLTEXT</td></tr></tbody></table><h4 id="èšé›†ç´¢å¼•-äºŒçº§ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#èšé›†ç´¢å¼•-äºŒçº§ç´¢å¼•"><span>èšé›†ç´¢å¼•&amp;äºŒçº§ç´¢å¼•</span></a></h4><p>åœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œæ ¹æ®ç´¢å¼•çš„å­˜å‚¨å½¢å¼ï¼Œåˆå¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§ï¼š</p><table><thead><tr><th>åˆ†ç±»</th><th>å«ä¹‰</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>èšé›†ç´¢å¼•(Clustered Index)</td><td>å°†æ•°æ®å­˜å‚¨ä¸ç´¢å¼•æ”¾ä¸€å—ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹ä¿å­˜äº†è¡Œæ•°æ®</td><td>å¿…é¡»æœ‰ï¼Œè€Œä¸”åªæœ‰ä¸€ä¸ª</td></tr><tr><td>äºŒçº§ç´¢å¼•(Secondary Index)</td><td>å°†æ•°æ®ä¸ç´¢å¼•åˆ†å¼€å­˜å‚¨ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹å…³è”çš„æ˜¯å¯¹åº”çš„ä¸»é”®</td><td>å¯ä»¥å­˜åœ¨å¤šä¸ª</td></tr></tbody></table><p>æ¼”ç¤ºå›¾ï¼š<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/index07.png" alt="image.png" loading="lazy"><br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/index08.png" alt="image.png" loading="lazy"><br> è¯­å¥æ‰§è¡Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹:<br> â‘ . ç”±äºæ˜¯æ ¹æ®nameå­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥å…ˆæ ¹æ®name=&#39;Arm&#39;åˆ°nameå­—æ®µçš„äºŒçº§ç´¢å¼•ä¸­è¿›è¡ŒåŒ¹é…æŸ¥æ‰¾ã€‚ä½†æ˜¯åœ¨äºŒçº§ç´¢å¼•ä¸­åªèƒ½æŸ¥æ‰¾åˆ° Arm å¯¹åº”çš„ä¸»é”®å€¼ 10ã€‚<br> â‘¡. ç”±äºæŸ¥è¯¢è¿”å›çš„æ•°æ®æ˜¯*ï¼Œæ‰€ä»¥æ­¤æ—¶ï¼Œè¿˜éœ€è¦æ ¹æ®ä¸»é”®å€¼10ï¼Œåˆ°èšé›†ç´¢å¼•ä¸­æŸ¥æ‰¾10å¯¹åº”çš„è®°å½•ï¼Œæœ€ç»ˆæ‰¾åˆ°10å¯¹åº”çš„è¡Œrowã€‚<br> â‘¢. æœ€ç»ˆæ‹¿åˆ°è¿™ä¸€è¡Œçš„æ•°æ®ï¼Œç›´æ¥è¿”å›å³å¯ã€‚<br> èšé›†ç´¢å¼•é€‰å–è§„åˆ™ï¼š</p><ul><li>å¦‚æœå­˜åœ¨ä¸»é”®ï¼Œä¸»é”®ç´¢å¼•å°±æ˜¯èšé›†ç´¢å¼•</li><li>å¦‚æœä¸å­˜åœ¨ä¸»é”®ï¼Œå°†ä½¿ç”¨ç¬¬ä¸€ä¸ªå”¯ä¸€(UNIQUE)ç´¢å¼•ä½œä¸ºèšé›†ç´¢å¼•</li><li>å¦‚æœè¡¨æ²¡æœ‰ä¸»é”®æˆ–æ²¡æœ‰åˆé€‚çš„å”¯ä¸€ç´¢å¼•ï¼Œåˆ™ InnoDB ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª rowid ä½œä¸ºéšè—çš„èšé›†ç´¢å¼•</li></ul><h4 id="æ€è€ƒé¢˜" tabindex="-1"><a class="header-anchor" href="#æ€è€ƒé¢˜"><span>æ€è€ƒé¢˜</span></a></h4><ol><li>ä»¥ä¸‹ SQL è¯­å¥ï¼Œå“ªä¸ªæ‰§è¡Œæ•ˆç‡é«˜ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">&#39;Arm&#39;</span><span class="token punctuation">;</span>
<span class="token comment">-- å¤‡æ³¨ï¼šidä¸ºä¸»é”®ï¼Œnameå­—æ®µåˆ›å»ºçš„æœ‰ç´¢å¼•</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç­”ï¼šç¬¬ä¸€æ¡è¯­å¥ï¼Œå› ä¸ºç¬¬äºŒæ¡éœ€è¦å›è¡¨æŸ¥è¯¢ï¼Œç›¸å½“äºä¸¤ä¸ªæ­¥éª¤ã€‚<br> 2. InnoDB ä¸»é”®ç´¢å¼•çš„ B+Tree é«˜åº¦ä¸ºå¤šå°‘ï¼Ÿ<br> ç­”ï¼šå‡è®¾ä¸€è¡Œæ•°æ®å¤§å°ä¸º1kï¼Œä¸€é¡µä¸­å¯ä»¥å­˜å‚¨16è¡Œè¿™æ ·çš„æ•°æ®ã€‚InnoDB çš„æŒ‡é’ˆå ç”¨6ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œä¸»é”®å‡è®¾ä¸ºbigintï¼Œå ç”¨å­—èŠ‚æ•°ä¸º8.<br> å¯å¾—å…¬å¼ï¼š<code>n * 8 + (n + 1) * 6 = 16 * 1024</code>ï¼Œå…¶ä¸­ 8 è¡¨ç¤º bigint å ç”¨çš„å­—èŠ‚æ•°ï¼Œn è¡¨ç¤ºå½“å‰èŠ‚ç‚¹å­˜å‚¨çš„keyçš„æ•°é‡ï¼Œ(n + 1) è¡¨ç¤ºæŒ‡é’ˆæ•°é‡ï¼ˆæ¯”keyå¤šä¸€ä¸ªï¼‰ã€‚ç®—å‡ºnçº¦ä¸º1170ã€‚<br> å¦‚æœæ ‘çš„é«˜åº¦ä¸º2ï¼Œé‚£ä¹ˆä»–èƒ½å­˜å‚¨çš„æ•°æ®é‡å¤§æ¦‚ä¸ºï¼š<code>1171 * 16 = 18736</code>ï¼›<br> å¦‚æœæ ‘çš„é«˜åº¦ä¸º3ï¼Œé‚£ä¹ˆä»–èƒ½å­˜å‚¨çš„æ•°æ®é‡å¤§æ¦‚ä¸ºï¼š<code>1171 * 1171 * 16 = 21939856</code>ã€‚<br> å¦å¤–ï¼Œå¦‚æœæœ‰æˆåƒä¸Šä¸‡çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±è¦è€ƒè™‘åˆ†è¡¨ï¼Œæ¶‰åŠè¿ç»´ç¯‡çŸ¥è¯†ã€‚</p><h3 id="ç´¢å¼•è¯­æ³•" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•è¯­æ³•"><span>ç´¢å¼•è¯­æ³•</span></a></h3><ul><li>åˆ›å»ºç´¢å¼•ï¼š<br><code>CREATE [ UNIQUE | FULLTEXT ] INDEX index_name ON table_name (index_col_name, ...);</code><br> å¦‚æœä¸åŠ  CREATE åé¢ä¸åŠ ç´¢å¼•ç±»å‹å‚æ•°ï¼Œåˆ™åˆ›å»ºçš„æ˜¯å¸¸è§„ç´¢å¼•</li><li>æŸ¥çœ‹ç´¢å¼•ï¼š<br><code>SHOW INDEX FROM table_name;</code></li><li>åˆ é™¤ç´¢å¼•ï¼š<br><code>DROP INDEX index_name ON table_name;</code></li><li>æ¡ˆä¾‹ï¼š</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- nameå­—æ®µä¸ºå§“åå­—æ®µï¼Œè¯¥å­—æ®µçš„å€¼å¯èƒ½ä¼šé‡å¤ï¼Œä¸ºè¯¥å­—æ®µåˆ›å»ºç´¢å¼•</span>
<span class="token keyword">create</span> <span class="token keyword">index</span> idx_user_name <span class="token keyword">on</span> tb_user<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- phoneæ‰‹æœºå·å­—æ®µçš„å€¼éç©ºï¼Œä¸”å”¯ä¸€ï¼Œä¸ºè¯¥å­—æ®µåˆ›å»ºå”¯ä¸€ç´¢å¼•</span>
<span class="token keyword">create</span> <span class="token keyword">unique</span> <span class="token keyword">index</span> idx_user_phone <span class="token keyword">on</span> tb_user <span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- ä¸ºprofession, age, statusåˆ›å»ºè”åˆç´¢å¼•</span>
<span class="token keyword">create</span> <span class="token keyword">index</span> idx_user_pro_age_stat <span class="token keyword">on</span> tb_user<span class="token punctuation">(</span>profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- ä¸ºemailå»ºç«‹åˆé€‚çš„ç´¢å¼•æ¥æå‡æŸ¥è¯¢æ•ˆç‡</span>
<span class="token keyword">create</span> <span class="token keyword">index</span> idx_user_email <span class="token keyword">on</span> tb_user<span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- åˆ é™¤ç´¢å¼•</span>
<span class="token keyword">drop</span> <span class="token keyword">index</span> idx_user_email <span class="token keyword">on</span> tb_user<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä½¿ç”¨è§„åˆ™" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨è§„åˆ™"><span>ä½¿ç”¨è§„åˆ™</span></a></h3><h4 id="æœ€å·¦å‰ç¼€æ³•åˆ™" tabindex="-1"><a class="header-anchor" href="#æœ€å·¦å‰ç¼€æ³•åˆ™"><span>æœ€å·¦å‰ç¼€æ³•åˆ™</span></a></h4><p>å¦‚æœç´¢å¼•å…³è”äº†å¤šåˆ—ï¼ˆè”åˆç´¢å¼•ï¼‰ï¼Œè¦éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™ï¼Œæœ€å·¦å‰ç¼€æ³•åˆ™æŒ‡çš„æ˜¯æŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹ï¼Œå¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚<br> å¦‚æœè·³è·ƒæŸä¸€åˆ—ï¼Œç´¢å¼•å°†éƒ¨åˆ†å¤±æ•ˆï¼ˆåé¢çš„å­—æ®µç´¢å¼•å¤±æ•ˆï¼‰ã€‚<br> è”åˆç´¢å¼•ä¸­ï¼Œå‡ºç°èŒƒå›´æŸ¥è¯¢ï¼ˆ&lt;, &gt;ï¼‰ï¼ŒèŒƒå›´æŸ¥è¯¢å³ä¾§çš„åˆ—ç´¢å¼•å¤±æ•ˆã€‚å¯ä»¥ç”¨&gt;=æˆ–è€…&lt;=æ¥è§„é¿ç´¢å¼•å¤±æ•ˆé—®é¢˜ã€‚</p><h4 id="ç´¢å¼•å¤±æ•ˆæƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•å¤±æ•ˆæƒ…å†µ"><span>ç´¢å¼•å¤±æ•ˆæƒ…å†µ</span></a></h4><ol><li>åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè¿ç®—æ“ä½œï¼Œç´¢å¼•å°†å¤±æ•ˆã€‚å¦‚ï¼š<code>explain select * from tb_user where substring(phone, 10, 2) = &#39;15&#39;;</code></li><li>å­—ç¬¦ä¸²ç±»å‹å­—æ®µä½¿ç”¨æ—¶ï¼Œä¸åŠ å¼•å·ï¼Œç´¢å¼•å°†å¤±æ•ˆã€‚å¦‚ï¼š<code>explain select * from tb_user where phone = 17799990015;</code>ï¼Œæ­¤å¤„phoneçš„å€¼æ²¡æœ‰åŠ å¼•å·</li><li>æ¨¡ç³ŠæŸ¥è¯¢ä¸­ï¼Œå¦‚æœä»…ä»…æ˜¯å°¾éƒ¨æ¨¡ç³ŠåŒ¹é…ï¼Œç´¢å¼•ä¸ä¼šæ˜¯å¤±æ•ˆï¼›å¦‚æœæ˜¯å¤´éƒ¨æ¨¡ç³ŠåŒ¹é…ï¼Œç´¢å¼•å¤±æ•ˆã€‚å¦‚ï¼š<code>explain select * from tb_user where profession like &#39;%å·¥ç¨‹&#39;;</code>ï¼Œå‰åéƒ½æœ‰ % ä¹Ÿä¼šå¤±æ•ˆã€‚</li><li>ç”¨ or åˆ†å‰²å¼€çš„æ¡ä»¶ï¼Œå¦‚æœ or å…¶ä¸­ä¸€ä¸ªæ¡ä»¶çš„åˆ—æ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆæ¶‰åŠçš„ç´¢å¼•éƒ½ä¸ä¼šè¢«ç”¨åˆ°ã€‚</li><li>å¦‚æœ MySQL è¯„ä¼°ä½¿ç”¨ç´¢å¼•æ¯”å…¨è¡¨æ›´æ…¢ï¼Œåˆ™ä¸ä½¿ç”¨ç´¢å¼•ã€‚</li></ol><h4 id="sql-æç¤º" tabindex="-1"><a class="header-anchor" href="#sql-æç¤º"><span>SQL æç¤º</span></a></h4><p>æ˜¯ä¼˜åŒ–æ•°æ®åº“çš„ä¸€ä¸ªé‡è¦æ‰‹æ®µï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨SQLè¯­å¥ä¸­åŠ å…¥ä¸€äº›äººä¸ºçš„æç¤ºæ¥è¾¾åˆ°ä¼˜åŒ–æ“ä½œçš„ç›®çš„ã€‚<br> å»ºè®®ä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼š<br><code>explain select * from tb_user use index(idx_user_pro) where profession=&quot;è½¯ä»¶å·¥ç¨‹&quot;;</code><br> ä¸ä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼š<br><code>explain select * from tb_user ignore index(idx_user_pro) where profession=&quot;è½¯ä»¶å·¥ç¨‹&quot;;</code><br> å¿…é¡»ä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼š<br><code>explain select * from tb_user force index(idx_user_pro) where profession=&quot;è½¯ä»¶å·¥ç¨‹&quot;;</code><br> use æ˜¯å»ºè®®ï¼Œå®é™…ä½¿ç”¨å“ªä¸ªç´¢å¼• MySQL è¿˜ä¼šè‡ªå·±æƒè¡¡è¿è¡Œé€Ÿåº¦å»æ›´æ”¹ï¼Œforceå°±æ˜¯æ— è®ºå¦‚ä½•éƒ½å¼ºåˆ¶ä½¿ç”¨è¯¥ç´¢å¼•ã€‚</p><h4 id="è¦†ç›–ç´¢å¼•-å›è¡¨æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#è¦†ç›–ç´¢å¼•-å›è¡¨æŸ¥è¯¢"><span>è¦†ç›–ç´¢å¼•&amp;å›è¡¨æŸ¥è¯¢</span></a></h4><p>å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆæŸ¥è¯¢ä½¿ç”¨äº†ç´¢å¼•ï¼Œå¹¶ä¸”éœ€è¦è¿”å›çš„åˆ—ï¼Œåœ¨è¯¥ç´¢å¼•ä¸­å·²ç»å…¨éƒ¨èƒ½æ‰¾åˆ°ï¼‰ï¼Œå‡å°‘ select *ã€‚</p><ul><li>explain ä¸­ extra å­—æ®µå«ä¹‰ï¼š<br><code>using index condition</code>ï¼šæŸ¥æ‰¾ä½¿ç”¨äº†ç´¢å¼•ï¼Œä½†æ˜¯éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®<br><code>using where; using index;</code>ï¼šæŸ¥æ‰¾ä½¿ç”¨äº†ç´¢å¼•ï¼Œä½†æ˜¯éœ€è¦çš„æ•°æ®éƒ½åœ¨ç´¢å¼•åˆ—ä¸­èƒ½æ‰¾åˆ°ï¼Œæ‰€ä»¥ä¸éœ€è¦å›è¡¨æŸ¥è¯¢</li><li>å¦‚æœåœ¨èšé›†ç´¢å¼•ä¸­ç›´æ¥èƒ½æ‰¾åˆ°å¯¹åº”çš„è¡Œï¼Œåˆ™ç›´æ¥è¿”å›è¡Œæ•°æ®ï¼Œåªéœ€è¦ä¸€æ¬¡æŸ¥è¯¢ï¼Œå“ªæ€•æ˜¯select *ï¼›å¦‚æœåœ¨è¾…åŠ©ç´¢å¼•ä¸­æ‰¾èšé›†ç´¢å¼•ï¼Œå¦‚<code>select id, name from xxx where name=&#39;xxx&#39;;</code>ï¼Œä¹Ÿåªéœ€è¦é€šè¿‡è¾…åŠ©ç´¢å¼•(name)æŸ¥æ‰¾åˆ°å¯¹åº”çš„idï¼Œè¿”å›nameå’Œnameç´¢å¼•å¯¹åº”çš„idå³å¯ï¼Œåªéœ€è¦ä¸€æ¬¡æŸ¥è¯¢ï¼›å¦‚æœæ˜¯é€šè¿‡è¾…åŠ©ç´¢å¼•æŸ¥æ‰¾å…¶ä»–å­—æ®µï¼Œåˆ™éœ€è¦å›è¡¨æŸ¥è¯¢ï¼Œå¦‚<code>select id, name, gender from xxx where name=&#39;xxx&#39;;</code></li><li>å°½é‡ä¸è¦ç”¨<code>select *</code>ï¼Œå®¹æ˜“å‡ºç°å›è¡¨æŸ¥è¯¢ï¼Œé™ä½æ•ˆç‡ï¼Œé™¤éæœ‰è”åˆç´¢å¼•åŒ…å«äº†æ‰€æœ‰å­—æ®µ</li><li>é¢è¯•é¢˜ï¼šä¸€å¼ è¡¨ï¼Œæœ‰å››ä¸ªå­—æ®µï¼ˆid, username, password, statusï¼‰ï¼Œç”±äºæ•°æ®é‡å¤§ï¼Œéœ€è¦å¯¹ä»¥ä¸‹SQLè¯­å¥è¿›è¡Œä¼˜åŒ–ï¼Œè¯¥å¦‚ä½•è¿›è¡Œæ‰æ˜¯æœ€ä¼˜æ–¹æ¡ˆï¼š<br><code>select id, username, password from tb_user where username=&#39;itcast&#39;;</code><ul><li>è§£ï¼šç»™usernameå’Œpasswordå­—æ®µå»ºç«‹è”åˆç´¢å¼•ï¼Œåˆ™ä¸éœ€è¦å›è¡¨æŸ¥è¯¢ï¼Œç›´æ¥è¦†ç›–ç´¢å¼•</li></ul></li></ul><h4 id="å‰ç¼€ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#å‰ç¼€ç´¢å¼•"><span>å‰ç¼€ç´¢å¼•</span></a></h4><p>å½“å­—æ®µç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼ˆvarchar, textç­‰ï¼‰æ—¶ï¼Œæœ‰æ—¶å€™éœ€è¦ç´¢å¼•å¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¼šè®©ç´¢å¼•å˜å¾—å¾ˆå¤§ï¼ŒæŸ¥è¯¢æ—¶ï¼Œæµªè´¹å¤§é‡çš„ç£ç›˜IOï¼Œå½±å“æŸ¥è¯¢æ•ˆç‡ï¼Œæ­¤æ—¶å¯ä»¥åªé™å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†å‰ç¼€ï¼Œå»ºç«‹ç´¢å¼•ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§èŠ‚çº¦ç´¢å¼•ç©ºé—´ï¼Œä»è€Œæé«˜ç´¢å¼•æ•ˆç‡ã€‚<br> è¯­æ³•ï¼š<code>create index idx_xxxx on table_name(columnn(n));</code><br> å‰ç¼€é•¿åº¦ï¼šå¯ä»¥æ ¹æ®ç´¢å¼•çš„é€‰æ‹©æ€§æ¥å†³å®šï¼Œè€Œé€‰æ‹©æ€§æ˜¯æŒ‡ä¸é‡å¤çš„ç´¢å¼•å€¼ï¼ˆåŸºæ•°ï¼‰å’Œæ•°æ®è¡¨çš„è®°å½•æ€»æ•°çš„æ¯”å€¼ï¼Œç´¢å¼•é€‰æ‹©æ€§è¶Šé«˜åˆ™æŸ¥è¯¢æ•ˆç‡è¶Šé«˜ï¼Œå”¯ä¸€ç´¢å¼•çš„é€‰æ‹©æ€§æ˜¯1ï¼Œè¿™æ˜¯æœ€å¥½çš„ç´¢å¼•é€‰æ‹©æ€§ï¼Œæ€§èƒ½ä¹Ÿæ˜¯æœ€å¥½çš„ã€‚<br> æ±‚é€‰æ‹©æ€§å…¬å¼ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> email<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tb_user<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> substring<span class="token punctuation">(</span>email<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tb_user<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>show index é‡Œé¢çš„sub_partå¯ä»¥çœ‹åˆ°æˆªå–çš„é•¿åº¦</p><h4 id="å•åˆ—ç´¢å¼•-è”åˆç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#å•åˆ—ç´¢å¼•-è”åˆç´¢å¼•"><span>å•åˆ—ç´¢å¼•&amp;è”åˆç´¢å¼•</span></a></h4><p>å•åˆ—ç´¢å¼•ï¼šå³ä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—<br> è”åˆç´¢å¼•ï¼šå³ä¸€ä¸ªç´¢å¼•åŒ…å«äº†å¤šä¸ªåˆ—<br> åœ¨ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œè€ƒè™‘é’ˆå¯¹äºæŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•æ—¶ï¼Œå»ºè®®å»ºç«‹è”åˆç´¢å¼•ï¼Œè€Œéå•åˆ—ç´¢å¼•ã€‚<br> å•åˆ—ç´¢å¼•æƒ…å†µï¼š<br><code>explain select id, phone, name from tb_user where phone = &#39;17799990010&#39; and name = &#39;éŸ©ä¿¡&#39;;</code><br> è¿™å¥åªä¼šç”¨åˆ°phoneç´¢å¼•å­—æ®µ</p><h5 id="æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹"><span>æ³¨æ„äº‹é¡¹</span></a></h5><ul><li>å¤šæ¡ä»¶è”åˆæŸ¥è¯¢æ—¶ï¼ŒMySQLä¼˜åŒ–å™¨ä¼šè¯„ä¼°å“ªä¸ªå­—æ®µçš„ç´¢å¼•æ•ˆç‡æ›´é«˜ï¼Œä¼šé€‰æ‹©è¯¥ç´¢å¼•å®Œæˆæœ¬æ¬¡æŸ¥è¯¢</li></ul><h3 id="è®¾è®¡åŸåˆ™" tabindex="-1"><a class="header-anchor" href="#è®¾è®¡åŸåˆ™"><span>è®¾è®¡åŸåˆ™</span></a></h3><ol><li>é’ˆå¯¹äºæ•°æ®é‡è¾ƒå¤§ï¼Œä¸”æŸ¥è¯¢æ¯”è¾ƒé¢‘ç¹çš„è¡¨å»ºç«‹ç´¢å¼•</li><li>é’ˆå¯¹äºå¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼ˆwhereï¼‰ã€æ’åºï¼ˆorder byï¼‰ã€åˆ†ç»„ï¼ˆgroup byï¼‰æ“ä½œçš„å­—æ®µå»ºç«‹ç´¢å¼•</li><li>å°½é‡é€‰æ‹©åŒºåˆ†åº¦é«˜çš„åˆ—ä½œä¸ºç´¢å¼•ï¼Œå°½é‡å»ºç«‹å”¯ä¸€ç´¢å¼•ï¼ŒåŒºåˆ†åº¦è¶Šé«˜ï¼Œä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡è¶Šé«˜</li><li>å¦‚æœæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µï¼Œå­—æ®µé•¿åº¦è¾ƒé•¿ï¼Œå¯ä»¥é’ˆå¯¹äºå­—æ®µçš„ç‰¹ç‚¹ï¼Œå»ºç«‹å‰ç¼€ç´¢å¼•</li><li>å°½é‡ä½¿ç”¨è”åˆç´¢å¼•ï¼Œå‡å°‘å•åˆ—ç´¢å¼•ï¼ŒæŸ¥è¯¢æ—¶ï¼Œè”åˆç´¢å¼•å¾ˆå¤šæ—¶å€™å¯ä»¥è¦†ç›–ç´¢å¼•ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œé¿å…å›è¡¨ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡</li><li>è¦æ§åˆ¶ç´¢å¼•çš„æ•°é‡ï¼Œç´¢å¼•å¹¶ä¸æ˜¯å¤šå¤šç›Šå–„ï¼Œç´¢å¼•è¶Šå¤šï¼Œç»´æŠ¤ç´¢å¼•ç»“æ„çš„ä»£ä»·å°±è¶Šå¤§ï¼Œä¼šå½±å“å¢åˆ æ”¹çš„æ•ˆç‡</li><li>å¦‚æœç´¢å¼•åˆ—ä¸èƒ½å­˜å‚¨NULLå€¼ï¼Œè¯·åœ¨åˆ›å»ºè¡¨æ—¶ä½¿ç”¨NOT NULLçº¦æŸå®ƒã€‚å½“ä¼˜åŒ–å™¨çŸ¥é“æ¯åˆ—æ˜¯å¦åŒ…å«NULLå€¼æ—¶ï¼Œå®ƒå¯ä»¥æ›´å¥½åœ°ç¡®å®šå“ªä¸ªç´¢å¼•æœ€æœ‰æ•ˆåœ°ç”¨äºæŸ¥è¯¢</li></ol><h2 id="sqlä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#sqlä¼˜åŒ–"><span>SQLä¼˜åŒ–</span></a></h2><h3 id="æ’å…¥æ•°æ®" tabindex="-1"><a class="header-anchor" href="#æ’å…¥æ•°æ®"><span>æ’å…¥æ•°æ®</span></a></h3><h4 id="æ™®é€šæ’å…¥" tabindex="-1"><a class="header-anchor" href="#æ™®é€šæ’å…¥"><span>æ™®é€šæ’å…¥</span></a></h4><ol><li>é‡‡ç”¨æ‰¹é‡æ’å…¥ï¼ˆä¸€æ¬¡æ’å…¥çš„æ•°æ®ä¸å»ºè®®è¶…è¿‡1000æ¡ï¼‰</li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_test <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#39;Tom&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&#39;Cat&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&#39;Jerry&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>æ‰‹åŠ¨æäº¤äº‹åŠ¡</li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">start</span> <span class="token keyword">transaction</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> tb_test <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#39;Tom&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&#39;Cat&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&#39;Jerry&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> tb_test <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">&#39;Tom&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">&#39;Cat&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">&#39;Jerry&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> tb_test <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string">&#39;Tom&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">&#39;Cat&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">&#39;Jerry&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>ä¸»é”®é¡ºåºæ’å…¥<br> ä¸»é”®ä¹±åºæ’å…¥ : 8 1 9 21 88 2 4 15 89 5 7 3 ï¼ˆæ€§èƒ½ä½ï¼‰<br> ä¸»é”®é¡ºåºæ’å…¥ : 1 2 3 4 5 7 8 9 15 21 88 89 ï¼ˆæ€§èƒ½é«˜ï¼‰</li></ol><h4 id="å¤§æ‰¹é‡æ’å…¥" tabindex="-1"><a class="header-anchor" href="#å¤§æ‰¹é‡æ’å…¥"><span>å¤§æ‰¹é‡æ’å…¥</span></a></h4><p>å¦‚æœä¸€æ¬¡æ€§éœ€è¦æ’å…¥å¤§æ‰¹é‡æ•°æ®ï¼Œä½¿ç”¨insertè¯­å¥æ’å…¥æ€§èƒ½è¾ƒä½ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨MySQLæ•°æ®åº“æä¾›çš„loadæŒ‡ä»¤æ’å…¥ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">## å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶ï¼ŒåŠ ä¸Šå‚æ•° --local-infileï¼ˆè¿™ä¸€è¡Œåœ¨bash/cmdç•Œé¢è¾“å…¥ï¼‰</span>
mysql <span class="token comment">--local-infile -u root -p</span>
<span class="token comment">## è®¾ç½®å…¨å±€å‚æ•°local_infileä¸º1ï¼Œå¼€å¯ä»æœ¬åœ°åŠ è½½æ–‡ä»¶å¯¼å…¥æ•°æ®çš„å¼€å…³</span>
<span class="token keyword">set</span> <span class="token keyword">global</span> local_infile <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> @<span class="token variable">@local_infile</span><span class="token punctuation">;</span>
<span class="token comment">## æ‰§è¡ŒloadæŒ‡ä»¤å°†å‡†å¤‡å¥½çš„æ•°æ®ï¼ŒåŠ è½½åˆ°è¡¨ç»“æ„ä¸­</span>
<span class="token comment">## åŒæ ·ï¼šæŒ‰ç…§ä¸»é”®é¡ºåºæ’å…¥çš„æ•ˆç‡è¦æ›´é«˜</span>
<span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> <span class="token keyword">infile</span> <span class="token string">&#39;/root/sql1.log&#39;</span> <span class="token keyword">into</span> <span class="token keyword">table</span> <span class="token string">&#39;tb_user&#39;</span> <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">&#39;,&#39;</span> <span class="token keyword">lines</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">&#39;\n&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¸»é”®ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#ä¸»é”®ä¼˜åŒ–"><span>ä¸»é”®ä¼˜åŒ–</span></a></h3><h4 id="æ•°æ®ç»„ç»‡æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#æ•°æ®ç»„ç»‡æ–¹å¼"><span>æ•°æ®ç»„ç»‡æ–¹å¼</span></a></h4><p>åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œè¡¨æ•°æ®éƒ½æ˜¯æ ¹æ®ä¸»é”®é¡ºåºç»„ç»‡å­˜æ”¾çš„ï¼Œè¿™ç§å­˜å‚¨æ–¹å¼çš„è¡¨ç§°ä¸ºç´¢å¼•ç»„ç»‡è¡¨(index organized table IOT)ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/sql01.png" alt="image.png" loading="lazy"><br> è¡Œæ•°æ®ï¼Œéƒ½æ˜¯å­˜å‚¨åœ¨èšé›†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸Šçš„ã€‚InnoDBçš„é€»è¾‘ç»“æ„å›¾ï¼š<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/sql02.png" alt="image.png" loading="lazy"><br> InnoDBå¼•æ“ä¸­ï¼Œæ•°æ®è¡Œæ˜¯è®°å½•åœ¨é€»è¾‘ç»“æ„ page é¡µä¸­çš„ï¼Œè€Œæ¯ä¸€ä¸ªé¡µçš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œé»˜è®¤16Kã€‚<br> é‚£ä¹Ÿå°±æ„å‘³ç€ï¼Œ ä¸€ä¸ªé¡µä¸­æ‰€å­˜å‚¨çš„è¡Œä¹Ÿæ˜¯æœ‰é™çš„ï¼Œå¦‚æœæ’å…¥çš„æ•°æ®è¡Œrowåœ¨è¯¥é¡µå­˜å‚¨ä¸å°ï¼Œå°†ä¼šå­˜å‚¨åˆ°ä¸‹ä¸€ä¸ªé¡µä¸­ï¼Œé¡µä¸é¡µä¹‹é—´ä¼šé€šè¿‡æŒ‡é’ˆè¿æ¥ã€‚</p><h4 id="é¡µåˆ†è£‚" tabindex="-1"><a class="header-anchor" href="#é¡µåˆ†è£‚"><span>é¡µåˆ†è£‚</span></a></h4><p><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/sql03.png" alt="image.png" loading="lazy"><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/sql04.png" alt="image.png" loading="lazy"></p><h4 id="é¡µåˆå¹¶" tabindex="-1"><a class="header-anchor" href="#é¡µåˆå¹¶"><span>é¡µåˆå¹¶</span></a></h4><p>å½“åˆ é™¤ä¸€è¡Œè®°å½•æ—¶ï¼Œå®é™…ä¸Šè®°å½•å¹¶æ²¡æœ‰è¢«ç‰©ç†åˆ é™¤ï¼Œåªæ˜¯è®°å½•è¢«æ ‡è®°ï¼ˆflagedï¼‰ä¸ºåˆ é™¤å¹¶ä¸”å®ƒçš„ç©ºé—´å˜å¾—å…è®¸è¢«å…¶ä»–è®°å½•å£°æ˜ä½¿ç”¨ã€‚<br> å½“é¡µä¸­åˆ é™¤çš„è®°å½•è¾¾åˆ° MERGE_THRESHOLDï¼ˆé»˜è®¤ä¸ºé¡µçš„50%ï¼‰ï¼ŒInnoDBä¼šå¼€å§‹å¯»æ‰¾æœ€é è¿‘çš„é¡µï¼ˆå‰æˆ–åï¼‰çœ‹çœ‹æ˜¯å¦å¯ä»¥å°†ä¸¤ä¸ªé¡µåˆå¹¶ä»¥ä¼˜åŒ–ç©ºé—´ä½¿ç”¨ã€‚<br> MERGE_THRESHOLDï¼šåˆå¹¶é¡µçš„é˜ˆå€¼ï¼Œå¯ä»¥è‡ªå·±è®¾ç½®ï¼Œåœ¨åˆ›å»ºè¡¨æˆ–è€…åˆ›å»ºç´¢å¼•æ—¶æŒ‡å®šã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/sql05.png" alt="image.png" loading="lazy"></p><h4 id="ç´¢å¼•è®¾è®¡åŸåˆ™" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•è®¾è®¡åŸåˆ™"><span>ç´¢å¼•è®¾è®¡åŸåˆ™</span></a></h4><ul><li>æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œå°½é‡é™ä½ä¸»é”®çš„é•¿åº¦ã€‚</li><li>æ’å…¥æ•°æ®æ—¶ï¼Œå°½é‡é€‰æ‹©é¡ºåºæ’å…¥ï¼Œé€‰æ‹©ä½¿ç”¨AUTO_INCREMENTè‡ªå¢ä¸»é”®ã€‚</li><li>å°½é‡ä¸è¦ä½¿ç”¨UUIDåšä¸»é”®æˆ–è€…æ˜¯å…¶ä»–è‡ªç„¶ä¸»é”®ï¼Œå¦‚èº«ä»½è¯å·ã€‚</li><li>ä¸šåŠ¡æ“ä½œæ—¶ï¼Œé¿å…å¯¹ä¸»é”®çš„ä¿®æ”¹ã€‚</li></ul><h3 id="order-byä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#order-byä¼˜åŒ–"><span>ORDER BYä¼˜åŒ–</span></a></h3><ol><li>Using filesortï¼šé€šè¿‡è¡¨çš„ç´¢å¼•æˆ–å…¨è¡¨æ‰«æï¼Œè¯»å–æ»¡è¶³æ¡ä»¶çš„æ•°æ®è¡Œï¼Œç„¶ååœ¨æ’åºç¼“å†²åŒº sort buffer ä¸­å®Œæˆæ’åºæ“ä½œï¼Œæ‰€æœ‰ä¸æ˜¯é€šè¿‡ç´¢å¼•ç›´æ¥è¿”å›æ’åºç»“æœçš„æ’åºéƒ½å« FileSort æ’åº</li><li>Using indexï¼šé€šè¿‡æœ‰åºç´¢å¼•é¡ºåºæ‰«æç›´æ¥è¿”å›æœ‰åºæ•°æ®ï¼Œè¿™ç§æƒ…å†µå³ä¸º using indexï¼Œä¸éœ€è¦é¢å¤–æ’åºï¼Œæ“ä½œæ•ˆç‡é«˜</li><li>backward index scan: åœ¨MySQLä¸­åˆ›å»ºçš„ç´¢å¼•ï¼Œé»˜è®¤ç´¢å¼•çš„å¶å­èŠ‚ç‚¹æ˜¯ä»å°åˆ°å¤§æ’åºçš„ï¼Œè€Œæ­¤æ—¶æŸ¥è¯¢æ’åºæ—¶ï¼Œæ˜¯ä»å¤§åˆ°å°ï¼Œæ‰€ä»¥ï¼Œåœ¨æ‰«ææ—¶ï¼Œå°±æ˜¯åå‘æ‰«æåœ¨MySQL8ç‰ˆæœ¬ä¸­ï¼Œæ”¯æŒé™åºç´¢å¼•ï¼Œå¯ä»¥åˆ›å»ºé™åºç´¢å¼•ã€‚</li></ol><ul><li>å¦‚æœorder byå­—æ®µå…¨éƒ¨ä½¿ç”¨å‡åºæ’åºæˆ–è€…é™åºæ’åºï¼Œåˆ™éƒ½ä¼šèµ°ç´¢å¼•ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªå­—æ®µå‡åºæ’åºï¼Œå¦ä¸€ä¸ªå­—æ®µé™åºæ’åºï¼Œåˆ™ä¸ä¼šèµ°ç´¢å¼•</li><li>explainçš„extraä¿¡æ¯æ˜¾ç¤ºçš„æ˜¯<code>Using index, Using filesort</code>ï¼Œå¦‚æœè¦ä¼˜åŒ–æ‰Using filesortï¼Œåˆ™éœ€è¦å¦å¤–å†åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œ <ul><li>å¦‚ï¼š<code>create index idx_user_age_phone_ad on tb_user(age asc, phone desc);</code></li><li>æ­¤æ—¶ä½¿ç”¨<code>select id, age, phone from tb_user order by age asc, phone desc;</code>ä¼šå…¨éƒ¨èµ°ç´¢å¼•</li></ul></li><li>æ’åºæ—¶,ä¹Ÿéœ€è¦æ»¡è¶³æœ€å·¦å‰ç¼€æ³•åˆ™,å¦åˆ™ä¹Ÿä¼šå‡ºç° filesortã€‚å› ä¸ºåœ¨åˆ›å»ºç´¢å¼•çš„æ—¶å€™ï¼Œ ageæ˜¯ç¬¬ä¸€ä¸ªå­—æ®µï¼Œphoneæ˜¯ç¬¬äºŒä¸ªå­—æ®µï¼Œæ‰€ä»¥æ’åºæ—¶ï¼Œä¹Ÿå°±è¯¥æŒ‰ç…§è¿™ä¸ªé¡ºåºæ¥ï¼Œå¦åˆ™å°±ä¼šå‡ºç° Using filesortã€‚</li></ul><h3 id="limitä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#limitä¼˜åŒ–"><span>limitä¼˜åŒ–</span></a></h3><p>å¸¸è§çš„é—®é¢˜å¦‚<code>limit 2000000, 10</code>ï¼Œæ­¤æ—¶éœ€è¦ MySQL æ’åºå‰2000000æ¡è®°å½•ï¼Œä½†ä»…ä»…è¿”å›2000000-2000010çš„è®°å½•ï¼Œå…¶ä»–è®°å½•ä¸¢å¼ƒï¼ŒæŸ¥è¯¢æ’åºçš„ä»£ä»·éå¸¸å¤§ã€‚<br> ä¼˜åŒ–æ–¹æ¡ˆï¼šä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œé€šè¿‡åˆ›å»ºè¦†ç›–ç´¢å¼•èƒ½å¤Ÿæ¯”è¾ƒå¥½åœ°æé«˜æ€§èƒ½ï¼Œå¯ä»¥é€šè¿‡è¦†ç›–ç´¢å¼•åŠ å­æŸ¥è¯¢å½¢å¼è¿›è¡Œä¼˜åŒ–ã€‚<br> ä¾‹å¦‚ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- æ­¤è¯­å¥è€—æ—¶å¾ˆé•¿</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_sku <span class="token keyword">limit</span> <span class="token number">9000000</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token comment">-- é€šè¿‡è¦†ç›–ç´¢å¼•åŠ å¿«é€Ÿåº¦ï¼Œç›´æ¥é€šè¿‡ä¸»é”®ç´¢å¼•è¿›è¡Œæ’åºåŠæŸ¥è¯¢</span>
<span class="token keyword">select</span> id <span class="token keyword">from</span> tb_sku <span class="token keyword">order</span> <span class="token keyword">by</span> id <span class="token keyword">limit</span> <span class="token number">9000000</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token comment">-- ä¸‹é¢çš„è¯­å¥æ˜¯é”™è¯¯çš„ï¼Œå› ä¸º MySQL ä¸æ”¯æŒ in é‡Œé¢ä½¿ç”¨ limit</span>
<span class="token comment">-- select * from tb_sku where id in (select id from tb_sku order by id limit 9000000, 10);</span>
<span class="token comment">-- é€šè¿‡è¿è¡¨æŸ¥è¯¢å³å¯å®ç°ç¬¬ä¸€å¥çš„æ•ˆæœï¼Œå¹¶ä¸”èƒ½è¾¾åˆ°ç¬¬äºŒå¥çš„é€Ÿåº¦</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_sku <span class="token keyword">as</span> s<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> id <span class="token keyword">from</span> tb_sku <span class="token keyword">order</span> <span class="token keyword">by</span> id <span class="token keyword">limit</span> <span class="token number">9000000</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">as</span> a <span class="token keyword">where</span> s<span class="token punctuation">.</span>id <span class="token operator">=</span> a<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="countä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#countä¼˜åŒ–"><span>countä¼˜åŒ–</span></a></h3><p>MyISAM å¼•æ“æŠŠä¸€ä¸ªè¡¨çš„æ€»è¡Œæ•°å­˜åœ¨äº†ç£ç›˜ä¸Šï¼Œå› æ­¤æ‰§è¡Œ count(<em>) çš„æ—¶å€™ä¼šç›´æ¥è¿”å›è¿™ä¸ªæ•°ï¼Œæ•ˆç‡å¾ˆé«˜ï¼ˆå‰ææ˜¯ä¸é€‚ç”¨whereï¼‰ï¼›<br> InnoDB åœ¨æ‰§è¡Œ count(</em>) æ—¶ï¼Œéœ€è¦æŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°ä»å¼•æ“é‡Œé¢è¯»å‡ºæ¥ï¼Œç„¶åç´¯è®¡è®¡æ•°ã€‚<br> ä¼˜åŒ–æ–¹æ¡ˆï¼šè‡ªå·±è®¡æ•°ï¼Œå¦‚åˆ›å»ºkey-valueè¡¨å­˜å‚¨åœ¨å†…å­˜æˆ–ç¡¬ç›˜ï¼Œæˆ–è€…æ˜¯ç”¨redis<br> countçš„å‡ ç§ç”¨æ³•ï¼š</p><ul><li>å¦‚æœcountå‡½æ•°çš„å‚æ•°ï¼ˆcounté‡Œé¢å†™çš„é‚£ä¸ªå­—æ®µï¼‰ä¸æ˜¯NULLï¼ˆå­—æ®µå€¼ä¸ä¸ºNULLï¼‰ï¼Œç´¯è®¡å€¼å°±åŠ ä¸€ï¼Œæœ€åè¿”å›ç´¯è®¡å€¼</li><li>ç”¨æ³•ï¼šcount(*)ã€count(ä¸»é”®)ã€count(å­—æ®µ)ã€count(1)</li><li>count(ä¸»é”®)è·Ÿcount(<em>)ä¸€æ ·ï¼Œå› ä¸ºä¸»é”®ä¸èƒ½ä¸ºç©ºï¼›count(å­—æ®µ)åªè®¡ç®—å­—æ®µå€¼ä¸ä¸ºNULLçš„è¡Œï¼›count(1)å¼•æ“ä¼šä¸ºæ¯è¡Œæ·»åŠ ä¸€ä¸ª1ï¼Œç„¶åå°±countè¿™ä¸ª1ï¼Œè¿”å›ç»“æœä¹Ÿè·Ÿcount(</em>)ä¸€æ ·ï¼›count(null)è¿”å›0</li></ul><p>å„ç§ç”¨æ³•çš„æ€§èƒ½ï¼š</p><ul><li>count(ä¸»é”®)ï¼šInnoDBå¼•æ“ä¼šéå†æ•´å¼ è¡¨ï¼ŒæŠŠæ¯è¡Œçš„ä¸»é”®idå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ï¼ŒæœåŠ¡å±‚æ‹¿åˆ°ä¸»é”®åï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ï¼ˆä¸»é”®ä¸å¯èƒ½ä¸ºç©ºï¼‰</li><li>count(å­—æ®µ)ï¼šæ²¡æœ‰not nullçº¦æŸçš„è¯ï¼ŒInnoDBå¼•æ“ä¼šéå†æ•´å¼ è¡¨æŠŠæ¯ä¸€è¡Œçš„å­—æ®µå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ï¼ŒæœåŠ¡å±‚åˆ¤æ–­æ˜¯å¦ä¸ºnullï¼Œä¸ä¸ºnullï¼Œè®¡æ•°ç´¯åŠ ï¼›æœ‰not nullçº¦æŸçš„è¯ï¼ŒInnoDBå¼•æ“ä¼šéå†æ•´å¼ è¡¨æŠŠæ¯ä¸€è¡Œçš„å­—æ®µå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ </li><li>count(1)ï¼šInnoDB å¼•æ“éå†æ•´å¼ è¡¨ï¼Œä½†ä¸å–å€¼ã€‚æœåŠ¡å±‚å¯¹äºè¿”å›çš„æ¯ä¸€å±‚ï¼Œæ”¾ä¸€ä¸ªæ•°å­— 1 è¿›å»ï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ </li><li>count(*)ï¼šInnoDB å¼•æ“å¹¶ä¸ä¼šæŠŠå…¨éƒ¨å­—æ®µå–å‡ºæ¥ï¼Œè€Œæ˜¯ä¸“é—¨åšäº†ä¼˜åŒ–ï¼Œä¸å–å€¼ï¼ŒæœåŠ¡å±‚ç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ </li></ul><p>æŒ‰æ•ˆç‡æ’åºï¼šcount(å­—æ®µ) &lt; count(ä¸»é”®) &lt; count(1) â‰ˆ count(<em>)ï¼Œæ‰€ä»¥å°½é‡ä½¿ç”¨ count(</em>)</p><h3 id="updateä¼˜åŒ–-é¿å…è¡Œé”å‡çº§ä¸ºè¡¨é”" tabindex="-1"><a class="header-anchor" href="#updateä¼˜åŒ–-é¿å…è¡Œé”å‡çº§ä¸ºè¡¨é”"><span>updateä¼˜åŒ–ï¼ˆé¿å…è¡Œé”å‡çº§ä¸ºè¡¨é”ï¼‰</span></a></h3><p>InnoDB çš„è¡Œé”æ˜¯é’ˆå¯¹ç´¢å¼•åŠ çš„é”ï¼Œä¸æ˜¯é’ˆå¯¹è®°å½•åŠ çš„é”ï¼Œå¹¶ä¸”è¯¥ç´¢å¼•ä¸èƒ½å¤±æ•ˆï¼Œå¦åˆ™ä¼šä»è¡Œé”å‡çº§ä¸ºè¡¨é”ã€‚<br> å¦‚ä»¥ä¸‹ä¸¤æ¡è¯­å¥ï¼š<br><code>update student set no = &#39;123&#39; where id = 1;</code>ï¼Œè¿™å¥ç”±äºidæœ‰ä¸»é”®ç´¢å¼•ï¼Œæ‰€ä»¥åªä¼šé”è¿™ä¸€è¡Œï¼›<br><code>update student set no = &#39;123&#39; where name = &#39;test&#39;;</code>è¿™å¥ç”±äºnameæ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥ä¼šæŠŠæ•´å¼ è¡¨éƒ½é”ä½è¿›è¡Œæ•°æ®æ›´æ–°ï¼Œè§£å†³æ–¹æ³•æ˜¯ç»™nameå­—æ®µæ·»åŠ ç´¢å¼•</p><h2 id="é”" tabindex="-1"><a class="header-anchor" href="#é”"><span>é”</span></a></h2><h3 id="æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#æ¦‚è¿°"><span>æ¦‚è¿°</span></a></h3><p>é”æ˜¯è®¡ç®—æœºåè°ƒå¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹å¹¶å‘è®¿é—®æŸä¸€èµ„æºçš„æœºåˆ¶ã€‚åœ¨æ•°æ®åº“ä¸­ï¼Œé™¤ä¼ ç»Ÿçš„è®¡ç®—èµ„æºï¼ˆCPUã€ RAMã€I/Oï¼‰çš„äº‰ç”¨ä»¥å¤–ï¼Œæ•°æ®ä¹Ÿæ˜¯ä¸€ç§ä¾›è®¸å¤šç”¨æˆ·å…±äº«çš„èµ„æºã€‚å¦‚ä½•ä¿è¯æ•°æ®å¹¶å‘è®¿é—®çš„ä¸€è‡´æ€§ã€æœ‰ æ•ˆæ€§æ˜¯æ‰€æœ‰æ•°æ®åº“å¿…é¡»è§£å†³çš„ä¸€ä¸ªé—®é¢˜ï¼Œé”å†²çªä¹Ÿæ˜¯å½±å“æ•°æ®åº“å¹¶å‘è®¿é—®æ€§èƒ½çš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚ä»è¿™ä¸ª è§’åº¦æ¥è¯´ï¼Œé”å¯¹æ•°æ®åº“è€Œè¨€æ˜¾å¾—å°¤å…¶é‡è¦ï¼Œä¹Ÿæ›´åŠ å¤æ‚ã€‚<br> MySQLä¸­çš„é”ï¼ŒæŒ‰ç…§é”çš„ç²’åº¦åˆ†ï¼Œåˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼š</p><ul><li>å…¨å±€é”ï¼šé”å®šæ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨ã€‚</li><li>è¡¨çº§é”ï¼šæ¯æ¬¡æ“ä½œé”ä½æ•´å¼ è¡¨ã€‚</li><li>è¡Œçº§é”ï¼šæ¯æ¬¡æ“ä½œé”ä½å¯¹åº”çš„è¡Œæ•°æ®ã€‚</li></ul><h3 id="å…¨å±€é”" tabindex="-1"><a class="header-anchor" href="#å…¨å±€é”"><span>å…¨å±€é”</span></a></h3><h4 id="æ¦‚è¿°-1" tabindex="-1"><a class="header-anchor" href="#æ¦‚è¿°-1"><span>æ¦‚è¿°</span></a></h4><p>å…¨å±€é”å°±æ˜¯å¯¹æ•´ä¸ªæ•°æ®åº“å®ä¾‹åŠ é”ï¼ŒåŠ é”åæ•´ä¸ªå®ä¾‹å°±å¤„äºåªè¯»çŠ¶æ€ï¼Œåç»­çš„DMLçš„å†™è¯­å¥ï¼ŒDDLè¯­ å¥ï¼Œå·²ç»æ›´æ–°æ“ä½œçš„äº‹åŠ¡æäº¤è¯­å¥éƒ½å°†è¢«é˜»å¡ã€‚ å…¶å…¸å‹çš„ä½¿ç”¨åœºæ™¯æ˜¯åš<strong>å…¨åº“çš„é€»è¾‘å¤‡ä»½</strong>ï¼Œå¯¹æ‰€æœ‰çš„è¡¨è¿›è¡Œé”å®šï¼Œä»è€Œè·å–ä¸€è‡´æ€§è§†å›¾ï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚</p><h4 id="è¯­æ³•" tabindex="-1"><a class="header-anchor" href="#è¯­æ³•"><span>è¯­æ³•</span></a></h4><ol><li>åŠ å…¨å±€é”</li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>flush <span class="token keyword">tables</span> <span class="token keyword">with</span> <span class="token keyword">read</span> <span class="token keyword">lock</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>æ•°æ®å¤‡ä»½</li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>mysqldump <span class="token operator">-</span>uè´¦æˆ·å <span class="token operator">-</span>på¯†ç  æ•°æ®åº“å <span class="token operator">&gt;</span> XXX<span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>é‡Šæ”¾é”</li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">unlock</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="ç‰¹ç‚¹" tabindex="-1"><a class="header-anchor" href="#ç‰¹ç‚¹"><span>ç‰¹ç‚¹</span></a></h4><p>æ•°æ®åº“ä¸­åŠ å…¨å±€é”ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡çš„æ“ä½œï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li>å¦‚æœåœ¨ä¸»åº“ä¸Šå¤‡ä»½ï¼Œé‚£ä¹ˆåœ¨å¤‡ä»½æœŸé—´éƒ½ä¸èƒ½æ‰§è¡Œæ›´æ–°ï¼Œä¸šåŠ¡åŸºæœ¬ä¸Šå°±å¾—åœæ‘†ã€‚</li><li>å¦‚æœåœ¨ä»åº“ä¸Šå¤‡ä»½ï¼Œé‚£ä¹ˆåœ¨å¤‡ä»½æœŸé—´ä»åº“ä¸èƒ½æ‰§è¡Œä¸»åº“åŒæ­¥è¿‡æ¥çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinlogï¼‰ï¼Œä¼šå¯¼ è‡´ä¸»ä»å»¶è¿Ÿã€‚</li></ul><p>åœ¨InnoDBå¼•æ“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¤‡ä»½æ—¶åŠ ä¸Šå‚æ•° <code>--single-transaction</code> å‚æ•°æ¥å®Œæˆä¸åŠ é”çš„ä¸€è‡´ æ€§æ•°æ®å¤‡ä»½ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>mysqldump <span class="token comment">--single-transaction -uroot â€“p123456 itcast &gt; itcast.sql</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="è¡¨çº§é”" tabindex="-1"><a class="header-anchor" href="#è¡¨çº§é”"><span>è¡¨çº§é”</span></a></h3><p>è¡¨çº§é”ï¼Œæ¯æ¬¡æ“ä½œé”ä½æ•´å¼ è¡¨ã€‚é”å®šç²’åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œå¹¶å‘åº¦æœ€ä½ã€‚åº”ç”¨äºMyISAMã€ InnoDBã€BDBç­‰å­˜å‚¨å¼•æ“ä¸­ã€‚<br> å¯¹äºè¡¨çº§é”ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼š</p><ul><li>è¡¨é”</li><li>å…ƒæ•°æ®é”ï¼ˆmeta data lockï¼ŒMDLï¼‰</li><li>æ„å‘é”</li></ul><h4 id="è¡¨é”" tabindex="-1"><a class="header-anchor" href="#è¡¨é”"><span>è¡¨é”</span></a></h4><p>å¯¹äºè¡¨é”ï¼Œåˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>è¡¨å…±äº«è¯»é”ï¼ˆread lockï¼‰ -&gt; å…¶å®ƒå®¢æˆ·ç«¯åªèƒ½è¯»ï¼Œä¸èƒ½å†™</li><li>è¡¨ç‹¬å å†™é”ï¼ˆwrite lockï¼‰-&gt; å…¶å®ƒå®¢æˆ·ç«¯ä¸èƒ½è¯»ä¹Ÿä¸èƒ½å†™</li></ul><p>è¯­æ³•ï¼š</p><ul><li>åŠ é”ï¼šlock tables è¡¨å read/writeï¼›</li><li>é‡Šæ”¾é”ï¼šunlock tables; æˆ–è€…å®¢æˆ·ç«¯æ–­å¼€è¿æ¥</li></ul><h4 id="å…ƒæ•°æ®é”" tabindex="-1"><a class="header-anchor" href="#å…ƒæ•°æ®é”"><span>å…ƒæ•°æ®é”</span></a></h4><p>meta data lock , å…ƒæ•°æ®é”ï¼Œç®€å†™MDLã€‚<br> MDLåŠ é”è¿‡ç¨‹æ˜¯ç³»ç»Ÿè‡ªåŠ¨æ§åˆ¶ï¼Œæ— éœ€æ˜¾å¼ä½¿ç”¨ï¼Œåœ¨è®¿é—®ä¸€å¼ è¡¨çš„æ—¶å€™ä¼šè‡ªåŠ¨åŠ ä¸Šã€‚MDLé”ä¸»è¦ä½œç”¨æ˜¯ç»´æŠ¤è¡¨å…ƒæ•°æ®çš„æ•°æ®ä¸€è‡´æ€§ï¼Œåœ¨è¡¨ä¸Šæœ‰æ´»åŠ¨äº‹åŠ¡çš„æ—¶å€™ï¼Œä¸å¯ä»¥å¯¹å…ƒæ•°æ®è¿›è¡Œå†™å…¥æ“ä½œã€‚**ä¸ºäº†é¿å…DMLä¸DDLå†²çªï¼Œä¿è¯è¯»å†™çš„æ­£ç¡®æ€§ã€‚ **<br> è¿™é‡Œçš„å…ƒæ•°æ®ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºå°±æ˜¯ä¸€å¼ è¡¨çš„è¡¨ç»“æ„ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŸä¸€å¼ è¡¨æ¶‰åŠåˆ°æœªæäº¤çš„äº‹åŠ¡æ—¶ï¼Œæ˜¯ä¸èƒ½å¤Ÿä¿®æ”¹è¿™å¼ è¡¨çš„è¡¨ç»“æ„çš„ã€‚<br> åœ¨MySQL5.5ä¸­å¼•å…¥äº†MDLï¼Œå½“å¯¹ä¸€å¼ è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥çš„æ—¶å€™ï¼ŒåŠ MDLè¯»é”(å…±äº«)ï¼›å½“å¯¹è¡¨ç»“æ„è¿›è¡Œå˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ MDLå†™é”(æ’ä»–)ã€‚<br> å¸¸è§çš„SQLæ“ä½œæ—¶ï¼Œæ‰€æ·»åŠ çš„å…ƒæ•°æ®é”ï¼š<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/lock01.png" alt="image.png" loading="lazy"></p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">select</span> object_type<span class="token punctuation">,</span>object_schema<span class="token punctuation">,</span>object_name<span class="token punctuation">,</span>lock_type<span class="token punctuation">,</span>lock_duration <span class="token keyword">from</span>
performance_schema<span class="token punctuation">.</span>metadata_locks <span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/lock02.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><blockquote><p>æ€»ç»“ï¼š<br> å¤šä¸ªå®¢æˆ·ç«¯ä¸èƒ½åŒæ—¶å¯¹åŒä¸€å¼ è¡¨è¿›è¡ŒCRUDã€ä¿®æ”¹è¡¨ç»“æ„çš„æ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹ç”±ç³»ç»Ÿæ§åˆ¶ã€‚</p></blockquote><h4 id="æ„å‘é”" tabindex="-1"><a class="header-anchor" href="#æ„å‘é”"><span>æ„å‘é”</span></a></h4><p>æ¦‚è¿°<br> ä¸ºäº†é¿å…DMLåœ¨æ‰§è¡Œæ—¶ï¼ŒåŠ çš„è¡Œé”ä¸è¡¨é”çš„å†²çªï¼Œåœ¨InnoDBä¸­å¼•å…¥äº†æ„å‘é”ï¼Œä½¿å¾—è¡¨é”ä¸ç”¨æ£€æŸ¥æ¯è¡Œæ•°æ®æ˜¯å¦åŠ é”ï¼Œä½¿ç”¨æ„å‘é”æ¥å‡å°‘è¡¨é”çš„æ£€æŸ¥ã€‚<br> åˆ†ç±»</p><ul><li>æ„å‘å…±äº«é”(IS): ç”±è¯­å¥select ... lock in share modeæ·»åŠ  ã€‚ ä¸ è¡¨é”å…±äº«é”(read)å…¼å®¹ï¼Œä¸è¡¨é”æ’ä»–é”(write)äº’æ–¥ã€‚</li><li>æ„å‘æ’ä»–é”(IX): ç”±insertã€updateã€deleteã€select...for updateæ·»åŠ  ã€‚ä¸è¡¨é”å…±äº«é”(read)åŠæ’ä»–é”(write)éƒ½äº’æ–¥ï¼Œæ„å‘é”ä¹‹é—´ä¸ä¼šäº’æ–¥ã€‚</li></ul><p>ä¸€æ—¦äº‹åŠ¡æäº¤äº†ï¼Œæ„å‘å…±äº«é”ã€æ„å‘æ’ä»–é”ï¼Œéƒ½ä¼šè‡ªåŠ¨é‡Šæ”¾ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">select</span> object_schema<span class="token punctuation">,</span>object_name<span class="token punctuation">,</span>index_name<span class="token punctuation">,</span>lock_type<span class="token punctuation">,</span>lock_mode<span class="token punctuation">,</span>lock_data <span class="token keyword">from</span>
performance_schema<span class="token punctuation">.</span>data_locks<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è¡Œçº§é”" tabindex="-1"><a class="header-anchor" href="#è¡Œçº§é”"><span>è¡Œçº§é”</span></a></h3><h4 id="æ¦‚è¿°-2" tabindex="-1"><a class="header-anchor" href="#æ¦‚è¿°-2"><span>æ¦‚è¿°</span></a></h4><p>è¡Œçº§é”ï¼Œæ¯æ¬¡æ“ä½œé”ä½å¯¹åº”çš„è¡Œæ•°æ®ã€‚é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½ï¼Œå¹¶å‘åº¦æœ€é«˜ã€‚åº”ç”¨åœ¨ InnoDBå­˜å‚¨å¼•æ“ä¸­ã€‚<br> InnoDBçš„æ•°æ®æ˜¯åŸºäºç´¢å¼•ç»„ç»‡çš„ï¼Œè¡Œé”æ˜¯é€šè¿‡å¯¹ç´¢å¼•ä¸Šçš„ç´¢å¼•é¡¹åŠ é”æ¥å®ç°çš„ï¼Œè€Œä¸æ˜¯å¯¹è®°å½•åŠ çš„ é”ã€‚å¯¹äºè¡Œçº§é”ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼š</p><ul><li>è¡Œé”ï¼ˆRecord Lockï¼‰ï¼šé”å®šå•ä¸ªè¡Œè®°å½•çš„é”ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡å¯¹æ­¤è¡Œè¿›è¡Œupdateå’Œdeleteã€‚åœ¨</li></ul><p>RCã€RRéš”ç¦»çº§åˆ«ä¸‹éƒ½æ”¯æŒã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/lock03.png" alt="image.png" loading="lazy"></p><ul><li>é—´éš™é”ï¼ˆGap Lockï¼‰ï¼šé”å®šç´¢å¼•è®°å½•é—´éš™ï¼ˆä¸å«è¯¥è®°å½•ï¼‰ï¼Œç¡®ä¿ç´¢å¼•è®°å½•é—´éš™ä¸å˜ï¼Œé˜²æ­¢å…¶ä»–äº‹</li></ul><p>åŠ¡åœ¨è¿™ä¸ªé—´éš™è¿›è¡Œinsertï¼Œäº§ç”Ÿå¹»è¯»ã€‚åœ¨RRéš”ç¦»çº§åˆ«ä¸‹éƒ½æ”¯æŒã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/lock04.png" alt="image.png" loading="lazy"></p><ul><li>ä¸´é”®é”ï¼ˆNext-Key Lockï¼‰ï¼šè¡Œé”å’Œé—´éš™é”ç»„åˆï¼ŒåŒæ—¶é”ä½æ•°æ®ï¼Œå¹¶é”ä½æ•°æ®å‰é¢çš„é—´éš™Gapã€‚</li></ul><p>åœ¨RRéš”ç¦»çº§åˆ«ä¸‹æ”¯æŒã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/lock05.png" alt="image.png" loading="lazy"></p><h4 id="è¡Œé”" tabindex="-1"><a class="header-anchor" href="#è¡Œé”"><span>è¡Œé”</span></a></h4><p>InnoDBå®ç°äº†ä»¥ä¸‹ä¸¤ç§ç±»å‹çš„è¡Œé”ï¼š</p><ul><li>å…±äº«é”ï¼ˆSï¼‰ï¼šå…è®¸ä¸€ä¸ªäº‹åŠ¡å»è¯»ä¸€è¡Œï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡è·å¾—ç›¸åŒæ•°æ®é›†çš„æ’å®ƒé”ã€‚</li><li>æ’ä»–é”ï¼ˆXï¼‰ï¼šå…è®¸è·å–æ’ä»–é”çš„äº‹åŠ¡æ›´æ–°æ•°æ®ï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡è·å¾—ç›¸åŒæ•°æ®é›†çš„å…±äº«é”å’Œæ’ä»–é”ã€‚</li></ul><p>ä¸¤ç§è¡Œé”çš„å…¼å®¹æƒ…å†µå¦‚ä¸‹:<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/lock06.png" alt="image.png" loading="lazy"><br> å¸¸è§çš„SQLè¯­å¥åœ¨æ‰§è¡Œæ—¶æ‰€åŠ çš„è¡Œé”å¦‚ä¸‹ï¼š<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/lock07.png" alt="image.png" loading="lazy"></p><blockquote><p>åœ¨MySQL8.0æŸä¸ªç‰ˆæœ¬åï¼ŒSELECT ... LOCK IN SHARE MODE å»ºè®®æ”¹ä¸ºSELECT ... FOR SHARE<br> SELECT ä¸€å®šè¦åœ¨æ‰‹åŠ¨åŠ é”çš„æƒ…å†µä¸‹æ‰èƒ½é˜²æ­¢å¹»è¯»ã€‚<br> äº‹åŠ¡å¼€å¯ä¹‹åï¼Œè¯»å–æ•°æ®çš„æ—¶å€™æ˜¯ä½¿ç”¨çš„ã€ä¸´é”®é”ã€‘ï¼Œæ ¹æ®ç´¢å¼•è€Œæ”¹å˜æˆä¸åŒçš„é”ã€‚</p></blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒInnoDBåœ¨ REPEATABLE READäº‹åŠ¡éš”ç¦»çº§åˆ«è¿è¡Œï¼ŒInnoDBä½¿ç”¨ next-key é”ï¼ˆä¸´é”®ï¼‰è¿›è¡Œæœç´¢å’Œç´¢å¼•æ‰«æï¼Œä»¥é˜²æ­¢å¹»è¯»ã€‚<br> é’ˆå¯¹å”¯ä¸€ç´¢å¼•è¿›è¡Œæ£€ç´¢æ—¶ï¼Œå¯¹å·²å­˜åœ¨çš„è®°å½•è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ï¼Œå°†ä¼šè‡ªåŠ¨ä¼˜åŒ–ä¸ºè¡Œé”ã€‚<br> InnoDBçš„è¡Œé”æ˜¯é’ˆå¯¹äºç´¢å¼•åŠ çš„é”ï¼Œä¸é€šè¿‡ç´¢å¼•æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œé‚£ä¹ˆInnoDBå°†å¯¹è¡¨ä¸­çš„æ‰€æœ‰è®°å½•åŠ é”ï¼Œæ­¤æ—¶å°±ä¼šå‡çº§ä¸ºè¡¨é”ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">select</span> object_schema<span class="token punctuation">,</span>object_name<span class="token punctuation">,</span>index_name<span class="token punctuation">,</span>lock_type<span class="token punctuation">,</span>lock_mode<span class="token punctuation">,</span>lock_data <span class="token keyword">from</span>
performance_schema<span class="token punctuation">.</span>data_locks<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é—´éš™é”ã€ä¸´é”®é”" tabindex="-1"><a class="header-anchor" href="#é—´éš™é”ã€ä¸´é”®é”"><span>é—´éš™é”ã€ä¸´é”®é”</span></a></h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒInnoDBåœ¨ REPEATABLE READäº‹åŠ¡éš”ç¦»çº§åˆ«è¿è¡Œï¼ŒInnoDBä½¿ç”¨ next-key é”è¿›è¡Œæœç´¢å’Œç´¢å¼•æ‰«æï¼Œä»¥é˜²æ­¢å¹»è¯»ã€‚</p><ul><li>ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢(å”¯ä¸€ç´¢å¼•)ï¼Œç»™ä¸å­˜åœ¨çš„è®°å½•åŠ é”æ—¶, ä¼˜åŒ–ä¸ºé—´éš™é” ã€‚ <ul><li>æ¡ˆä¾‹ï¼šæ­¤æ—¶æœ‰ID=1å’ŒID=3çš„æ•°æ®ï¼Œå®¢æˆ·ç«¯1å¼€å§‹äº‹åŠ¡ï¼ŒæŸ¥è¯¢IDä¸º2çš„æ•°æ®ï¼Œç”±äºä¸å­˜åœ¨ID=2çš„æ•°æ®ï¼Œæ­¤æ—¶1å’Œ3ä¹‹é—´çš„ç©ºéš™ä¼šæœ‰ä¸€æŠŠé”ï¼›å®¢æˆ·ç«¯2æ’å…¥ID=2çš„æ•°æ®æ—¶ä¼šé˜»å¡ã€‚</li></ul></li><li>ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢(éå”¯ä¸€æ™®é€šç´¢å¼•)ï¼Œå‘å³éå†æ—¶æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³æŸ¥è¯¢éœ€æ±‚æ—¶ï¼Œnext-key lock é€€åŒ–ä¸ºé—´éš™é”ã€‚ <ul><li>ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå­¦ç”Ÿè¡¨ï¼ˆstudentï¼‰ï¼Œè¡¨ä¸­æœ‰å­¦ç”Ÿçš„å­¦å·ï¼ˆidï¼‰ã€å§“åï¼ˆnameï¼‰å’Œå¹´é¾„ï¼ˆageï¼‰ä¸‰ä¸ªå­—æ®µï¼Œæˆ‘ä»¬ä¸ºå­¦å·å­—æ®µåˆ›å»ºäº†ä¸€ä¸ªéå”¯ä¸€æ™®é€šç´¢å¼•ã€‚ç°åœ¨æˆ‘ä»¬æƒ³è¦æŸ¥æ‰¾å¹´é¾„å¤§äºç­‰äº 18 å²çš„å­¦ç”Ÿä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ SQL è¯­å¥ï¼š</li></ul></li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> id <span class="token operator">&gt;=</span> <span class="token number">100</span> <span class="token operator">AND</span> age <span class="token operator">&gt;=</span> <span class="token number">18</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¦‚æœæˆ‘ä»¬æŒ‰ç…§å­¦å·çš„é¡ºåºè¿›è¡Œéå†æŸ¥è¯¢ï¼Œå½“é‡åˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„å­¦ç”Ÿæ—¶ï¼ŒMySQL ä¼šåœæ­¢éå†å¹¶è¿”å›ç»“æœã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ Next-Key Lockï¼Œå³åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªé—´éš™é”å®šï¼Œä¾‹å¦‚ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> id <span class="token operator">&gt;=</span> <span class="token number">100</span> <span class="token operator">AND</span> age <span class="token operator">&gt;=</span> <span class="token number">18</span> <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™æ ·ï¼ŒMySQL ä¼šåœ¨æŸ¥è¯¢è¿‡ç¨‹ä¸­å¯¹ç¬¦åˆæ¡ä»¶çš„è®°å½•åŠ ä¸Š Next-Key Lockï¼Œç¡®ä¿å®ƒä»¬ä¸ä¼šè¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹ã€‚ä½†æ˜¯ï¼Œå¦‚æœæœ€åä¸€ä¸ªä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„è®°å½•è¢«é”å®šäº†ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„è®°å½•å°±æ— æ³•è¢«é”å®šï¼Œæ­¤æ—¶ MySQL ä¼šå°† Next-Key Lock é€€åŒ–ä¸º Gap Lockï¼Œå³åªé”å®šé—´éš™è€Œä¸æ˜¯æ•´ä¸ªè®°å½•ã€‚</p><ul><li>InnoDBçš„B+æ ‘ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹æ˜¯æœ‰åºçš„åŒå‘é“¾è¡¨ã€‚ å‡å¦‚ï¼Œæˆ‘ä»¬è¦æ ¹æ®è¿™ä¸ªäºŒçº§ç´¢å¼•æŸ¥è¯¢å€¼</li></ul><p>ä¸º18çš„æ•°æ®ï¼Œå¹¶åŠ ä¸Šå…±äº«é”ï¼Œæˆ‘ä»¬æ˜¯åªé”å®š18è¿™ä¸€è¡Œå°±å¯ä»¥äº†å—ï¼Ÿ å¹¶ä¸æ˜¯ï¼Œå› ä¸ºæ˜¯éå”¯ä¸€ç´¢å¼•ï¼Œè¿™ä¸ª<br> ç»“æ„ä¸­å¯èƒ½æœ‰å¤šä¸ª18çš„å­˜åœ¨ï¼Œæ‰€ä»¥ï¼Œåœ¨åŠ é”æ—¶ä¼šç»§ç»­å¾€åæ‰¾ï¼Œæ‰¾åˆ°ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„å€¼ï¼ˆå½“å‰æ¡ˆä¾‹ä¸­ä¹Ÿå°±æ˜¯29ï¼‰ã€‚æ­¤æ—¶ä¼šå¯¹18åŠ ä¸´é”®é”ï¼Œå¹¶å¯¹29ä¹‹å‰çš„é—´éš™åŠ é”ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/lock08.png" alt="image.png" loading="lazy"></p><ul><li>ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢(å”¯ä¸€ç´¢å¼•)--ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢ã€‚ <ul><li>ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå­¦ç”Ÿè¡¨ï¼ˆstudentï¼‰ï¼Œè¡¨ä¸­æœ‰å­¦ç”Ÿçš„å­¦å·ï¼ˆidï¼‰ã€å§“åï¼ˆnameï¼‰å’Œå¹´é¾„ï¼ˆageï¼‰ä¸‰ä¸ªå­—æ®µï¼Œæˆ‘ä»¬ä¸ºå­¦å·å­—æ®µåˆ›å»ºäº†ä¸€ä¸ªå”¯ä¸€ç´¢å¼•ã€‚ç°åœ¨æˆ‘ä»¬æƒ³è¦æŸ¥æ‰¾å¹´é¾„åœ¨ 18 åˆ° 20 å²ä¹‹é—´çš„å­¦ç”Ÿä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ SQL è¯­å¥ï¼š</li></ul></li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> id <span class="token operator">&gt;=</span> <span class="token number">100</span> <span class="token operator">AND</span> age <span class="token operator">&lt;=</span> <span class="token number">20</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æŒ‰ç…§å­¦å·çš„é¡ºåºè¿›è¡Œéå†æŸ¥è¯¢ï¼ŒMySQL ä¼šä»å­¦å·ä¸º 100 çš„å­¦ç”Ÿå¼€å§‹ï¼Œä¸€ç›´éå†åˆ°æœ€åä¸€ä¸ªå­¦ç”Ÿï¼Œç„¶åè¿”å›æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è®°å½•ã€‚å¦‚æœæœ€åä¸€ä¸ªå­¦ç”Ÿçš„å¹´é¾„ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ï¼Œé‚£ä¹ˆ MySQL ä¼šåœæ­¢éå†å¹¶è¿”å›ç»“æœã€‚</p><ul><li>æ­¤æ—¶æ•°æ®åº“ä¸­ID&gt;=19çš„æ•°æ®æœ‰19ã€25ï¼›æŸ¥è¯¢çš„æ¡ä»¶ä¸ºid&gt;=19ï¼Œå¹¶æ·»åŠ å…±äº«é”ã€‚ æ­¤æ—¶æˆ‘ä»¬å¯ä»¥æ ¹æ®æ•°æ®åº“è¡¨ä¸­ç°æœ‰çš„æ•°æ®ï¼Œå°†æ•°æ®åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š</li></ul><p>[19]<br> (19,25]<br> (25,+âˆ]<br> æ‰€ä»¥æ•°æ®åº“æ•°æ®åœ¨åŠ é”æ—¶ï¼Œå°†19åŠ äº†è¡Œé”ï¼Œ25çš„ä¸´é”®é”ï¼ˆåŒ…å«25åŠ25ä¹‹å‰çš„é—´éš™ï¼‰ï¼Œæ­£æ— ç©·çš„ä¸´<br> é”®é”(æ­£æ— ç©·åŠä¹‹å‰çš„é—´éš™)ã€‚</p><blockquote><p>æ³¨æ„ï¼šé—´éš™é”å”¯ä¸€ç›®çš„æ˜¯é˜²æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥é—´éš™ã€‚é—´éš™é”å¯ä»¥å…±å­˜ï¼Œä¸€ä¸ªäº‹åŠ¡é‡‡ç”¨çš„é—´éš™é”ä¸ä¼š<br> é˜»æ­¢å¦ä¸€ä¸ªäº‹åŠ¡åœ¨åŒä¸€é—´éš™ä¸Šé‡‡ç”¨é—´éš™é”ã€‚</p></blockquote><h2 id="innodbå¼•æ“" tabindex="-1"><a class="header-anchor" href="#innodbå¼•æ“"><span>InnoDBå¼•æ“</span></a></h2><h3 id="é€»è¾‘å­˜å‚¨ç»“æ„" tabindex="-1"><a class="header-anchor" href="#é€»è¾‘å­˜å‚¨ç»“æ„"><span>**é€»è¾‘å­˜å‚¨ç»“æ„ **</span></a></h3><p>InnoDBçš„é€»è¾‘å­˜å‚¨ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º: <img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/InnoDB01.png" alt="image.png" loading="lazy"><br> 1). è¡¨ç©ºé—´è¡¨ç©ºé—´æ˜¯InnoDBå­˜å‚¨å¼•æ“é€»è¾‘ç»“æ„çš„æœ€é«˜å±‚ï¼Œ å¦‚æœç”¨æˆ·å¯ç”¨äº†å‚æ•° innodb_file_per_table(åœ¨<br> 8.0ç‰ˆæœ¬ä¸­é»˜è®¤å¼€å¯) ï¼Œåˆ™æ¯å¼ è¡¨éƒ½ä¼šæœ‰ä¸€ä¸ªè¡¨ç©ºé—´ï¼ˆxxx.ibdï¼‰ï¼Œä¸€ä¸ªmysqlå®ä¾‹å¯ä»¥å¯¹åº”å¤šä¸ªè¡¨ç©º<br> é—´ï¼Œç”¨äºå­˜å‚¨è®°å½•ã€ç´¢å¼•ç­‰æ•°æ®ã€‚<br> 2). æ®µ<br> æ®µï¼Œåˆ†ä¸ºæ•°æ®æ®µï¼ˆLeaf node segmentï¼‰ã€ç´¢å¼•æ®µï¼ˆNon-leaf node segmentï¼‰ã€å›æ»šæ®µ<br> ï¼ˆRollback segmentï¼‰ï¼ŒInnoDBæ˜¯ç´¢å¼•ç»„ç»‡è¡¨ï¼Œæ•°æ®æ®µå°±æ˜¯B+æ ‘çš„å¶å­èŠ‚ç‚¹ï¼Œ ç´¢å¼•æ®µå³ä¸ºB+æ ‘çš„<br> éå¶å­èŠ‚ç‚¹ã€‚æ®µç”¨æ¥ç®¡ç†å¤šä¸ªExtentï¼ˆåŒºï¼‰ã€‚<br> 3). åŒº<br> åŒºï¼Œè¡¨ç©ºé—´çš„å•å…ƒç»“æ„ï¼Œæ¯ä¸ªåŒºçš„å¤§å°ä¸º1Mã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ InnoDBå­˜å‚¨å¼•æ“é¡µå¤§å°ä¸º16Kï¼Œ å³ä¸€<br> ä¸ªåŒºä¸­ä¸€å…±æœ‰64ä¸ªè¿ç»­çš„é¡µã€‚<br> 4). é¡µ<br> é¡µï¼Œæ˜¯InnoDB å­˜å‚¨å¼•æ“ç£ç›˜ç®¡ç†çš„æœ€å°å•å…ƒï¼Œæ¯ä¸ªé¡µçš„å¤§å°é»˜è®¤ä¸º 16KBã€‚ä¸ºäº†ä¿è¯é¡µçš„è¿ç»­æ€§ï¼Œ<br> InnoDB å­˜å‚¨å¼•æ“æ¯æ¬¡ä»ç£ç›˜ç”³è¯· 4-5 ä¸ªåŒºã€‚<br> 5). è¡Œ<br> è¡Œï¼ŒInnoDB å­˜å‚¨å¼•æ“æ•°æ®æ˜¯æŒ‰è¡Œè¿›è¡Œå­˜æ”¾çš„ã€‚<br> åœ¨è¡Œä¸­ï¼Œé»˜è®¤æœ‰ä¸¤ä¸ªéšè—å­—æ®µï¼š<br> Trx_idï¼šæ¯æ¬¡å¯¹æŸæ¡è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼šæŠŠå¯¹åº”çš„äº‹åŠ¡idèµ‹å€¼ç»™trx_idéšè—åˆ—ã€‚<br> Roll_pointerï¼šæ¯æ¬¡å¯¹æŸæ¡å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼šæŠŠæ—§çš„ç‰ˆæœ¬å†™å…¥åˆ°undoæ—¥å¿—ä¸­ï¼Œç„¶åè¿™ä¸ª<br> éšè—åˆ—å°±ç›¸å½“äºä¸€ä¸ªæŒ‡é’ˆï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥æ‰¾åˆ°è¯¥è®°å½•ä¿®æ”¹å‰çš„ä¿¡æ¯ã€‚</p><h3 id="æ¶æ„" tabindex="-1"><a class="header-anchor" href="#æ¶æ„"><span>æ¶æ„</span></a></h3><h4 id="æ¦‚è¿°-3" tabindex="-1"><a class="header-anchor" href="#æ¦‚è¿°-3"><span>æ¦‚è¿°</span></a></h4><p>MySQL5.5 ç‰ˆæœ¬å¼€å§‹ï¼Œé»˜è®¤ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“ï¼Œå®ƒæ“…é•¿äº‹åŠ¡å¤„ç†ï¼Œå…·æœ‰å´©æºƒæ¢å¤ç‰¹æ€§ï¼Œåœ¨æ—¥å¸¸å¼€å‘ ä¸­ä½¿ç”¨éå¸¸å¹¿æ³›ã€‚ä¸‹é¢æ˜¯InnoDBæ¶æ„å›¾ï¼Œå·¦ä¾§ä¸ºå†…å­˜ç»“æ„ï¼Œå³ä¾§ä¸ºç£ç›˜ç»“æ„ã€‚<img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/InnoDB02.png" alt="image.png" loading="lazy"></p><h4 id="å†…å­˜ç»“æ„" tabindex="-1"><a class="header-anchor" href="#å†…å­˜ç»“æ„"><span>å†…å­˜ç»“æ„</span></a></h4><p><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/InnoDB03.png" alt="image.png" loading="lazy"><br> åœ¨å·¦ä¾§çš„å†…å­˜ç»“æ„ä¸­ï¼Œä¸»è¦åˆ†ä¸ºå››å¤§å—å„¿ï¼š Buffer Poolã€Change Bufferã€Adaptive Hash Indexã€Log Bufferã€‚</p><ol><li>Buffer Pool</li></ol><p>InnoDBå­˜å‚¨å¼•æ“åŸºäºç£ç›˜æ–‡ä»¶å­˜å‚¨ï¼Œè®¿é—®ç‰©ç†ç¡¬ç›˜å’Œåœ¨å†…å­˜ä¸­è¿›è¡Œè®¿é—®ï¼Œé€Ÿåº¦ç›¸å·®å¾ˆå¤§ï¼Œä¸ºäº†å°½å¯èƒ½ å¼¥è¡¥è¿™ä¸¤è€…ä¹‹é—´çš„I/Oæ•ˆç‡çš„å·®å€¼ï¼Œå°±éœ€è¦æŠŠç»å¸¸ä½¿ç”¨çš„æ•°æ®åŠ è½½åˆ°ç¼“å†²æ± ä¸­ï¼Œé¿å…æ¯æ¬¡è®¿é—®éƒ½è¿›è¡Œç£ ç›˜I/Oã€‚<br> åœ¨InnoDBçš„ç¼“å†²æ± ä¸­ä¸ä»…ç¼“å­˜äº†ç´¢å¼•é¡µå’Œæ•°æ®é¡µï¼Œè¿˜åŒ…å«äº†undoé¡µã€æ’å…¥ç¼“å­˜ã€è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ä»¥åŠInnoDBçš„é”ä¿¡æ¯ç­‰ç­‰ã€‚<br> ç¼“å†²æ±  Buffer Poolï¼Œæ˜¯ä¸»å†…å­˜ä¸­çš„ä¸€ä¸ªåŒºåŸŸï¼Œé‡Œé¢å¯ä»¥ç¼“å­˜ç£ç›˜ä¸Šç»å¸¸æ“ä½œçš„çœŸå®æ•°æ®ï¼Œåœ¨æ‰§è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œæ—¶ï¼Œå…ˆæ“ä½œç¼“å†²æ± ä¸­çš„æ•°æ®ï¼ˆè‹¥ç¼“å†²æ± æ²¡æœ‰æ•°æ®ï¼Œåˆ™ä»ç£ç›˜åŠ è½½å¹¶ç¼“å­˜ï¼‰ï¼Œç„¶åå†ä»¥ä¸€å®šé¢‘ç‡åˆ·æ–°åˆ°ç£ç›˜ï¼Œä»è€Œå‡å°‘ç£ç›˜IOï¼ŒåŠ å¿«å¤„ç†é€Ÿåº¦ã€‚<br> ç¼“å†²æ± ä»¥Pageé¡µä¸ºå•ä½ï¼Œåº•å±‚é‡‡ç”¨é“¾è¡¨æ•°æ®ç»“æ„ç®¡ç†Pageã€‚æ ¹æ®çŠ¶æ€ï¼Œå°†Pageåˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š</p><ul><li>free pageï¼šç©ºé—²pageï¼Œæœªè¢«ä½¿ç”¨ã€‚</li><li>clean pageï¼šè¢«ä½¿ç”¨pageï¼Œæ•°æ®æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚</li><li>dirty pageï¼šè„é¡µï¼Œè¢«ä½¿ç”¨pageï¼Œæ•°æ®è¢«ä¿®æ”¹è¿‡ï¼Œä¹Ÿä¸­æ•°æ®ä¸ç£ç›˜çš„æ•°æ®äº§ç”Ÿäº†ä¸ä¸€è‡´ã€‚</li></ul><p>åœ¨ä¸“ç”¨æœåŠ¡å™¨ä¸Šï¼Œé€šå¸¸å°†å¤šè¾¾80ï¼…çš„ç‰©ç†å†…å­˜åˆ†é…ç»™ç¼“å†²æ±  ã€‚å‚æ•°è®¾ç½®ï¼š <code>show variables like &#39;innodb_buffer_pool_size&#39;;</code></p><ol start="2"><li>Change Buffer</li></ol><p>Change Bufferï¼Œæ›´æ”¹ç¼“å†²åŒºï¼ˆé’ˆå¯¹äºéå”¯ä¸€äºŒçº§ç´¢å¼•é¡µï¼‰ï¼Œåœ¨æ‰§è¡ŒDMLè¯­å¥æ—¶ï¼Œå¦‚æœè¿™äº›æ•°æ®Page æ²¡æœ‰åœ¨Buffer Poolä¸­ï¼Œä¸ä¼šç›´æ¥æ“ä½œç£ç›˜ï¼Œè€Œä¼šå°†æ•°æ®å˜æ›´å­˜åœ¨æ›´æ”¹ç¼“å†²åŒº Change Bufferä¸­ï¼Œåœ¨æœªæ¥æ•°æ®è¢«è¯»å–æ—¶ï¼Œå†å°†æ•°æ®åˆå¹¶æ¢å¤åˆ°Buffer Poolä¸­ï¼Œå†å°†åˆå¹¶åçš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚<br> Change Bufferçš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢?<br> ä¸èšé›†ç´¢å¼•ä¸åŒï¼ŒäºŒçº§ç´¢å¼•é€šå¸¸æ˜¯éå”¯ä¸€çš„ï¼Œå¹¶ä¸”ä»¥ç›¸å¯¹éšæœºçš„é¡ºåºæ’å…¥äºŒçº§ç´¢å¼•ã€‚åŒæ ·ï¼Œåˆ é™¤å’Œæ›´æ–°å¯èƒ½ä¼šå½±å“ç´¢å¼•æ ‘ä¸­ä¸ç›¸é‚»çš„äºŒçº§ç´¢å¼•é¡µï¼Œå¦‚æœæ¯ä¸€æ¬¡éƒ½æ“ä½œç£ç›˜ï¼Œä¼šé€ æˆå¤§é‡çš„ç£ç›˜IOã€‚æœ‰äº†ChangeBufferä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¼“å†²æ± ä¸­è¿›è¡Œåˆå¹¶å¤„ç†ï¼Œå‡å°‘ç£ç›˜IOã€‚</p><ol start="3"><li>Adaptive Hash Index</li></ol><p>è‡ªé€‚åº”hashç´¢å¼•ï¼Œç”¨äºä¼˜åŒ–å¯¹Buffer Poolæ•°æ®çš„æŸ¥è¯¢ã€‚MySQLçš„innoDBå¼•æ“ä¸­è™½ç„¶æ²¡æœ‰ç›´æ¥æ”¯æŒhashç´¢å¼•ï¼Œä½†æ˜¯ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯è¿™ä¸ªè‡ªé€‚åº”hashç´¢å¼•ã€‚å› ä¸ºå‰é¢æˆ‘ä»¬è®²åˆ°è¿‡ï¼Œhashç´¢å¼•åœ¨è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ï¼Œä¸€èˆ¬æ€§èƒ½æ˜¯è¦é«˜äºB+æ ‘çš„ï¼Œå› ä¸ºhashç´¢å¼•ä¸€èˆ¬åªéœ€è¦ä¸€æ¬¡IOå³å¯ï¼Œè€ŒB+æ ‘ï¼Œå¯èƒ½éœ€è¦å‡ æ¬¡åŒ¹é…ï¼Œæ‰€ä»¥hashç´¢å¼•çš„æ•ˆç‡è¦é«˜ï¼Œä½†æ˜¯hashç´¢å¼•åˆä¸é€‚åˆåšèŒƒå›´æŸ¥è¯¢ã€æ¨¡ç³ŠåŒ¹é…ç­‰ã€‚<br> InnoDBå­˜å‚¨å¼•æ“ä¼šç›‘æ§å¯¹è¡¨ä¸Šå„ç´¢å¼•é¡µçš„æŸ¥è¯¢ï¼Œå¦‚æœè§‚å¯Ÿåˆ°åœ¨ç‰¹å®šçš„æ¡ä»¶ä¸‹hashç´¢å¼•å¯ä»¥æå‡é€Ÿåº¦ï¼Œåˆ™å»ºç«‹hashç´¢å¼•ï¼Œç§°ä¹‹ä¸ºè‡ªé€‚åº”hashç´¢å¼•ã€‚<br> **è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ï¼Œæ— éœ€äººå·¥å¹²é¢„ï¼Œæ˜¯ç³»ç»Ÿæ ¹æ®æƒ…å†µè‡ªåŠ¨å®Œæˆã€‚ **<br> å‚æ•°ï¼š adaptive_hash_index</p><ol start="4"><li>Log Buffer</li></ol><p>Log Bufferï¼šæ—¥å¿—ç¼“å†²åŒºï¼Œç”¨æ¥ä¿å­˜è¦å†™å…¥åˆ°ç£ç›˜ä¸­çš„logæ—¥å¿—æ•°æ®ï¼ˆredo log ã€undo logï¼‰ï¼Œ<br> é»˜è®¤å¤§å°ä¸º 16MBï¼Œæ—¥å¿—ç¼“å†²åŒºçš„æ—¥å¿—ä¼šå®šæœŸåˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚å¦‚æœéœ€è¦æ›´æ–°ã€æ’å…¥æˆ–åˆ é™¤è®¸å¤šè¡Œçš„äº‹<br> åŠ¡ï¼Œå¢åŠ æ—¥å¿—ç¼“å†²åŒºçš„å¤§å°å¯ä»¥èŠ‚çœç£ç›˜ I/Oã€‚<br> å‚æ•°:<br> innodb_log_buffer_sizeï¼šç¼“å†²åŒºå¤§å°<br> innodb_flush_log_at_trx_commitï¼šæ—¥å¿—åˆ·æ–°åˆ°ç£ç›˜æ—¶æœºï¼Œå–å€¼ä¸»è¦åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªï¼š<br> 1: æ—¥å¿—åœ¨æ¯æ¬¡äº‹åŠ¡æäº¤æ—¶å†™å…¥å¹¶åˆ·æ–°åˆ°ç£ç›˜ï¼Œé»˜è®¤å€¼ã€‚<br> 0: æ¯ç§’å°†æ—¥å¿—å†™å…¥å¹¶åˆ·æ–°åˆ°ç£ç›˜ä¸€æ¬¡ã€‚2: æ—¥å¿—åœ¨æ¯æ¬¡äº‹åŠ¡æäº¤åå†™å…¥ï¼Œå¹¶æ¯ç§’åˆ·æ–°åˆ°ç£ç›˜ä¸€æ¬¡ã€‚</p><h3 id="ç£ç›˜ç»“æ„" tabindex="-1"><a class="header-anchor" href="#ç£ç›˜ç»“æ„"><span>ç£ç›˜ç»“æ„</span></a></h3><figure><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/InnoDB04.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><ol><li>System Tablespace</li></ol><p>ç³»ç»Ÿè¡¨ç©ºé—´æ˜¯æ›´æ”¹ç¼“å†²åŒºçš„å­˜å‚¨åŒºåŸŸã€‚å¦‚æœè¡¨æ˜¯åœ¨ç³»ç»Ÿè¡¨ç©ºé—´è€Œä¸æ˜¯æ¯ä¸ªè¡¨æ–‡ä»¶æˆ–é€šç”¨è¡¨ç©ºé—´ä¸­åˆ›å»º çš„ï¼Œå®ƒä¹Ÿå¯èƒ½åŒ…å«è¡¨å’Œç´¢å¼•æ•°æ®ã€‚(åœ¨MySQL5.xç‰ˆæœ¬ä¸­è¿˜åŒ…å«InnoDBæ•°æ®å­—å…¸ã€undologç­‰)<br> å‚æ•°ï¼šinnodb_data_file_path<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/InnoDB05.png" alt="image.png" loading="lazy"><br> ç³»ç»Ÿè¡¨ç©ºé—´ï¼Œé»˜è®¤çš„æ–‡ä»¶åå« ibdata1ã€‚</p><ol start="2"><li>File-Per-Table Tablespaces</li></ol><p>å¦‚æœå¼€å¯äº†innodb_file_per_tableå¼€å…³ ï¼Œåˆ™æ¯ä¸ªè¡¨çš„æ–‡ä»¶,è¡¨ç©ºé—´åŒ…å«å•ä¸ªInnoDBè¡¨çš„æ•°æ®å’Œç´¢å¼• ï¼Œå¹¶å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„å•ä¸ªæ•°æ®æ–‡ä»¶ä¸­ã€‚<br> å¼€å…³å‚æ•°ï¼šinnodb_file_per_table ï¼Œè¯¥å‚æ•°é»˜è®¤å¼€å¯ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/InnoDB06.png" alt="image.png" loading="lazy"><br> é‚£ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ¯åˆ›å»ºä¸€ä¸ªè¡¨ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªè¡¨ç©ºé—´æ–‡ä»¶ï¼Œå¦‚å›¾ï¼š<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/InnoDB07.png" alt="image.png" loading="lazy"></p><ol start="3"><li>General Tablespaces</li></ol><p>é€šç”¨è¡¨ç©ºé—´ï¼Œéœ€è¦é€šè¿‡ CREATE TABLESPACE è¯­æ³•åˆ›å»ºé€šç”¨è¡¨ç©ºé—´ï¼Œåœ¨åˆ›å»ºè¡¨æ—¶å¯ä»¥æŒ‡å®šè¯¥è¡¨ç©ºé—´ã€‚</p><ul><li>åˆ›å»ºè¡¨ç©ºé—´</li></ul><p><code>CREATE TABLESPACE ts_name ADD DATAFILE &#39;file_name&#39; ENGINE = engine_name; </code><br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/InnoDB08.png" alt="image.png" loading="lazy"></p><ul><li>åˆ›å»ºè¡¨æ—¶æŒ‡å®šè¡¨ç©ºé—´</li></ul><p><code>CREATE TABLE xxx ... TABLESPACE ts_name;</code><br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/InnoDB08.png" alt="image.png" loading="lazy"></p><ol start="4"><li>Undo Tablespaces</li></ol><p>æ’¤é”€è¡¨ç©ºé—´ï¼ŒMySQLå®ä¾‹åœ¨åˆå§‹åŒ–æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºä¸¤ä¸ªé»˜è®¤çš„undoè¡¨ç©ºé—´ï¼ˆåˆå§‹å¤§å°16Mï¼‰ï¼Œç”¨äºå­˜å‚¨ undo logæ—¥å¿—ã€‚</p><ol start="5"><li>Temporary Tablespaces</li></ol><p>InnoDB ä½¿ç”¨ä¼šè¯ä¸´æ—¶è¡¨ç©ºé—´å’Œå…¨å±€ä¸´æ—¶è¡¨ç©ºé—´ã€‚å­˜å‚¨ç”¨æˆ·åˆ›å»ºçš„ä¸´æ—¶è¡¨ç­‰æ•°æ®ã€‚</p><ol start="6"><li>Doublewrite Buffer Files</li></ol><p>åŒå†™ç¼“å†²åŒºï¼ŒinnoDBå¼•æ“å°†æ•°æ®é¡µä»Buffer Poolåˆ·æ–°åˆ°ç£ç›˜å‰ï¼Œå…ˆå°†æ•°æ®é¡µå†™å…¥åŒå†™ç¼“å†²åŒºæ–‡ä»¶ä¸­ï¼Œä¾¿äºç³»ç»Ÿå¼‚å¸¸æ—¶æ¢å¤æ•°æ®ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/InnoDB09.png" alt="image.png" loading="lazy"></p><ol start="7"><li>Redo Log</li></ol><p>é‡åšæ—¥å¿—ï¼Œæ˜¯ç”¨æ¥å®ç°äº‹åŠ¡çš„æŒä¹…æ€§ã€‚è¯¥æ—¥å¿—æ–‡ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šé‡åšæ—¥å¿—ç¼“å†²ï¼ˆredo log<br> bufferï¼‰ä»¥åŠé‡åšæ—¥å¿—æ–‡ä»¶ï¼ˆredo logï¼‰,å‰è€…æ˜¯åœ¨å†…å­˜ä¸­ï¼Œåè€…åœ¨ç£ç›˜ä¸­ã€‚å½“äº‹åŠ¡æäº¤ä¹‹åä¼šæŠŠæ‰€<br> æœ‰ä¿®æ”¹ä¿¡æ¯éƒ½ä¼šå­˜åˆ°è¯¥æ—¥å¿—ä¸­, ç”¨äºåœ¨åˆ·æ–°è„é¡µåˆ°ç£ç›˜æ—¶,å‘ç”Ÿé”™è¯¯æ—¶, è¿›è¡Œæ•°æ®æ¢å¤ä½¿ç”¨ã€‚<br> ä»¥å¾ªç¯æ–¹å¼å†™å…¥é‡åšæ—¥å¿—æ–‡ä»¶ï¼Œæ¶‰åŠä¸¤ä¸ªæ–‡ä»¶ï¼š<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/InnoDB10.png" alt="image.png" loading="lazy"></p><hr><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†InnoDBçš„å†…å­˜ç»“æ„ï¼Œä»¥åŠç£ç›˜ç»“æ„ï¼Œé‚£ä¹ˆå†…å­˜ä¸­æˆ‘ä»¬æ‰€æ›´æ–°çš„æ•°æ®ï¼Œåˆæ˜¯å¦‚ä½•åˆ°ç£ç›˜<br> ä¸­çš„å‘¢ï¼Ÿ æ­¤æ—¶ï¼Œå°±æ¶‰åŠåˆ°ä¸€ç»„åå°çº¿ç¨‹ï¼Œæ¥ä¸‹æ¥ï¼Œå°±æ¥ä»‹ç»ä¸€äº›InnoDBä¸­æ¶‰åŠåˆ°çš„åå°çº¿ç¨‹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/InnoDB11.png" alt="image.png" loading="lazy"></p><h3 id="åå°çº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#åå°çº¿ç¨‹"><span>åå°çº¿ç¨‹</span></a></h3><p><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/InnoDB12.png" alt="image.png" loading="lazy"><br> åœ¨InnoDBçš„åå°çº¿ç¨‹ä¸­ï¼Œåˆ†ä¸º4ç±»ï¼Œåˆ†åˆ«æ˜¯ï¼šMaster Thread ã€IO Threadã€Purge Threadã€<br> Page Cleaner Threadã€‚</p><ol><li>Master Thread</li></ol><p>æ ¸å¿ƒåå°çº¿ç¨‹ï¼Œè´Ÿè´£è°ƒåº¦å…¶ä»–çº¿ç¨‹ï¼Œè¿˜è´Ÿè´£å°†ç¼“å†²æ± ä¸­çš„æ•°æ®å¼‚æ­¥åˆ·æ–°åˆ°ç£ç›˜ä¸­, ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ï¼Œ<br> è¿˜åŒ…æ‹¬è„é¡µçš„åˆ·æ–°ã€åˆå¹¶æ’å…¥ç¼“å­˜ã€undoé¡µçš„å›æ”¶ ã€‚</p><ol start="2"><li>IO Thread</li></ol><p>åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­å¤§é‡ä½¿ç”¨äº†AIOæ¥å¤„ç†IOè¯·æ±‚, è¿™æ ·å¯ä»¥æå¤§åœ°æé«˜æ•°æ®åº“çš„æ€§èƒ½ï¼Œè€ŒIO<br> Threadä¸»è¦è´Ÿè´£è¿™äº›IOè¯·æ±‚çš„å›è°ƒã€‚</p><table><thead><tr><th>çº¿ç¨‹ç±»å‹</th><th>é»˜è®¤ä¸ªæ•°</th><th>èŒè´£</th></tr></thead><tbody><tr><td>Read thread</td><td>4</td><td>è´Ÿè´£è¯»æ“ä½œ</td></tr><tr><td>Write thread</td><td>4</td><td>è´Ÿè´£å†™æ“ä½œ</td></tr><tr><td>Log thread</td><td>1</td><td>è´Ÿè´£å°†æ—¥å¿—ç¼“å†²åŒºåˆ·æ–°åˆ°ç£ç›˜</td></tr><tr><td>Insert buffer thread</td><td>1</td><td>è´Ÿè´£å°†å†™ç¼“å†²åŒºå†…å®¹åˆ·æ–°åˆ°ç£ç›˜</td></tr></tbody></table><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">show</span> <span class="token keyword">engine</span> <span class="token keyword">innodb</span> <span class="token keyword">status</span> \G<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/InnoDB13.png" alt="éƒ¨åˆ†ä¿¡æ¯" tabindex="0" loading="lazy"><figcaption>éƒ¨åˆ†ä¿¡æ¯</figcaption></figure><ol start="3"><li>Purge Thread</li></ol><p>ä¸»è¦ç”¨äºå›æ”¶äº‹åŠ¡å·²ç»æäº¤äº†çš„undo logï¼Œåœ¨äº‹åŠ¡æäº¤ä¹‹åï¼Œundo logå¯èƒ½ä¸ç”¨äº†ï¼Œå°±ç”¨å®ƒæ¥å›æ”¶ã€‚</p><ol start="4"><li>Page Cleaner Thread</li></ol><p>ååŠ© Master Thread åˆ·æ–°è„é¡µåˆ°ç£ç›˜çš„çº¿ç¨‹ï¼Œå®ƒå¯ä»¥å‡è½» Master Thread çš„å·¥ä½œå‹åŠ›ï¼Œå‡å°‘é˜»å¡ã€‚</p><h3 id="äº‹åŠ¡åŸç†" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡åŸç†"><span>äº‹åŠ¡åŸç†</span></a></h3><h4 id="åŸºç¡€" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€"><span>åŸºç¡€</span></a></h4><ol><li>äº‹åŠ¡</li></ol><p>äº‹åŠ¡ æ˜¯ä¸€ç»„æ“ä½œçš„é›†åˆï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¼šæŠŠæ‰€æœ‰çš„æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“ä¸€èµ·å‘ç³»<br> ç»Ÿæäº¤æˆ–æ’¤é”€æ“ä½œè¯·æ±‚ï¼Œå³è¿™äº›æ“ä½œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚</p><ol start="2"><li>ç‰¹æ€§</li></ol><ul><li>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œå•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</li><li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€ã€‚</li><li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›çš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ç‹¬ç«‹ç¯å¢ƒä¸‹è¿è¡Œã€‚</li><li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆ–å›æ»šï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…çš„</li></ul><p>ç ”ç©¶äº‹åŠ¡çš„åŸç†ï¼Œå°±æ˜¯ç ”ç©¶MySQLçš„InnoDBå¼•æ“æ˜¯å¦‚ä½•ä¿è¯äº‹åŠ¡çš„è¿™å››å¤§ç‰¹æ€§ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/InnoDB14.png" alt="image.png" loading="lazy"><br> å¯¹äºè¿™å››å¤§ç‰¹æ€§ï¼Œå®é™…ä¸Šåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ã€‚ å…¶ä¸­çš„åŸå­æ€§ã€ä¸€è‡´æ€§ã€æŒä¹…åŒ–ï¼Œå®é™…ä¸Šæ˜¯ç”±InnoDBä¸­çš„<br> ä¸¤ä»½æ—¥å¿—æ¥ä¿è¯çš„ï¼Œä¸€ä»½æ˜¯redo logæ—¥å¿—ï¼Œä¸€ä»½æ˜¯undo logæ—¥å¿—ã€‚ è€ŒæŒä¹…æ€§æ˜¯é€šè¿‡æ•°æ®åº“çš„é”ï¼Œ<br> åŠ ä¸ŠMVCCæ¥ä¿è¯çš„ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/InnoDB15.png" alt="image.png" loading="lazy"><br> äº‹åŠ¡åŸç†ï¼Œä¸»è¦å°±æ˜¯ç ”ç©¶redologï¼Œundologä»¥åŠMVCCã€‚</p><h4 id="redo-log" tabindex="-1"><a class="header-anchor" href="#redo-log"><span>redo log</span></a></h4><p>é‡åšæ—¥å¿—ï¼Œè®°å½•çš„æ˜¯äº‹åŠ¡æäº¤æ—¶æ•°æ®é¡µçš„ç‰©ç†ä¿®æ”¹ï¼Œæ˜¯ç”¨æ¥å®ç°äº‹åŠ¡çš„æŒä¹…æ€§ã€‚<br> è¯¥æ—¥å¿—æ–‡ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šé‡åšæ—¥å¿—ç¼“å†²ï¼ˆredo log bufferï¼‰ä»¥åŠé‡åšæ—¥å¿—æ–‡ä»¶ï¼ˆredo log<br> fileï¼‰,å‰è€…æ˜¯åœ¨å†…å­˜ä¸­ï¼Œåè€…åœ¨ç£ç›˜ä¸­ã€‚å½“äº‹åŠ¡æäº¤ä¹‹åä¼šæŠŠæ‰€æœ‰ä¿®æ”¹ä¿¡æ¯éƒ½å­˜åˆ°è¯¥æ—¥å¿—æ–‡ä»¶ä¸­, ç”¨<br> äºåœ¨åˆ·æ–°è„é¡µåˆ°ç£ç›˜,å‘ç”Ÿé”™è¯¯æ—¶, è¿›è¡Œæ•°æ®æ¢å¤ä½¿ç”¨ã€‚</p><hr><p>å¦‚æœæ²¡æœ‰redologï¼Œå¯èƒ½ä¼šå­˜åœ¨ä»€ä¹ˆé—®é¢˜çš„ï¼Ÿ<br> åœ¨InnoDBå¼•æ“ä¸­çš„å†…å­˜ç»“æ„ä¸­ï¼Œä¸»è¦çš„å†…å­˜åŒºåŸŸå°±æ˜¯ç¼“å†²æ± ï¼Œåœ¨ç¼“å†²æ± ä¸­ç¼“å­˜äº†å¾ˆå¤šçš„æ•°æ®é¡µã€‚ å½“æˆ‘ä»¬åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œæ‰§è¡Œå¤šä¸ªå¢åˆ æ”¹çš„æ“ä½œæ—¶ï¼ŒInnoDBå¼•æ“ä¼šå…ˆæ“ä½œç¼“å†²æ± ä¸­çš„æ•°æ®ï¼Œå¦‚æœç¼“å†²åŒºæ²¡æœ‰å¯¹åº”çš„æ•°æ®ï¼Œä¼šé€šè¿‡åå°çº¿ç¨‹å°†ç£ç›˜ä¸­çš„æ•°æ®åŠ è½½å‡ºæ¥ï¼Œå­˜æ”¾åœ¨ç¼“å†²åŒºä¸­ï¼Œç„¶åå°†ç¼“å†²æ± ä¸­çš„æ•°æ®ä¿®æ”¹ï¼Œä¿®æ”¹åçš„æ•°æ®é¡µæˆ‘ä»¬ç§°ä¸ºè„é¡µã€‚ è€Œè„é¡µåˆ™ä¼šåœ¨ä¸€å®šçš„æ—¶æœºï¼Œé€šè¿‡åå°çº¿ç¨‹åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œä»è€Œä¿è¯ç¼“å†²åŒºä¸ç£ç›˜çš„æ•°æ®ä¸€è‡´ã€‚ è€Œç¼“å†²åŒºçš„è„é¡µæ•°æ®å¹¶ä¸æ˜¯å®æ—¶åˆ·æ–°çš„ï¼Œè€Œæ˜¯ä¸€æ®µæ—¶é—´ä¹‹åå°†ç¼“å†²åŒºçš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œå‡å¦‚åˆ·æ–°åˆ°ç£ç›˜çš„è¿‡ç¨‹å‡ºé”™äº†ï¼Œè€Œæç¤ºç»™ç”¨æˆ·äº‹åŠ¡æäº¤æˆåŠŸï¼Œè€Œæ•°æ®å´ æ²¡æœ‰æŒä¹…åŒ–ä¸‹æ¥ï¼Œè¿™å°±å‡ºç°é—®é¢˜äº†ï¼Œæ²¡æœ‰ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ã€‚ <img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/InnoDB16.png" alt="image.png" loading="lazy"><br> å¦‚ä½•è§£å†³ä¸Šè¿°çš„é—®é¢˜å‘¢ï¼Ÿ åœ¨InnoDBä¸­æä¾›äº†ä¸€ä»½æ—¥å¿— redo logï¼Œé€šè¿‡redologå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/InnoDB17.png" alt="image.png" loading="lazy"><br> æœ‰äº†redologä¹‹åï¼Œå½“å¯¹ç¼“å†²åŒºçš„æ•°æ®è¿›è¡Œå¢åˆ æ”¹ä¹‹åï¼Œä¼šé¦–å…ˆå°†æ“ä½œçš„æ•°æ®é¡µçš„å˜åŒ–ï¼Œè®°å½•åœ¨redo<br> log bufferä¸­ã€‚åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œä¼šå°†redo log bufferä¸­çš„æ•°æ®åˆ·æ–°åˆ°redo logç£ç›˜æ–‡ä»¶ä¸­ã€‚<br> è¿‡ä¸€æ®µæ—¶é—´ä¹‹åï¼Œå¦‚æœåˆ·æ–°ç¼“å†²åŒºçš„è„é¡µåˆ°ç£ç›˜æ—¶ï¼Œå‘ç”Ÿé”™è¯¯ï¼Œæ­¤æ—¶å°±å¯ä»¥å€ŸåŠ©äºredo logè¿›è¡Œæ•°æ®<br> æ¢å¤ï¼Œè¿™æ ·å°±ä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§ã€‚ è€Œå¦‚æœè„é¡µæˆåŠŸåˆ·æ–°åˆ°ç£ç›˜ æˆ– æˆ–è€…æ¶‰åŠåˆ°çš„æ•°æ®å·²ç»è½ç›˜ï¼Œæ­¤<br> æ—¶redologå°±æ²¡æœ‰ä½œç”¨äº†ï¼Œå°±å¯ä»¥åˆ é™¤äº†ï¼Œæ‰€ä»¥å­˜åœ¨çš„ä¸¤ä¸ªredologæ–‡ä»¶æ˜¯å¾ªç¯å†™çš„ã€‚</p><hr><p>ä¸ºä»€ä¹ˆæ¯ä¸€æ¬¡æäº¤äº‹åŠ¡ï¼Œè¦åˆ·æ–°redo logåˆ°ç£ç›˜ï¼Œè€Œä¸æ˜¯ç›´æ¥å°†buffer poolä¸­çš„è„é¡µåˆ·æ–°åˆ°ç£ç›˜å‘¢ ?<br> å› ä¸ºåœ¨ä¸šåŠ¡æ“ä½œä¸­ï¼Œæˆ‘ä»¬æ“ä½œæ•°æ®ä¸€èˆ¬éƒ½æ˜¯éšæœºè¯»å†™ç£ç›˜çš„ï¼Œè€Œä¸æ˜¯é¡ºåºè¯»å†™ç£ç›˜ã€‚ è€Œredo logåœ¨<br> å¾€ç£ç›˜æ–‡ä»¶ä¸­å†™å…¥æ•°æ®ï¼Œç”±äºæ˜¯<strong>æ—¥å¿—æ–‡ä»¶</strong>ï¼Œæ‰€ä»¥éƒ½æ˜¯<strong>é¡ºåº</strong>å†™çš„ã€‚é¡ºåºå†™çš„æ•ˆç‡è¦è¿œå¤§äºéšæœºå†™ã€‚ è¿™<br> ç§å…ˆå†™æ—¥å¿—çš„æ–¹å¼ï¼Œç§°ä¹‹ä¸º <strong>WAL</strong>ï¼ˆWrite-Ahead Loggingï¼‰ã€‚</p><h4 id="undo-log" tabindex="-1"><a class="header-anchor" href="#undo-log"><span>undo log</span></a></h4><p>å›æ»šæ—¥å¿—ï¼Œç”¨äºè®°å½•æ•°æ®è¢«ä¿®æ”¹å‰çš„ä¿¡æ¯ , ä½œç”¨åŒ…å«ä¸¤ä¸ª : æä¾›å›æ»š(ä¿è¯äº‹åŠ¡çš„åŸå­æ€§) å’Œ<br> MVCC(å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶) ã€‚<br> undo logå’Œredo logè®°å½•ç‰©ç†æ—¥å¿—ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯<strong>é€»è¾‘æ—¥å¿—</strong>ã€‚å¯ä»¥è®¤ä¸ºå½“deleteä¸€æ¡è®°å½•æ—¶ï¼Œundo<br> logä¸­ä¼šè®°å½•ä¸€æ¡å¯¹åº”çš„insertè®°å½•ï¼Œåä¹‹äº¦ç„¶ï¼Œå½“updateä¸€æ¡è®°å½•æ—¶ï¼Œå®ƒè®°å½•ä¸€æ¡å¯¹åº”ç›¸åçš„<br> updateè®°å½•ã€‚å½“æ‰§è¡Œrollbackæ—¶ï¼Œå°±å¯ä»¥ä»undo logä¸­çš„é€»è¾‘è®°å½•è¯»å–åˆ°ç›¸åº”çš„å†…å®¹å¹¶è¿›è¡Œå›æ»šã€‚<br> Undo logé”€æ¯ï¼šundo logåœ¨äº‹åŠ¡æ‰§è¡Œæ—¶äº§ç”Ÿï¼Œäº‹åŠ¡æäº¤æ—¶ï¼Œå¹¶ä¸ä¼šç«‹å³åˆ é™¤undo logï¼Œå› ä¸ºè¿™äº›<br> æ—¥å¿—å¯èƒ½è¿˜ç”¨äºMVCCã€‚<br> Undo logå­˜å‚¨ï¼šundo logé‡‡ç”¨æ®µçš„æ–¹å¼è¿›è¡Œç®¡ç†å’Œè®°å½•ï¼Œå­˜æ”¾åœ¨å‰é¢ä»‹ç»çš„ rollback segment<br> å›æ»šæ®µä¸­ï¼Œå†…éƒ¨åŒ…å«1024ä¸ªundo log segmentã€‚</p><h3 id="mvcc" tabindex="-1"><a class="header-anchor" href="#mvcc"><span>MVCC</span></a></h3><h4 id="åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h4><ol><li>å½“å‰è¯»</li></ol><p>è¯»å–çš„æ˜¯è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¯»å–æ—¶è¿˜è¦ä¿è¯å…¶ä»–å¹¶å‘äº‹åŠ¡ä¸èƒ½ä¿®æ”¹å½“å‰è®°å½•ï¼Œä¼šå¯¹è¯»å–çš„è®°å½•è¿›è¡ŒåŠ <br> é”ã€‚å¯¹äºæˆ‘ä»¬æ—¥å¸¸çš„æ“ä½œï¼Œå¦‚ï¼šselect ... lock in share mode(å…±äº«é”)ï¼Œselect ... for updateã€updateã€insertã€delete(æ’ä»–é”)éƒ½æ˜¯ä¸€ç§å½“å‰è¯»ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/MVCC01.png" alt="image.png" loading="lazy"><br> åœ¨æµ‹è¯•ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿æ˜¯åœ¨é»˜è®¤çš„RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡Aä¸­ä¾ç„¶å¯ä»¥è¯»å–åˆ°äº‹åŠ¡Bæœ€æ–°æäº¤çš„å†… å®¹ï¼Œå› ä¸ºåœ¨æŸ¥è¯¢è¯­å¥åé¢åŠ ä¸Šäº† lock in share mode å…±äº«é”ï¼Œæ­¤æ—¶æ˜¯å½“å‰è¯»æ“ä½œã€‚å½“ç„¶ï¼Œå½“æˆ‘ä»¬åŠ æ’ä»–é”çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯å½“å‰è¯»æ“ä½œã€‚</p><ol start="2"><li>å¿«ç…§è¯»</li></ol><p>ç®€å•çš„selectï¼ˆä¸åŠ é”ï¼‰å°±æ˜¯å¿«ç…§è¯»ï¼Œå¿«ç…§è¯»ï¼Œè¯»å–çš„æ˜¯è®°å½•æ•°æ®çš„å¯è§ç‰ˆæœ¬ï¼Œæœ‰å¯èƒ½æ˜¯å†å²æ•°æ®ï¼Œ ä¸åŠ é”ï¼Œæ˜¯éé˜»å¡è¯»ã€‚<br> â€¢ Read Committedï¼šæ¯æ¬¡selectï¼Œéƒ½ç”Ÿæˆä¸€ä¸ªå¿«ç…§è¯»ã€‚<br> â€¢ Repeatable Readï¼šå¼€å¯äº‹åŠ¡åç¬¬ä¸€ä¸ªselectè¯­å¥æ‰æ˜¯å¿«ç…§è¯»çš„åœ°æ–¹ã€‚<br> â€¢ Serializableï¼šå¿«ç…§è¯»ä¼šé€€åŒ–ä¸ºå½“å‰è¯»ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/MVCC02.png" alt="image.png" loading="lazy"><br> åœ¨æµ‹è¯•ä¸­,æˆ‘ä»¬çœ‹åˆ°å³ä½¿äº‹åŠ¡Bæäº¤äº†æ•°æ®,äº‹åŠ¡Aä¸­ä¹ŸæŸ¥è¯¢ä¸åˆ°ã€‚ åŸå› å°±æ˜¯å› ä¸ºæ™®é€šçš„selectæ˜¯å¿«ç…§<br> è¯»ï¼Œè€Œåœ¨å½“å‰é»˜è®¤çš„RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œå¼€å¯äº‹åŠ¡åç¬¬ä¸€ä¸ªselectè¯­å¥æ‰æ˜¯å¿«ç…§è¯»çš„åœ°æ–¹ï¼Œåé¢æ‰§è¡Œç›¸åŒ<br> çš„selectè¯­å¥éƒ½æ˜¯ä»å¿«ç…§ä¸­è·å–æ•°æ®ï¼Œå¯èƒ½ä¸æ˜¯å½“å‰çš„æœ€æ–°æ•°æ®ï¼Œè¿™æ ·ä¹Ÿå°±ä¿è¯äº†å¯é‡å¤è¯»ã€‚</p><ol start="3"><li>MVCC</li></ol><p>å…¨ç§° Multi-Version Concurrency Controlï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚æŒ‡ç»´æŠ¤ä¸€ä¸ªæ•°æ®çš„å¤šä¸ªç‰ˆæœ¬ï¼Œ ä½¿å¾—è¯»å†™æ“ä½œæ²¡æœ‰å†²çªï¼Œå¿«ç…§è¯»ä¸ºMySQLå®ç°MVCCæä¾›äº†ä¸€ä¸ªéé˜»å¡è¯»åŠŸèƒ½ã€‚MVCCçš„å…·ä½“å®ç°ï¼Œè¿˜éœ€è¦ä¾èµ–äºæ•°æ®åº“è®°å½•ä¸­çš„<strong>ä¸‰ä¸ªéšå¼å­—æ®µ</strong>ã€<strong>undo logæ—¥å¿—</strong>ã€<strong>readView</strong>ã€‚</p><h4 id="éšè—å­—æ®µ" tabindex="-1"><a class="header-anchor" href="#éšè—å­—æ®µ"><span>éšè—å­—æ®µ</span></a></h4><table><thead><tr><th style="text-align:center;">id</th><th style="text-align:center;">age</th><th style="text-align:center;">name</th></tr></thead><tbody><tr><td style="text-align:center;">1</td><td style="text-align:center;">1</td><td style="text-align:center;">tom</td></tr><tr><td style="text-align:center;">3</td><td style="text-align:center;">3</td><td style="text-align:center;">cat</td></tr></tbody></table><p>å½“æˆ‘ä»¬åˆ›å»ºäº†ä¸Šé¢çš„è¿™å¼ è¡¨ï¼Œæˆ‘ä»¬åœ¨æŸ¥çœ‹è¡¨ç»“æ„çš„æ—¶å€™ï¼Œå°±å¯ä»¥æ˜¾å¼çš„çœ‹åˆ°è¿™ä¸‰ä¸ªå­—æ®µã€‚ å®é™…ä¸Šé™¤äº†<br> è¿™ä¸‰ä¸ªå­—æ®µä»¥å¤–ï¼ŒInnoDBè¿˜ä¼šè‡ªåŠ¨çš„ç»™æˆ‘ä»¬æ·»åŠ ä¸‰ä¸ªéšè—å­—æ®µåŠå…¶å«ä¹‰åˆ†åˆ«æ˜¯ï¼š</p><table><thead><tr><th style="text-align:center;">éšè—å­—æ®µ</th><th style="text-align:center;">å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:center;">DB_TRX_ID</td><td style="text-align:center;">æœ€è¿‘ä¿®æ”¹äº‹åŠ¡IDï¼Œè®°å½•æ’å…¥è¿™æ¡è®°å½•æˆ–æœ€åä¸€æ¬¡ä¿®æ”¹è¯¥è®°å½•çš„äº‹åŠ¡ID</td></tr><tr><td style="text-align:center;">DB_ROLL_PTR</td><td style="text-align:center;">å›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘è¿™æ¡è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼Œç”¨äºé…åˆundo logï¼ŒæŒ‡å‘ä¸Šä¸€ä¸ªç‰ˆæœ¬</td></tr><tr><td style="text-align:center;">DB_ROW_ID</td><td style="text-align:center;">éšè—ä¸»é”®ï¼Œå¦‚æœè¡¨ç»“æ„æ²¡æœ‰æŒ‡å®šä¸»é”®ï¼Œå°†ä¼šç”Ÿæˆè¯¥éšè—å­—æ®µ</td></tr></tbody></table><hr><p>è¿›å…¥æ•°æ®åº“å¯¹åº”çš„åº“çš„æ–‡ä»¶å¤¹å¦‚ï¼š/var/lib/mysql/itcast/,æŸ¥çœ‹stuçš„è¡¨ç»“æ„ä¿¡æ¯, é€šè¿‡å¦‚ä¸‹æŒ‡ä»¤</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>ibd2sdi stu<span class="token punctuation">.</span>ibd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="undo-log-1" tabindex="-1"><a class="header-anchor" href="#undo-log-1"><span>undo log</span></a></h4><h5 id="ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#ä»‹ç»"><span>ä»‹ç»</span></a></h5><p>å›æ»šæ—¥å¿—ï¼Œåœ¨insertã€updateã€deleteçš„æ—¶å€™äº§ç”Ÿçš„ä¾¿äºæ•°æ®å›æ»šçš„æ—¥å¿—ã€‚<br> å½“insertçš„æ—¶å€™ï¼Œäº§ç”Ÿçš„undo logæ—¥å¿—åªåœ¨å›æ»šæ—¶éœ€è¦ï¼Œåœ¨äº‹åŠ¡æäº¤åï¼Œå¯è¢«ç«‹å³åˆ é™¤ã€‚<br> è€Œupdateã€deleteçš„æ—¶å€™ï¼Œäº§ç”Ÿçš„undo logæ—¥å¿—ä¸ä»…åœ¨å›æ»šæ—¶éœ€è¦ï¼Œåœ¨å¿«ç…§è¯»æ—¶ä¹Ÿéœ€è¦ï¼Œä¸ä¼šç«‹å³<br> è¢«åˆ é™¤ã€‚</p><h5 id="ç‰ˆæœ¬é“¾" tabindex="-1"><a class="header-anchor" href="#ç‰ˆæœ¬é“¾"><span>ç‰ˆæœ¬é“¾</span></a></h5><p>æœ‰ä¸€å¼ è¡¨åŸå§‹æ•°æ®ä¸ºï¼š</p><table><thead><tr><th>id</th><th>age</th><th>name</th><th>DB_TRX_ID</th><th>DB_ROLL_PTR</th></tr></thead><tbody><tr><td>30</td><td>30</td><td>A30</td><td>1</td><td>null</td></tr></tbody></table><blockquote><p>DB_TRX_ID : ä»£è¡¨æœ€è¿‘ä¿®æ”¹äº‹åŠ¡IDï¼Œè®°å½•æ’å…¥è¿™æ¡è®°å½•æˆ–æœ€åä¸€æ¬¡ä¿®æ”¹è¯¥è®°å½•çš„äº‹åŠ¡IDï¼Œæ˜¯è‡ªå¢çš„ã€‚<br> DB_ROLL_PTR ï¼š ç”±äºè¿™æ¡æ•°æ®æ˜¯æ‰æ’å…¥çš„ï¼Œæ²¡æœ‰è¢«æ›´æ–°è¿‡ï¼Œæ‰€ä»¥è¯¥å­—æ®µå€¼ä¸ºnullã€‚</p></blockquote><p>ç„¶åï¼Œæœ‰å››ä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶åœ¨è®¿é—®è¿™å¼ è¡¨ã€‚</p><ol><li>ç¬¬ä¸€æ­¥</li></ol><p><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/MVCC03.png" alt="image.png" loading="lazy"><br> å½“äº‹åŠ¡2æ‰§è¡Œç¬¬ä¸€æ¡ä¿®æ”¹è¯­å¥æ—¶ï¼Œä¼šè®°å½•undo logæ—¥å¿—ï¼Œè®°å½•æ•°æ®å˜æ›´ä¹‹å‰çš„æ ·å­; ç„¶åæ›´æ–°è®°å½•ï¼Œ<br> å¹¶ä¸”è®°å½•æœ¬æ¬¡æ“ä½œçš„äº‹åŠ¡IDï¼Œå›æ»šæŒ‡é’ˆï¼Œå›æ»šæŒ‡é’ˆç”¨æ¥æŒ‡å®šå¦‚æœå‘ç”Ÿå›æ»šï¼Œå›æ»šåˆ°å“ªä¸€ä¸ªç‰ˆæœ¬ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/MVCC04.png" alt="image.png" loading="lazy"></p><ol start="2"><li>ç¬¬äºŒæ­¥</li></ol><p><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/MVCC05.png" alt="image.png" loading="lazy"><br> å½“äº‹åŠ¡3æ‰§è¡Œç¬¬ä¸€æ¡ä¿®æ”¹è¯­å¥æ—¶ï¼Œä¹Ÿä¼šè®°å½•undo logæ—¥å¿—ï¼Œè®°å½•æ•°æ®å˜æ›´ä¹‹å‰çš„æ ·å­; ç„¶åæ›´æ–°è®°<br> å½•ï¼Œå¹¶ä¸”è®°å½•æœ¬æ¬¡æ“ä½œçš„äº‹åŠ¡IDï¼Œå›æ»šæŒ‡é’ˆï¼Œå›æ»šæŒ‡é’ˆç”¨æ¥æŒ‡å®šå¦‚æœå‘ç”Ÿå›æ»šï¼Œå›æ»šåˆ°å“ªä¸€ä¸ªç‰ˆæœ¬ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/MVCC06.png" alt="image.png" loading="lazy"></p><ol start="3"><li>ç¬¬å››æ­¥</li></ol><p><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/MVCC07.png" alt="image.png" loading="lazy"><br> å½“äº‹åŠ¡4æ‰§è¡Œç¬¬ä¸€æ¡ä¿®æ”¹è¯­å¥æ—¶ï¼Œä¹Ÿä¼šè®°å½•undo logæ—¥å¿—ï¼Œè®°å½•æ•°æ®å˜æ›´ä¹‹å‰çš„æ ·å­; ç„¶åæ›´æ–°è®°<br> å½•ï¼Œå¹¶ä¸”è®°å½•æœ¬æ¬¡æ“ä½œçš„äº‹åŠ¡IDï¼Œå›æ»šæŒ‡é’ˆï¼Œå›æ»šæŒ‡é’ˆç”¨æ¥æŒ‡å®šå¦‚æœå‘ç”Ÿå›æ»šï¼Œå›æ»šåˆ°å“ªä¸€ä¸ªç‰ˆæœ¬ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/MVCC08.png" alt="image.png" loading="lazy"></p><blockquote><p>æœ€ç»ˆæˆ‘ä»¬å‘ç°ï¼Œä¸åŒäº‹åŠ¡æˆ–ç›¸åŒäº‹åŠ¡å¯¹åŒä¸€æ¡è®°å½•è¿›è¡Œä¿®æ”¹ï¼Œä¼šå¯¼è‡´è¯¥è®°å½•çš„undologç”Ÿæˆä¸€æ¡è®°å½•ç‰ˆæœ¬é“¾è¡¨ï¼Œé“¾è¡¨çš„å¤´éƒ¨æ˜¯æœ€æ–°çš„æ—§è®°å½•ï¼Œé“¾è¡¨å°¾éƒ¨æ˜¯æœ€æ—©çš„æ—§è®°å½•ã€‚</p></blockquote><h4 id="readview" tabindex="-1"><a class="header-anchor" href="#readview"><span>readview</span></a></h4><p>ReadViewï¼ˆè¯»è§†å›¾ï¼‰æ˜¯ å¿«ç…§è¯» SQLæ‰§è¡Œæ—¶MVCCæå–æ•°æ®çš„ä¾æ®ï¼Œè®°å½•å¹¶ç»´æŠ¤ç³»ç»Ÿå½“å‰æ´»è·ƒçš„äº‹åŠ¡<br> ï¼ˆæœªæäº¤çš„ï¼‰idã€‚<br> ReadViewä¸­åŒ…å«äº†å››ä¸ªæ ¸å¿ƒå­—æ®µï¼š</p><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>m_ids</td><td>å½“å‰æ´»è·ƒçš„äº‹åŠ¡IDé›†åˆ</td></tr><tr><td>min_trx_id</td><td>æœ€å°æ´»è·ƒäº‹åŠ¡ID</td></tr><tr><td>max_trx_id</td><td>é¢„åˆ†é…äº‹åŠ¡IDï¼Œå½“å‰æœ€å¤§äº‹åŠ¡ID+1ï¼ˆå› ä¸ºäº‹åŠ¡IDæ˜¯è‡ªå¢çš„ï¼‰</td></tr><tr><td>creator_trx_id</td><td>ReadViewåˆ›å»ºè€…çš„äº‹åŠ¡ID</td></tr></tbody></table><p>åœ¨readviewä¸­è§„å®šäº†ç‰ˆæœ¬é“¾æ•°æ®çš„è®¿é—®è§„åˆ™ï¼š</p><blockquote><p>trx_id ä»£è¡¨å½“å‰undologç‰ˆæœ¬é“¾å¯¹åº”äº‹åŠ¡IDã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/MVCC09.png" alt="image.png" loading="lazy"><br> ä¸åŒçš„éš”ç¦»çº§åˆ«ï¼Œç”ŸæˆReadViewçš„æ—¶æœºä¸åŒï¼š</p><ul><li>READ COMMITTED ï¼šåœ¨äº‹åŠ¡ä¸­æ¯ä¸€æ¬¡æ‰§è¡Œå¿«ç…§è¯»æ—¶ç”ŸæˆReadViewã€‚</li><li>REPEATABLE READï¼šä»…åœ¨äº‹åŠ¡ä¸­ç¬¬ä¸€æ¬¡æ‰§è¡Œå¿«ç…§è¯»æ—¶ç”ŸæˆReadViewï¼Œåç»­å¤ç”¨è¯¥ReadViewã€‚</li></ul><h4 id="åŸç†åˆ†æ" tabindex="-1"><a class="header-anchor" href="#åŸç†åˆ†æ"><span>åŸç†åˆ†æ</span></a></h4><h5 id="read-committedéš”ç¦»çº§åˆ«" tabindex="-1"><a class="header-anchor" href="#read-committedéš”ç¦»çº§åˆ«"><span>READ COMMITTEDéš”ç¦»çº§åˆ«</span></a></h5><p>RCéš”ç¦»çº§åˆ«ä¸‹ï¼Œåœ¨äº‹åŠ¡ä¸­æ¯ä¸€æ¬¡æ‰§è¡Œå¿«ç…§è¯»æ—¶ç”ŸæˆReadViewã€‚</p><hr><p>åˆ†æäº‹åŠ¡5ä¸­ï¼Œä¸¤æ¬¡å¿«ç…§è¯»è¯»å–æ•°æ®ï¼Œæ˜¯å¦‚ä½•è·å–æ•°æ®çš„?<br> åœ¨äº‹åŠ¡5ä¸­ï¼ŒæŸ¥è¯¢äº†ä¸¤æ¬¡idä¸º30çš„è®°å½•ï¼Œç”±äºéš”ç¦»çº§åˆ«ä¸ºRead Committedï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡è¿›è¡Œå¿«ç…§è¯»éƒ½ä¼šç”Ÿæˆä¸€ä¸ªReadViewï¼Œé‚£ä¹ˆä¸¤æ¬¡ç”Ÿæˆçš„ReadViewå¦‚ä¸‹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/MVCC10.png" alt="image.png" loading="lazy"><br> é‚£ä¹ˆè¿™ä¸¤æ¬¡å¿«ç…§è¯»åœ¨è·å–æ•°æ®æ—¶ï¼Œå°±éœ€è¦æ ¹æ®æ‰€ç”Ÿæˆçš„ReadViewä»¥åŠReadViewçš„ç‰ˆæœ¬é“¾è®¿é—®è§„åˆ™ï¼Œåˆ°undologç‰ˆæœ¬é“¾ä¸­åŒ¹é…æ•°æ®ï¼Œæœ€ç»ˆå†³å®šæ­¤æ¬¡å¿«ç…§è¯»è¿”å›çš„æ•°æ®ã€‚</p><hr><ul><li>ç¬¬ä¸€æ¬¡å¿«ç…§è¯»å…·ä½“çš„è¯»å–è¿‡ç¨‹ï¼š</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/MVCC11.png" alt="image.png" loading="lazy"><br> åœ¨è¿›è¡ŒåŒ¹é…æ—¶ï¼Œä¼šä»undo logçš„ç‰ˆæœ¬é“¾ï¼Œä»ä¸Šåˆ°ä¸‹è¿›è¡ŒæŒ¨ä¸ªåŒ¹é…ï¼š</p><ol><li>å…ˆåŒ¹é…</li></ol><table><thead><tr><th>id</th><th>age</th><th>name</th><th>DB_TRX_ID</th><th>DB_ROLL_PTR</th></tr></thead><tbody><tr><td>30</td><td>10</td><td>A3</td><td>4</td><td>0x00003</td></tr></tbody></table><p>è¿™æ¡è®°å½•ï¼Œè¿™æ¡è®°å½•å¯¹åº”çš„ trx_idä¸º4ï¼Œä¹Ÿå°±æ˜¯å°†4å¸¦å…¥å³ä¾§çš„åŒ¹é…è§„åˆ™ä¸­ã€‚ â‘ ä¸æ»¡è¶³ â‘¡ä¸æ»¡è¶³ â‘¢ä¸æ»¡è¶³ â‘£ä¹Ÿä¸æ»¡è¶³ ï¼Œéƒ½ä¸æ»¡è¶³ï¼Œåˆ™ç»§ç»­åŒ¹é…undo logç‰ˆæœ¬é“¾çš„ä¸‹ä¸€æ¡ã€‚</p><ol start="2"><li>å†åŒ¹é…ç¬¬äºŒæ¡</li></ol><table><thead><tr><th>0x00003</th><th>30</th><th>3</th><th>A3</th><th>3</th><th>0x00002</th></tr></thead></table><p>è¿™æ¡è®°å½•å¯¹åº”çš„trx_idä¸º3ï¼Œä¹Ÿå°±æ˜¯å°†3å¸¦å…¥å³ä¾§çš„åŒ¹é…è§„åˆ™ä¸­ã€‚â‘ ä¸æ»¡è¶³ â‘¡ä¸æ»¡è¶³ â‘¢ä¸æ»¡è¶³ â‘£ä¹Ÿ<br> ä¸æ»¡è¶³ ï¼Œéƒ½ä¸æ»¡è¶³ï¼Œåˆ™ç»§ç»­åŒ¹é…undo logç‰ˆæœ¬é“¾çš„ä¸‹ä¸€æ¡ã€‚</p><ol start="3"><li>å†åŒ¹é…ç¬¬ä¸‰æ¡</li></ol><table><thead><tr><th>0x00002</th><th>30</th><th>3</th><th>A30</th><th>2</th><th>0x00001</th></tr></thead></table><p>è¿™æ¡è®°å½•å¯¹åº”çš„trx_idä¸º2ï¼Œä¹Ÿå°±æ˜¯å°†2å¸¦å…¥å³ä¾§çš„åŒ¹é…è§„åˆ™ä¸­ã€‚â‘ ä¸æ»¡è¶³ â‘¡æ»¡è¶³ ç»ˆæ­¢åŒ¹é…ï¼Œæ­¤æ¬¡å¿«ç…§<br> è¯»ï¼Œè¿”å›çš„æ•°æ®å°±æ˜¯ç‰ˆæœ¬é“¾ä¸­è®°å½•çš„è¿™æ¡æ•°æ®ã€‚</p><ul><li>ç¬¬äºŒæ¬¡å¿«ç…§è¯»å…·ä½“çš„è¯»å–è¿‡ç¨‹:</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/MVCC12.png" alt="image.png" loading="lazy"><br> åœ¨è¿›è¡ŒåŒ¹é…æ—¶ï¼Œä¼šä»undo logçš„ç‰ˆæœ¬é“¾ï¼Œä»ä¸Šåˆ°ä¸‹è¿›è¡ŒæŒ¨ä¸ªåŒ¹é…ï¼š</p><ul><li>å…ˆåŒ¹é…1</li></ul><table><thead><tr><th>id</th><th>age</th><th>name</th><th>DB_TRX</th><th>DB_ROLL_PTR</th></tr></thead><tbody><tr><td>30</td><td>10</td><td>A3</td><td>4</td><td>0x00003</td></tr></tbody></table><p>è¿™æ¡è®°å½•ï¼Œè¿™æ¡è®°å½•å¯¹åº”çš„ trx_idä¸º4ï¼Œä¹Ÿå°±æ˜¯å°†4å¸¦å…¥å³ä¾§çš„åŒ¹é…è§„åˆ™ä¸­ã€‚ â‘ ä¸æ»¡è¶³ â‘¡ä¸æ»¡è¶³ â‘¢ä¸æ»¡è¶³ â‘£ä¹Ÿä¸æ»¡è¶³ ï¼Œ éƒ½ä¸æ»¡è¶³ï¼Œåˆ™ç»§ç»­åŒ¹é…undo logç‰ˆæœ¬é“¾çš„ä¸‹ä¸€æ¡ã€‚</p><ul><li>åŒ¹é…ç¬¬2æ¡</li></ul><table><thead><tr><th>0x00003</th><th>30</th><th>3</th><th>A3</th><th>3</th><th>0x00002</th></tr></thead></table><p>è¿™æ¡è®°å½•å¯¹åº”çš„trx_idä¸º3ï¼Œä¹Ÿå°±æ˜¯å°†3å¸¦å…¥å³ä¾§çš„åŒ¹é…è§„åˆ™ä¸­ã€‚â‘ ä¸æ»¡è¶³ â‘¡æ»¡è¶³ ã€‚ç»ˆæ­¢åŒ¹é…ï¼Œæ­¤æ¬¡ å¿«ç…§è¯»ï¼Œè¿”å›çš„æ•°æ®å°±æ˜¯ç‰ˆæœ¬é“¾ä¸­è®°å½•çš„è¿™æ¡æ•°æ®ã€‚</p><h5 id="read-repeated-éš”ç¦»çº§åˆ«" tabindex="-1"><a class="header-anchor" href="#read-repeated-éš”ç¦»çº§åˆ«"><span>Read Repeated éš”ç¦»çº§åˆ«</span></a></h5><p>RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œä»…åœ¨äº‹åŠ¡ä¸­ç¬¬ä¸€æ¬¡æ‰§è¡Œå¿«ç…§è¯»æ—¶ç”ŸæˆReadViewï¼Œåç»­å¤ç”¨è¯¥ReadViewã€‚ è€ŒRR æ˜¯å¯<br> é‡å¤è¯»ï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œæ‰§è¡Œä¸¤æ¬¡ç›¸åŒçš„selectè¯­å¥ï¼ŒæŸ¥è¯¢åˆ°çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/MVCC13.png" alt="image.png" loading="lazy"><br> åœ¨RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œåªæ˜¯åœ¨äº‹åŠ¡ä¸­ç¬¬ä¸€æ¬¡å¿«ç…§è¯»æ—¶ç”ŸæˆReadViewï¼Œåç»­éƒ½æ˜¯å¤ç”¨è¯¥ ReadViewï¼Œé‚£ä¹ˆæ—¢ç„¶ReadViewéƒ½ä¸€æ ·ï¼Œ ReadViewçš„ç‰ˆæœ¬é“¾åŒ¹é…è§„åˆ™ä¹Ÿä¸€æ ·ï¼Œ é‚£ä¹ˆæœ€ç»ˆå¿«ç…§è¯»è¿”å›çš„ç»“æœä¹Ÿæ˜¯ä¸€æ ·çš„</p><hr><p>MVCCçš„å®ç°åŸç†å°±æ˜¯é€šè¿‡ InnoDBè¡¨çš„éšè—å­—æ®µã€UndoLog ç‰ˆæœ¬é“¾ã€ReadViewæ¥å®ç°çš„ã€‚<br> è€ŒMVCC + é”ï¼Œåˆ™å®ç°äº†äº‹åŠ¡çš„éš”ç¦»æ€§ã€‚ è€Œä¸€è‡´æ€§åˆ™æ˜¯ç”±redolog ä¸ undologä¿è¯ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/MVCC14.png" alt="image.png" loading="lazy"></p><h2 id="mysqlç®¡ç†" tabindex="-1"><a class="header-anchor" href="#mysqlç®¡ç†"><span>MySQLç®¡ç†</span></a></h2><h3 id="ç³»ç»Ÿæ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#ç³»ç»Ÿæ•°æ®åº“"><span>ç³»ç»Ÿæ•°æ®åº“</span></a></h3><p>Mysqlæ•°æ®åº“å®‰è£…å®Œæˆåï¼Œè‡ªå¸¦äº†ä¸€ä¸‹å››ä¸ªæ•°æ®åº“ï¼Œå…·ä½“ä½œç”¨å¦‚ä¸‹ï¼š<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/manage01.png" alt="image.png" loading="lazy"></p><h3 id="å¸¸ç”¨å·¥å…·" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨å·¥å…·"><span>å¸¸ç”¨å·¥å…·</span></a></h3><h4 id="mysql" tabindex="-1"><a class="header-anchor" href="#mysql"><span>mysql</span></a></h4><p>è¯¥mysqlä¸æ˜¯æŒ‡mysqlæœåŠ¡ï¼Œè€Œæ˜¯æŒ‡mysqlçš„å®¢æˆ·ç«¯å·¥å…·ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>è¯­æ³• ï¼š
  mysql <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>database<span class="token punctuation">]</span>
é€‰é¡¹ ï¼š
  -u, <span class="token parameter variable">--user</span><span class="token operator">=</span>name <span class="token comment">#æŒ‡å®šç”¨æˆ·å</span>
  -p, --password<span class="token punctuation">[</span><span class="token operator">=</span>name<span class="token punctuation">]</span> <span class="token comment">#æŒ‡å®šå¯†ç </span>
  -h, <span class="token parameter variable">--host</span><span class="token operator">=</span>name <span class="token comment">#æŒ‡å®šæœåŠ¡å™¨IPæˆ–åŸŸå</span>
  -P, <span class="token parameter variable">--port</span><span class="token operator">=</span>port <span class="token comment">#æŒ‡å®šè¿æ¥ç«¯å£</span>
  -e, <span class="token parameter variable">--execute</span><span class="token operator">=</span>name <span class="token comment">#æ‰§è¡ŒSQLè¯­å¥å¹¶é€€å‡º</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>-eé€‰é¡¹å¯ä»¥åœ¨Mysqlå®¢æˆ·ç«¯æ‰§è¡ŒSQLè¯­å¥ï¼Œè€Œä¸ç”¨è¿æ¥åˆ°MySQLæ•°æ®åº“å†æ‰§è¡Œï¼Œå¯¹äºä¸€äº›æ‰¹å¤„ç†è„šæœ¬ï¼Œ è¿™ç§æ–¹å¼å°¤å…¶æ–¹ä¾¿ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>mysql <span class="token operator">-</span>uroot â€“p123456 db01 <span class="token operator">-</span>e <span class="token string">&quot;select * from stu&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="mysqladmin" tabindex="-1"><a class="header-anchor" href="#mysqladmin"><span>mysqladmin</span></a></h4><p>mysqladmin æ˜¯ä¸€ä¸ªæ‰§è¡Œç®¡ç†æ“ä½œçš„å®¢æˆ·ç«¯ç¨‹åºã€‚å¯ä»¥ç”¨å®ƒæ¥æ£€æŸ¥æœåŠ¡å™¨çš„é…ç½®å’Œå½“å‰çŠ¶æ€ã€åˆ›å»ºå¹¶<br> åˆ é™¤æ•°æ®åº“ç­‰ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mysqladmin <span class="token parameter variable">--help</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>è¯­æ³•:
  mysqladmin <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token builtin class-name">command</span> <span class="token punctuation">..</span>.
é€‰é¡¹:
  -u, <span class="token parameter variable">--user</span><span class="token operator">=</span>name <span class="token comment">#æŒ‡å®šç”¨æˆ·å</span>
  -p, --password<span class="token punctuation">[</span><span class="token operator">=</span>name<span class="token punctuation">]</span> <span class="token comment">#æŒ‡å®šå¯†ç </span>
  -h, <span class="token parameter variable">--host</span><span class="token operator">=</span>name <span class="token comment">#æŒ‡å®šæœåŠ¡å™¨IPæˆ–åŸŸå</span>
  -P, <span class="token parameter variable">--port</span><span class="token operator">=</span>port <span class="token comment">#æŒ‡å®šè¿æ¥ç«¯å£</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mysqladmin <span class="token parameter variable">-uroot</span> â€“p1234 drop <span class="token string">&#39;test01&#39;</span><span class="token punctuation">;</span>
mysqladmin <span class="token parameter variable">-uroot</span> â€“p1234 version<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="mysqlbinlog" tabindex="-1"><a class="header-anchor" href="#mysqlbinlog"><span>mysqlbinlog</span></a></h4><p>ç”±äºæœåŠ¡å™¨ç”Ÿæˆçš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ä»¥äºŒè¿›åˆ¶æ ¼å¼ä¿å­˜ï¼Œæ‰€ä»¥å¦‚æœæƒ³è¦æ£€æŸ¥è¿™äº›æ–‡æœ¬çš„æ–‡æœ¬æ ¼å¼ï¼Œå°±ä¼šä½¿ç”¨åˆ°mysqlbinlog æ—¥å¿—ç®¡ç†å·¥å…·ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>è¯­æ³• ï¼š
  mysqlbinlog <span class="token punctuation">[</span>options<span class="token punctuation">]</span> log-files1 log-files2 <span class="token punctuation">..</span>.
é€‰é¡¹ ï¼š
  -d, <span class="token parameter variable">--database</span><span class="token operator">=</span>name æŒ‡å®šæ•°æ®åº“åç§°ï¼Œåªåˆ—å‡ºæŒ‡å®šçš„æ•°æ®åº“ç›¸å…³æ“ä½œã€‚
  -o, <span class="token parameter variable">--offset</span><span class="token operator">=</span><span class="token comment">## å¿½ç•¥æ‰æ—¥å¿—ä¸­çš„å‰nè¡Œå‘½ä»¤ã€‚</span>
  -r, --result-file<span class="token operator">=</span>name å°†è¾“å‡ºçš„æ–‡æœ¬æ ¼å¼æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ã€‚
  -s, --short-form æ˜¾ç¤ºç®€å•æ ¼å¼ï¼Œ çœç•¥æ‰ä¸€äº›ä¿¡æ¯ã€‚
  --start-datatime<span class="token operator">=</span>date1 --stop-datetime<span class="token operator">=</span>date2 æŒ‡å®šæ—¥æœŸé—´éš”å†…çš„æ‰€æœ‰æ—¥å¿—ã€‚
  --start-position<span class="token operator">=</span>pos1 --stop-position<span class="token operator">=</span>pos2 æŒ‡å®šä½ç½®é—´éš”å†…çš„æ‰€æœ‰æ—¥å¿—ã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mysqlbinlog <span class="token parameter variable">-s</span> binlog.000008
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="mysqlshow" tabindex="-1"><a class="header-anchor" href="#mysqlshow"><span>mysqlshow</span></a></h4><p>mysqlshow å®¢æˆ·ç«¯å¯¹è±¡æŸ¥æ‰¾å·¥å…·ï¼Œç”¨æ¥å¾ˆå¿«åœ°æŸ¥æ‰¾å­˜åœ¨å“ªäº›æ•°æ®åº“ã€æ•°æ®åº“ä¸­çš„è¡¨ã€è¡¨ä¸­çš„åˆ—æˆ–è€…ç´¢<br> å¼•ï¼Œå¸®åŠ©ç”¨æˆ·æŸ¥çœ‹æ•°æ®åº“çš„ç»“æ„å’Œå…ƒæ•°æ®ä¿¡æ¯ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>è¯­æ³•ï¼š
  mysqlshow <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>db_name <span class="token punctuation">[</span>table_name <span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
é€‰é¡¹ï¼š
  <span class="token parameter variable">--count</span> æ˜¾ç¤ºæ•°æ®åº“åŠè¡¨çš„ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ•°æ®åº“ï¼Œè¡¨ å‡å¯ä»¥ä¸æŒ‡å®šï¼‰
  <span class="token parameter variable">-i</span> æ˜¾ç¤ºæŒ‡å®šæ•°æ®åº“æˆ–è€…æŒ‡å®šè¡¨çš„çŠ¶æ€ä¿¡æ¯
ç¤ºä¾‹ï¼š
  <span class="token comment">#æŸ¥è¯¢teståº“ä¸­æ¯ä¸ªè¡¨ä¸­çš„å­—æ®µæ•°åŠè¡Œæ•°</span>
  mysqlshow <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p2143</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">--count</span>
  <span class="token comment">#æŸ¥è¯¢teståº“ä¸­bookè¡¨çš„è¯¦ç»†æƒ…å†µ</span>
  mysqlshow <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p2143</span> <span class="token builtin class-name">test</span> book <span class="token parameter variable">--count</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mysqlshow <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p1234</span> <span class="token parameter variable">--count</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mysqlshow <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p1234</span> db01 <span class="token parameter variable">--count</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mysqlshow <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p1234</span> db01 course <span class="token parameter variable">--count</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mysqlshow <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p1234</span> db01 course <span class="token function">id</span> <span class="token parameter variable">--count</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="mysqldump" tabindex="-1"><a class="header-anchor" href="#mysqldump"><span>mysqldump</span></a></h4><p>mysqldump å®¢æˆ·ç«¯å·¥å…·ç”¨æ¥å¤‡ä»½æ•°æ®åº“æˆ–åœ¨ä¸åŒæ•°æ®åº“ä¹‹é—´è¿›è¡Œæ•°æ®è¿ç§»ã€‚å¤‡ä»½å†…å®¹åŒ…å«åˆ›å»ºè¡¨ï¼ŒåŠæ’å…¥è¡¨çš„SQLè¯­å¥ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>è¯­æ³• ï¼š
  mysqldump <span class="token punctuation">[</span>options<span class="token punctuation">]</span> db_name <span class="token punctuation">[</span>tables<span class="token punctuation">]</span>
  mysqldump <span class="token punctuation">[</span>options<span class="token punctuation">]</span> --database/-B db1 <span class="token punctuation">[</span>db2 db3<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
  mysqldump <span class="token punctuation">[</span>options<span class="token punctuation">]</span> --all-databases/-A
è¿æ¥é€‰é¡¹ ï¼š
  -u, <span class="token parameter variable">--user</span><span class="token operator">=</span>name æŒ‡å®šç”¨æˆ·å
  -p, --password<span class="token punctuation">[</span><span class="token operator">=</span>name<span class="token punctuation">]</span> æŒ‡å®šå¯†ç 
  -h, <span class="token parameter variable">--host</span><span class="token operator">=</span>name æŒ‡å®šæœåŠ¡å™¨ipæˆ–åŸŸå
  -P, <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token comment">## æŒ‡å®šè¿æ¥ç«¯å£</span>
è¾“å‡ºé€‰é¡¹ï¼š
  --add-drop-database åœ¨æ¯ä¸ªæ•°æ®åº“åˆ›å»ºè¯­å¥å‰åŠ ä¸Š drop database è¯­å¥
  --add-drop-table åœ¨æ¯ä¸ªè¡¨åˆ›å»ºè¯­å¥å‰åŠ ä¸Š drop table è¯­å¥,é»˜è®¤å¼€å¯<span class="token punctuation">;</span>ä¸å¼€å¯<span class="token punctuation">(</span>--skip-add-drop-table<span class="token punctuation">)</span>
  -n, --no-create-db ä¸åŒ…å«æ•°æ®åº“çš„åˆ›å»ºè¯­å¥
  -t, --no-create-info ä¸åŒ…å«æ•°æ®è¡¨çš„åˆ›å»ºè¯­å¥
  <span class="token parameter variable">-d</span> --no-data ä¸åŒ…å«æ•°æ®
  -T, <span class="token parameter variable">--tab</span><span class="token operator">=</span>name è‡ªåŠ¨ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼šä¸€ä¸ª.sqlæ–‡ä»¶ï¼Œåˆ›å»ºè¡¨ç»“æ„çš„è¯­å¥ï¼›ä¸€ä¸ª.txtæ–‡ä»¶ï¼Œæ•°æ®æ–‡ä»¶
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p1234</span> db01 <span class="token operator">&gt;</span> db01.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¤‡ä»½å‡ºæ¥çš„æ•°æ®åŒ…å«ï¼š</p><ul><li>åˆ é™¤è¡¨çš„è¯­å¥</li><li>åˆ›å»ºè¡¨çš„è¯­å¥</li><li>æ•°æ®æ’å…¥è¯­å¥</li></ul><p>å¦‚æœæˆ‘ä»¬åœ¨æ•°æ®å¤‡ä»½æ—¶ï¼Œä¸éœ€è¦åˆ›å»ºè¡¨ï¼Œæˆ–è€…ä¸éœ€è¦å¤‡ä»½æ•°æ®ï¼Œåªéœ€è¦å¤‡ä»½è¡¨ç»“æ„ï¼Œéƒ½å¯ä»¥é€šè¿‡å¯¹åº”çš„å‚æ•°æ¥å®ç°ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p1234</span> <span class="token parameter variable">-t</span> db01 <span class="token operator">&gt;</span> db01.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><hr><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p1234</span> <span class="token parameter variable">-T</span> /root db01 score
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ‰§è¡Œä¸Šè¿°æŒ‡ä»¤ï¼Œä¼šå‡ºé”™ï¼Œæ•°æ®ä¸èƒ½å®Œæˆå¤‡ä»½ï¼ŒåŸå› æ˜¯å› ä¸ºæˆ‘ä»¬æ‰€æŒ‡å®šçš„æ•°æ®å­˜æ”¾ç›®å½•/rootï¼ŒMySQLè®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„ï¼Œéœ€è¦å­˜å‚¨åœ¨MySQLä¿¡ä»»çš„ç›®å½•ä¸‹ã€‚é‚£ä¹ˆï¼Œå“ªä¸ªç›®å½•æ‰æ˜¯MySQLä¿¡ä»»çš„ç›®å½•å‘¢ï¼Œå¯ä»¥æŸ¥çœ‹ ä¸€ä¸‹ç³»ç»Ÿå˜é‡ <code>secure_file_priv</code> ã€‚æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">&#39;%secure_file_priv%&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/manage02.png" alt="image.png" loading="lazy"><br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/manage02.png" alt="image.png" loading="lazy"><br> ä¸Šè¿°çš„ä¸¤ä¸ªæ–‡ä»¶ score.sql ä¸­è®°å½•çš„å°±æ˜¯è¡¨ç»“æ„æ–‡ä»¶ï¼Œè€Œ score.txt å°±æ˜¯è¡¨æ•°æ®æ–‡ä»¶ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„è¡¨æ•°æ®æ–‡ä»¶ï¼Œå¹¶ä¸æ˜¯è®°å½•ä¸€æ¡æ¡çš„insertè¯­å¥ï¼Œè€Œæ˜¯æŒ‰ç…§ä¸€å®šçš„æ ¼å¼è®°å½•è¡¨ç»“æ„ä¸­çš„æ•°æ®ã€‚å¦‚ä¸‹ï¼š<br><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/manage03.png" alt="image.png" loading="lazy"></p><h4 id="mysqlimport-source" tabindex="-1"><a class="header-anchor" href="#mysqlimport-source"><span><strong>mysqlimport/source</strong></span></a></h4><ol><li>mysqlimport</li></ol><p>mysqlimport æ˜¯å®¢æˆ·ç«¯æ•°æ®å¯¼å…¥å·¥å…·ï¼Œç”¨æ¥å¯¼å…¥mysqldump åŠ  -T å‚æ•°åå¯¼å‡ºçš„æ–‡æœ¬æ–‡ä»¶ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>è¯­æ³• ï¼š
  mysqlimport <span class="token punctuation">[</span>options<span class="token punctuation">]</span> db_name textfile1 <span class="token punctuation">[</span>textfile2<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
ç¤ºä¾‹ ï¼š
  mysqlimport <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p2143</span> <span class="token builtin class-name">test</span> /tmp/city.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cdn.jsdelivr.net/gh/Okita1027/knowledge-database-images@main/database/mysql/manage04.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><ol start="2"><li>source</li></ol><p>å¦‚æœéœ€è¦å¯¼å…¥sqlæ–‡ä»¶,å¯ä»¥ä½¿ç”¨mysqlä¸­çš„source æŒ‡ä»¤ :</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token builtin class-name">source</span> /root/xxxxx.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="æ•°æ®ç±»å‹" tabindex="-1"><a class="header-anchor" href="#æ•°æ®ç±»å‹"><span>æ•°æ®ç±»å‹</span></a></h2><h3 id="æ•´å‹" tabindex="-1"><a class="header-anchor" href="#æ•´å‹"><span>æ•´å‹</span></a></h3><table><thead><tr><th>ç±»å‹åç§°</th><th>å–å€¼èŒƒå›´</th><th>å¤§å°</th></tr></thead><tbody><tr><td>TINYINT</td><td>-128ã€œ127</td><td>1ä¸ªå­—èŠ‚</td></tr><tr><td>SMALLINT</td><td>-32768ã€œ32767</td><td>2ä¸ªå®‡èŠ‚</td></tr><tr><td>MEDIUMINT</td><td>-8388608ã€œ8388607</td><td>3ä¸ªå­—èŠ‚</td></tr><tr><td>INT (INTEGHR)</td><td>-2147483648ã€œ2147483647</td><td>4ä¸ªå­—èŠ‚</td></tr><tr><td>BIGINT</td><td>-9223372036854775808ã€œ9223372036854775807</td><td>8ä¸ªå­—èŠ‚</td></tr></tbody></table><p>æ— ç¬¦å·åœ¨æ•°æ®ç±»å‹ååŠ  unsigned å…³é”®å­—ã€‚</p><h3 id="æµ®ç‚¹å‹" tabindex="-1"><a class="header-anchor" href="#æµ®ç‚¹å‹"><span>æµ®ç‚¹å‹</span></a></h3><table><thead><tr><th>ç±»å‹åç§°</th><th>è¯´æ˜</th><th>å­˜å‚¨éœ€æ±‚</th></tr></thead><tbody><tr><td>FLOAT</td><td>å•ç²¾åº¦æµ®ç‚¹æ•°</td><td>4 ä¸ªå­—èŠ‚</td></tr><tr><td>DOUBLE</td><td>åŒç²¾åº¦æµ®ç‚¹æ•°</td><td>8 ä¸ªå­—èŠ‚</td></tr><tr><td>DECIMAL (M, D)ï¼ŒDEC</td><td>å‹ç¼©çš„â€œä¸¥æ ¼â€å®šç‚¹æ•°</td><td>M+2 ä¸ªå­—èŠ‚</td></tr></tbody></table><h3 id="æ—¥æœŸå’Œæ—¶é—´" tabindex="-1"><a class="header-anchor" href="#æ—¥æœŸå’Œæ—¶é—´"><span>æ—¥æœŸå’Œæ—¶é—´</span></a></h3><table><thead><tr><th>ç±»å‹åç§°</th><th>æ—¥æœŸæ ¼å¼</th><th>æ—¥æœŸèŒƒå›´</th><th>å­˜å‚¨éœ€æ±‚</th></tr></thead><tbody><tr><td>YEAR</td><td>YYYY</td><td>1901 ~ 2155</td><td>1 ä¸ªå­—èŠ‚</td></tr><tr><td>TIME</td><td>HH:MM:SS</td><td>-838:59:59 ~ 838:59:59</td><td>3 ä¸ªå­—èŠ‚</td></tr><tr><td>DATE</td><td>YYYY-MM-DD</td><td>1000-01-01 ~ 9999-12-3</td><td>3 ä¸ªå­—èŠ‚</td></tr><tr><td>DATETIME</td><td>YYYY-MM-DD HH:MM:SS</td><td>1000-01-01 00:00:00 ~ 9999-12-31 23:59:59</td><td>8 ä¸ªå­—èŠ‚</td></tr><tr><td>TIMESTAMP</td><td>YYYY-MM-DD HH:MM:SS</td><td>1980-01-01 00:00:01 UTC ~ 2040-01-19 03:14:07 UTC</td><td>4 ä¸ªå­—èŠ‚</td></tr></tbody></table><h3 id="å­—ç¬¦ä¸²" tabindex="-1"><a class="header-anchor" href="#å­—ç¬¦ä¸²"><span>å­—ç¬¦ä¸²</span></a></h3><table><thead><tr><th>ç±»å‹åç§°</th><th>è¯´æ˜</th><th>å­˜å‚¨éœ€æ±‚</th></tr></thead><tbody><tr><td>CHAR(M)</td><td>å›ºå®šé•¿åº¦éäºŒè¿›åˆ¶å­—ç¬¦ä¸²</td><td>M å­—èŠ‚ï¼Œ1&lt;=M&lt;=255</td></tr><tr><td>VARCHAR(M)</td><td>å˜é•¿éäºŒè¿›åˆ¶å­—ç¬¦ä¸²</td><td>L+1å­—èŠ‚ï¼Œåœ¨æ­¤ï¼ŒL&lt; = Må’Œ 1&lt;=M&lt;=255</td></tr><tr><td>TINYTEXT</td><td>éå¸¸å°çš„éäºŒè¿›åˆ¶å­—ç¬¦ä¸²</td><td>L+1å­—èŠ‚ï¼Œåœ¨æ­¤ï¼ŒL&lt;2^8</td></tr><tr><td>TEXT</td><td>å°çš„éäºŒè¿›åˆ¶å­—ç¬¦ä¸²</td><td>L+2å­—èŠ‚ï¼Œåœ¨æ­¤ï¼ŒL&lt;2^16</td></tr><tr><td>MEDIUMTEXT</td><td>ä¸­ç­‰å¤§å°çš„éäºŒè¿›åˆ¶å­—ç¬¦ä¸²</td><td>L+3å­—èŠ‚ï¼Œåœ¨æ­¤ï¼ŒL&lt;2^24</td></tr><tr><td>LONGTEXT</td><td>å¤§çš„éäºŒè¿›åˆ¶å­—ç¬¦ä¸²</td><td>L+4å­—èŠ‚ï¼Œåœ¨æ­¤ï¼ŒL&lt;2^32</td></tr><tr><td>ENUM</td><td>æšä¸¾ç±»å‹ï¼Œåªèƒ½æœ‰ä¸€ä¸ªæšä¸¾å­—ç¬¦ä¸²å€¼</td><td>1æˆ–2ä¸ªå­—èŠ‚ï¼Œå–å†³äºæšä¸¾å€¼çš„æ•°ç›® (æœ€å¤§å€¼ä¸º65535)</td></tr><tr><td>SET</td><td>ä¸€ä¸ªè®¾ç½®ï¼Œå­—ç¬¦ä¸²å¯¹è±¡å¯ä»¥æœ‰é›¶ä¸ªæˆ– å¤šä¸ªSETæˆå‘˜</td><td>1ã€2ã€3ã€4æˆ–8ä¸ªå­—èŠ‚ï¼Œå–å†³äºé›†åˆ æˆå‘˜çš„æ•°é‡ï¼ˆæœ€å¤š64ä¸ªæˆå‘˜ï¼‰</td></tr></tbody></table><h3 id="äºŒè¿›åˆ¶ç±»å‹" tabindex="-1"><a class="header-anchor" href="#äºŒè¿›åˆ¶ç±»å‹"><span>äºŒè¿›åˆ¶ç±»å‹</span></a></h3><table><thead><tr><th>ç±»å‹åç§°</th><th>è¯´æ˜</th><th>å­˜å‚¨éœ€æ±‚</th></tr></thead><tbody><tr><td>BIT(M)</td><td>ä½å­—æ®µç±»å‹</td><td>å¤§çº¦ (M+7)/8 å­—èŠ‚</td></tr><tr><td>BINARY(M)</td><td>å›ºå®šé•¿åº¦äºŒè¿›åˆ¶å­—ç¬¦ä¸²</td><td>M å­—èŠ‚</td></tr><tr><td>VARBINARY (M)</td><td>å¯å˜é•¿åº¦äºŒè¿›åˆ¶å­—ç¬¦ä¸²</td><td>M+1 å­—èŠ‚</td></tr><tr><td>TINYBLOB (M)</td><td>éå¸¸å°çš„BLOB</td><td>L+1 å­—èŠ‚ï¼Œåœ¨æ­¤ï¼ŒL&lt;2^8</td></tr><tr><td>BLOB (M)</td><td>å° BLOB</td><td>L+2 å­—èŠ‚ï¼Œåœ¨æ­¤ï¼ŒL&lt;2^16</td></tr><tr><td>MEDIUMBLOB (M)</td><td>ä¸­ç­‰å¤§å°çš„BLOB</td><td>L+3 å­—èŠ‚ï¼Œåœ¨æ­¤ï¼ŒL&lt;2^24</td></tr><tr><td>LONGBLOB (M)</td><td>éå¸¸å¤§çš„BLOB</td><td>L+4 å­—èŠ‚ï¼Œåœ¨æ­¤ï¼ŒL&lt;2^32</td></tr></tbody></table><h2 id="æƒé™ä¸€è§ˆè¡¨" tabindex="-1"><a class="header-anchor" href="#æƒé™ä¸€è§ˆè¡¨"><span>æƒé™ä¸€è§ˆè¡¨</span></a></h2><blockquote><p>å…·ä½“æƒé™çš„ä½œç”¨è¯¦è§<a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£</a></p></blockquote><p>GRANT å’Œ REVOKE å…è®¸çš„é™æ€æƒé™</p><table><thead><tr><th>Privilege</th><th>Grant Table Column</th><th>Context</th></tr></thead><tbody><tr><td><code>[ALL [PRIVILEGES]](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_all)</code></td><td>Synonym for â€œall privilegesâ€</td><td>Server administration</td></tr><tr><td><code>[ALTER](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_alter)</code></td><td><code>Alter_priv</code></td><td>Tables</td></tr><tr><td><code>[ALTER ROUTINE](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_alter-routine)</code></td><td><code>Alter_routine_priv</code></td><td>Stored routines</td></tr><tr><td><code>[CREATE](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create)</code></td><td><code>Create_priv</code></td><td>Databases, tables, or indexes</td></tr><tr><td><code>[CREATE ROLE](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-role)</code></td><td><code>Create_role_priv</code></td><td>Server administration</td></tr><tr><td><code>[CREATE ROUTINE](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-routine)</code></td><td><code>Create_routine_priv</code></td><td>Stored routines</td></tr><tr><td><code>[CREATE TABLESPACE](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-tablespace)</code></td><td><code>Create_tablespace_priv</code></td><td>Server administration</td></tr><tr><td><code>[CREATE TEMPORARY TABLES](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-temporary-tables)</code></td><td><code>Create_tmp_table_priv</code></td><td>Tables</td></tr><tr><td><code>[CREATE USER](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-user)</code></td><td><code>Create_user_priv</code></td><td>Server administration</td></tr><tr><td><code>[CREATE VIEW](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-view)</code></td><td><code>Create_view_priv</code></td><td>Views</td></tr><tr><td><code>[DELETE](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_delete)</code></td><td><code>Delete_priv</code></td><td>Tables</td></tr><tr><td><code>[DROP](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_drop)</code></td><td><code>Drop_priv</code></td><td>Databases, tables, or views</td></tr><tr><td><code>[DROP ROLE](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_drop-role)</code></td><td><code>Drop_role_priv</code></td><td>Server administration</td></tr><tr><td><code>[EVENT](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_event)</code></td><td><code>Event_priv</code></td><td>Databases</td></tr><tr><td><code>[EXECUTE](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_execute)</code></td><td><code>Execute_priv</code></td><td>Stored routines</td></tr><tr><td><code>[FILE](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_file)</code></td><td><code>File_priv</code></td><td>File access on server host</td></tr><tr><td><code>[GRANT OPTION](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_grant-option)</code></td><td><code>Grant_priv</code></td><td>Databases, tables, or stored routines</td></tr><tr><td><code>[INDEX](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_index)</code></td><td><code>Index_priv</code></td><td>Tables</td></tr><tr><td><code>[INSERT](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_insert)</code></td><td><code>Insert_priv</code></td><td>Tables or columns</td></tr><tr><td><code>[LOCK TABLES](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_lock-tables)</code></td><td><code>Lock_tables_priv</code></td><td>Databases</td></tr><tr><td><code>[PROCESS](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_process)</code></td><td><code>Process_priv</code></td><td>Server administration</td></tr><tr><td><code>[PROXY](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_proxy)</code></td><td>See <code>proxies_priv</code></td><td></td></tr><tr><td>table</td><td>Server administration</td><td></td></tr><tr><td><code>[REFERENCES](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_references)</code></td><td><code>References_priv</code></td><td>Databases or tables</td></tr><tr><td><code>[RELOAD](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_reload)</code></td><td><code>Reload_priv</code></td><td>Server administration</td></tr><tr><td><code>[REPLICATION CLIENT](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_replication-client)</code></td><td><code>Repl_client_priv</code></td><td>Server administration</td></tr><tr><td><code>[REPLICATION SLAVE](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_replication-slave)</code></td><td><code>Repl_slave_priv</code></td><td>Server administration</td></tr><tr><td><code>[SELECT](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_select)</code></td><td><code>Select_priv</code></td><td>Tables or columns</td></tr><tr><td><code>[SHOW DATABASES](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_show-databases)</code></td><td><code>Show_db_priv</code></td><td>Server administration</td></tr><tr><td><code>[SHOW VIEW](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_show-view)</code></td><td><code>Show_view_priv</code></td><td>Views</td></tr><tr><td><code>[SHUTDOWN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_shutdown)</code></td><td><code>Shutdown_priv</code></td><td>Server administration</td></tr><tr><td><code>[SUPER](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_super)</code></td><td><code>Super_priv</code></td><td>Server administration</td></tr><tr><td><code>[TRIGGER](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_trigger)</code></td><td><code>Trigger_priv</code></td><td>Tables</td></tr><tr><td><code>[UPDATE](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_update)</code></td><td><code>Update_priv</code></td><td>Tables or columns</td></tr><tr><td><code>[USAGE](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_usage)</code></td><td>Synonym for â€œno privilegesâ€</td><td>Server administration</td></tr></tbody></table><p>GRANT å’Œ REVOKE å…è®¸çš„åŠ¨æ€æƒé™</p><table><thead><tr><th>Privilege</th><th>Context</th></tr></thead><tbody><tr><td><code>[APPLICATION_PASSWORD_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_application-password-admin)</code></td><td>Dual password administration</td></tr><tr><td><code>[AUDIT_ABORT_EXEMPT](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_audit-abort-exempt)</code></td><td>Allow queries blocked by audit log filter</td></tr><tr><td><code>[AUDIT_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_audit-admin)</code></td><td>Audit log administration</td></tr><tr><td><code>[AUTHENTICATION_POLICY_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_authentication-policy-admin)</code></td><td>Authentication administration</td></tr><tr><td><code>[BACKUP_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_backup-admin)</code></td><td>Backup administration</td></tr><tr><td><code>[BINLOG_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_binlog-admin)</code></td><td>Backup and Replication administration</td></tr><tr><td><code>[BINLOG_ENCRYPTION_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_binlog-encryption-admin)</code></td><td>Backup and Replication administration</td></tr><tr><td><code>[CLONE_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_clone-admin)</code></td><td>Clone administration</td></tr><tr><td><code>[CONNECTION_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_connection-admin)</code></td><td>Server administration</td></tr><tr><td><code>[ENCRYPTION_KEY_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_encryption-key-admin)</code></td><td>Server administration</td></tr><tr><td><code>[FIREWALL_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_firewall-admin)</code></td><td>Firewall administration</td></tr><tr><td><code>[FIREWALL_EXEMPT](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_firewall-exempt)</code></td><td>Firewall administration</td></tr><tr><td><code>[FIREWALL_USER](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_firewall-user)</code></td><td>Firewall administration</td></tr><tr><td><code>[FLUSH_OPTIMIZER_COSTS](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_flush-optimizer-costs)</code></td><td>Server administration</td></tr><tr><td><code>[FLUSH_STATUS](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_flush-status)</code></td><td>Server administration</td></tr><tr><td><code>[FLUSH_TABLES](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_flush-tables)</code></td><td>Server administration</td></tr><tr><td><code>[FLUSH_USER_RESOURCES](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_flush-user-resources)</code></td><td>Server administration</td></tr><tr><td><code>[GROUP_REPLICATION_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_group-replication-admin)</code></td><td>Replication administration</td></tr><tr><td><code>[GROUP_REPLICATION_STREAM](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_group-replication-stream)</code></td><td>Replication administration</td></tr><tr><td><code>[INNODB_REDO_LOG_ARCHIVE](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_innodb-redo-log-archive)</code></td><td>Redo log archiving administration</td></tr><tr><td><code>[NDB_STORED_USER](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_ndb-stored-user)</code></td><td>NDB Cluster</td></tr><tr><td><code>[PASSWORDLESS_USER_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_passwordless-user-admin)</code></td><td>Authentication administration</td></tr><tr><td><code>[PERSIST_RO_VARIABLES_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_persist-ro-variables-admin)</code></td><td>Server administration</td></tr><tr><td><code>[REPLICATION_APPLIER](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_replication-applier)</code></td><td><code>PRIVILEGE_CHECKS_USER</code></td></tr><tr><td>for a replication channel</td><td></td></tr><tr><td><code>[REPLICATION_SLAVE_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_replication-slave-admin)</code></td><td>Replication administration</td></tr><tr><td><code>[RESOURCE_GROUP_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_resource-group-admin)</code></td><td>Resource group administration</td></tr><tr><td><code>[RESOURCE_GROUP_USER](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_resource-group-user)</code></td><td>Resource group administration</td></tr><tr><td><code>[ROLE_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_role-admin)</code></td><td>Server administration</td></tr><tr><td><code>[SESSION_VARIABLES_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_session-variables-admin)</code></td><td>Server administration</td></tr><tr><td><code>[SET_USER_ID](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_set-user-id)</code></td><td>Server administration</td></tr><tr><td><code>[SHOW_ROUTINE](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_show-routine)</code></td><td>Server administration</td></tr><tr><td><code>[SYSTEM_USER](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_system-user)</code></td><td>Server administration</td></tr><tr><td><code>[SYSTEM_VARIABLES_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_system-variables-admin)</code></td><td>Server administration</td></tr><tr><td><code>[TABLE_ENCRYPTION_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_table-encryption-admin)</code></td><td>Server administration</td></tr><tr><td><code>[VERSION_TOKEN_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_version-token-admin)</code></td><td>Server administration</td></tr><tr><td><code>[XA_RECOVER_ADMIN](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_xa-recover-admin)</code></td><td>Server administration</td></tr></tbody></table></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="vp-link vp-external-link-icon vp-meta-label" href="https://github.com/Okita1027/knowledge-database/edit/main/database/MySQL.md" rel="noopener noreferrer" target="_blank" aria-label="ç¼–è¾‘æ­¤é¡µ"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 2368932388@qq.com">Zhiyun Qin</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><!----><a class="route-link vp-link next" href="/knowledge-database/database/MongoDB.html" aria-label="MongoDB"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">MongoDB<!----></div></a></nav><!----><!----><!--]--></main><!--]--><!----></div><!--]--><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/knowledge-database/assets/app-NwmlIrjp.js" defer></script>
  </body>
</html>
